<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/Bayesian-Julia/libs/katex/katex.min.css"> <link rel=stylesheet  href="/Bayesian-Julia/libs/highlight/github.min.css"> <link rel=stylesheet  href="/Bayesian-Julia/css/jtd.css"> <link rel=icon  href="/Bayesian-Julia/assets/favicon.ico"> <title>Markov Chain Monte Carlo &#40;MCMC&#41;</title> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/Bayesian-Julia/" class=title > Bayesian Stats </a> </div> <label for=show-menu  class=show-menu >MENU</label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "><a href="/Bayesian-Julia/" class="menu-list-link ">Home</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/01_why_Julia/" class="menu-list-link ">1. Why Julia?</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/02_bayes_stats/" class="menu-list-link ">2. What is Bayesian Statistics?</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/03_prob_dist/" class="menu-list-link ">3. Common Probability Distributions</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/04_Turing/" class="menu-list-link ">4. How to use Turing</a> <li class="menu-list-item active"><a href="/Bayesian-Julia/pages/05_MCMC/" class="menu-list-link active">5. Markov Chain Monte Carlo (MCMC)</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/06_linear_reg/" class="menu-list-link ">6. Bayesian Linear Regression</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/07_logistic_reg/" class="menu-list-link ">7. Bayesian Logistic Regression</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/08_ordinal_reg/" class="menu-list-link ">8. Bayesian Ordinal Regression</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/09_count_reg/" class="menu-list-link ">9. Bayesian Regression with Count Data</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/10_robust_reg/" class="menu-list-link ">10. Robust Bayesian Regression</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/11_multilevel_models/" class="menu-list-link ">11. Multilevel Models</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/12_Turing_tricks/" class="menu-list-link ">12. Computational Tricks with Turing</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/13_epi_models/" class="menu-list-link ">13. Bayesian Epidemiological Models</a> </ul> </div> <div class=footer > <a href="https://www.julialang.org"><img style="height:50px;padding-left:10px;margin-bottom:15px;" src="https://julialang.org/assets/infra/logo.svg" alt="Julia Logo"></a> </div> </div> <div class=main-content-wrap > <div class=main-content > <div class=main-header > <a id=github  href="https://github.com/storopoli/Bayesian-Julia">Code on GitHub</a> </div> <div class=franklin-content ><div class=franklin-toc ><ol><li><a href="#what_is_the_denominator_ptextdata_for">What is the denominator <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span> for?</a><li><a href="#what_if_we_remove_this_denominator">What if we remove this denominator?</a><li><a href="#markov_chain_monte_carlo_mcmc__2">Markov Chain Monte Carlo &#40;MCMC&#41;</a><ol><li><a href="#monte_carlo_method">Monte Carlo Method</a><li><a href="#simulations">Simulations</a><li><a href="#metropolis_and_metropolis-hastings">Metropolis and Metropolis-Hastings</a><li><a href="#gibbs">Gibbs</a><li><a href="#what_happens_when_we_run_markov_chains_in_parallel">What happens when we run Markov chains in parallel?</a></ol><li><a href="#hamiltonian_monte_carlo_hmc">Hamiltonian Monte Carlo – HMC</a><ol><li><a href="#momentum_distribution_pphi">Momentum Distribution – <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>ϕ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\phi)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal">ϕ</span><span class=mclose >)</span></span></span></span></a><li><a href="#hmc_algorithm">HMC Algorithm</a><li><a href="#hmc_implementation">HMC – Implementation</a><li><a href="#hmc_complex_topologies">HMC – Complex Topologies</a></ol><li><a href="#i_understood_nothing">&quot;I understood nothing...&quot;</a><li><a href="#mcmc_metrics">MCMC Metrics</a><ol><li><a href="#what_looks_like_when_your_model_doesnt_converge">What looks like when your model doesn&#39;t converge</a><li><a href="#mcmc_visualizations">MCMC Visualizations</a></ol><li><a href="#how_to_make_your_markov_chains_converge">How to make your Markov chains converge</a><li><a href="#footnotes">Footnotes</a><li><a href="#references">References</a></ol></div> <h1 id=markov_chain_monte_carlo_mcmc ><a href="#markov_chain_monte_carlo_mcmc" class=header-anchor >Markov Chain Monte Carlo &#40;MCMC&#41;</a></h1> <p>The main computational barrier for Bayesian statistics is the denominator <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span> of the Bayes formula:</p> <a id=bayes  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mtext>data</mtext><mo stretchy=false >)</mo><mo>=</mo><mfrac><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>⋅</mo><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo>∣</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><mrow><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex"> P(\theta \mid \text{data})=\frac{P(\theta) \cdot P(\text{data} \mid \theta)}{P(\text{data})} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.363em;vertical-align:-0.936em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> <p>In discrete cases we can turn the denominator into a sum of all parameters using the chain rule of probability:</p> <a id=chainrule  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>A</mi><mo separator=true >,</mo><mi>B</mi><mo>∣</mo><mi>C</mi><mo stretchy=false >)</mo><mo>=</mo><mi>P</mi><mo stretchy=false >(</mo><mi>A</mi><mo>∣</mo><mi>B</mi><mo separator=true >,</mo><mi>C</mi><mo stretchy=false >)</mo><mo>×</mo><mi>P</mi><mo stretchy=false >(</mo><mi>B</mi><mo>∣</mo><mi>C</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> P(A,B \mid C)=P(A \mid B,C) \times P(B \mid C) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal">A</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mclose >)</span></span></span></span></span> <p>This is also called marginalization:</p> <a id=discretemarginalization  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo stretchy=false >)</mo><mo>=</mo><munder><mo>∑</mo><mi>θ</mi></munder><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo>∣</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>×</mo><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> P(\text{data})=\sum_{\theta} P(\text{data} \mid \theta) \times P(\theta) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.3521180000000004em;vertical-align:-1.3021129999999999em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.0500050000000005em;"><span style="top:-1.847887em;margin-left:0em;"><span class=pstrut  style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span style="top:-3.050005em;"><span class=pstrut  style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.3021129999999999em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span></span> <p>However, in the continuous cases the denominator <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span> becomes a very large and complicated integral to calculate:</p> <a id=continuousmarginalization  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo stretchy=false >)</mo><mo>=</mo><msub><mo>∫</mo><mi>θ</mi></msub><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo>∣</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>×</mo><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mi>d</mi><mi>θ</mi></mrow><annotation encoding="application/x-tex"> P(\text{data})=\int_{\theta} P(\text{data} \mid \theta) \times P(\theta)d \theta </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.27195em;vertical-align:-0.9119499999999999em;"></span><span class=mop ><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">∫</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:-0.425842em;"><span style="top:-1.7880500000000001em;margin-left:-0.44445em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9119499999999999em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span> <p>In many cases this integral becomes <em>intractable</em> &#40;incalculable&#41; and therefore we must find other ways to calculate the posterior probability <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta \mid \text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span> in <span class=eqref >(<a href="#bayes">1</a>)</span> without using the denominator <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span>.</p> <h2 id=what_is_the_denominator_ptextdata_for ><a href="#what_is_the_denominator_ptextdata_for" class=header-anchor >What is the denominator <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span> for?</a></h2> <p>Quick answer: to normalize the posterior in order to make it a valid probability distribution. This means that the sum of all probabilities of the possible events in the probability distribution must be equal to 1:</p> <ul> <li><p>in the case of discrete probability distribution: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mi>θ</mi></msub><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mtext>data</mtext><mo stretchy=false >)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_{\theta} P(\theta \mid \text{data}) = 1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.0497100000000001em;vertical-align:-0.29971000000000003em;"></span><span class=mop ><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1863979999999999em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span></p> <li><p>in the case of continuous probability distribution: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∫</mo><mi>θ</mi></msub><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mtext>data</mtext><mo stretchy=false >)</mo><mi>d</mi><mi>θ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\int_{\theta} P(\theta \mid \text{data})d \theta = 1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.1608200000000002em;vertical-align:-0.35582em;"></span><span class=mop ><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0005599999999999772em;">∫</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1302879999999999em;"><span style="top:-2.34418em;margin-left:-0.19445em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.35582em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span></p> </ul> <h2 id=what_if_we_remove_this_denominator ><a href="#what_if_we_remove_this_denominator" class=header-anchor >What if we remove this denominator?</a></h2> <p>When we remove the denominator <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(\text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span> we have that the posterior <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta \mid \text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span> is <strong>proportional</strong> to the prior multiplied by the likelihood <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>⋅</mo><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo>∣</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta) \cdot P(\text{data} \mid \theta)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span><sup id="fnref:propto"><a href="#fndef:propto" class=fnref >[1]</a></sup>.</p> <a id=proptobayes  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mtext>data</mtext><mo stretchy=false >)</mo><mo>∝</mo><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo><mo>⋅</mo><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo>∣</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> P(\theta \mid \text{data}) \propto P(\theta) \cdot P(\text{data} \mid \theta) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∝</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span></span> <p>This <a href="https://youtu.be/8FbqSVFzmoY">YouTube video</a> explains the denominator problem very well, see below:</p> <style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style><div class='embed-container'><iframe src='https://www.youtube.com/embed/8FbqSVFzmoY' frameborder='0' allowfullscreen></iframe></div> <h2 id=markov_chain_monte_carlo_mcmc__2 ><a href="#markov_chain_monte_carlo_mcmc__2" class=header-anchor >Markov Chain Monte Carlo &#40;MCMC&#41;</a></h2> <p>This is where Markov Chain Monte Carlo comes in. MCMC is a broad class of computational tools for approximating integrals and generating samples from a posterior probability &#40;Brooks, Gelman, Jones &amp; Meng, 2011&#41;. MCMC is used when it is not possible to sample <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> directly from the subsequent probabilistic distribution <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta \mid \text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span>. Instead, we sample in an iterative manner such that at each step of the process we expect the distribution from which we sample <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>P</mi><mo>∗</mo></msup><mo stretchy=false >(</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo>∣</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P^* (\theta^* \mid \text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span> &#40;here <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∗</mo></mrow><annotation encoding="application/x-tex">*</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.46528em;vertical-align:0em;"></span><span class=mord >∗</span></span></span></span> means simulated&#41; becomes increasingly similar to the posterior <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta \mid \text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span>. All of this is to eliminate the &#40;often impossible&#41; calculation of the denominator <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span>.</p> <p>The idea is to define an ergodic Markov chain &#40;that is to say that there is a single stationary distribution&#41; of which the set of possible states is the sample space and the stationary distribution is the distribution to be approximated &#40;or sampled&#41;. Let <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>0</mn></msub><mo separator=true >,</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator=true >,</mo><mo>…</mo><mo separator=true >,</mo><msub><mi>X</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">X_0, X_1, \dots, X_n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner >…</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> be a simulation of the chain. The Markov chain converges to the stationary distribution of any initial state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">X_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> after a large enough number of iterations <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>, the distribution of the state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">X_r</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> will be similar to the stationary distribution, so we can use it as a sample. Markov chains have a property that the probability distribution of the next state depends only on the current state and not on the sequence of events that preceded: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>X</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>x</mi><mo>∣</mo><msub><mi>X</mi><mn>0</mn></msub><mo separator=true >,</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator=true >,</mo><msub><mi>X</mi><mn>2</mn></msub><mo separator=true >,</mo><mo>…</mo><mo separator=true >,</mo><msub><mi>X</mi><mi>n</mi></msub><mo stretchy=false >)</mo><mo>=</mo><mi>P</mi><mo stretchy=false >(</mo><msub><mi>X</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>x</mi><mo>∣</mo><msub><mi>X</mi><mi>n</mi></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(X_{n+1}=x \mid X_{0},X_{1},X_{2},\ldots ,X_{n}) = P(X_{n+1}=x \mid X_{n})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.208331em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner >…</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.208331em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>. This property is called Markovian, after the mathematician <a href="https://en.wikipedia.org/wiki/Andrey_Markov">Andrey Markov</a> &#40;see figure below&#41;. Similarly, repeating this argument with <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">X_r</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> as the starting point, we can use <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mrow><mn>2</mn><mi>r</mi></mrow></msub></mrow><annotation encoding="application/x-tex">X_{2r}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> as a sample, and so on. We can then use the state sequence <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>r</mi></msub><mo separator=true >,</mo><msub><mi>X</mi><mrow><mn>2</mn><mi>r</mi></mrow></msub><mo separator=true >,</mo><msub><mi>X</mi><mrow><mn>3</mn><mi>r</mi></mrow></msub><mo separator=true >,</mo><mo>…</mo></mrow><annotation encoding="application/x-tex">X_r, X_{2r}, X_{3r}, \dots</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner >…</span></span></span></span> as almost independent samples of the stationary distribution of the Markov chain.</p> <p><img src="/Bayesian-Julia/pages/images/andrey_markov.jpg" alt="Andrey Markov" /></p> <p><div class=text-center ><em>Andrey Markov</em></div> <br/></p> <p>The effectiveness of this approach depends on:</p> <ol> <li><p>how big <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> must be to ensure a suitably good sample; and</p> <li><p>computational power required for each iteration of the Markov chain.</p> </ol> <p>In addition, it is customary to discard the first iterations of the algorithm as they are usually not representative of the distribution to be approximated. In the initial iterations of MCMC algorithms, generally the Markov current is in a <em>warm-up</em> process<sup id="fnref:warmup"><a href="#fndef:warmup" class=fnref >[2]</a></sup> and its state is far from ideal to start a reliable sampling. It is generally recommended to discard half of the iterations &#40;Gelman, Carlin, Stern, Dunson, Vehtari, &amp; Rubin, 2013a&#41;. For example: if the Markov chain has 4,000 iterations, we discard the first 2,000 as warm-up.</p> <h3 id=monte_carlo_method ><a href="#monte_carlo_method" class=header-anchor >Monte Carlo Method</a></h3> <p>Stanislaw Ulam &#40;figure below&#41;, who participated in the Manhattan project and when trying to calculate the neutron diffusion process for the hydrogen bomb ended up creating a class of methods called <strong><em>Monte Carlo</em></strong>.</p> <p><img src="/Bayesian-Julia/pages/images/stanislaw.jpg" alt="Stanislaw Ulam" /></p> <p><div class=text-center ><em>Stanislaw Ulam</em></div> <br/></p> <p>Monte Carlo methods have the underlying concept of using randomness to solve problems that can be deterministic in principle. They are often used in physical and mathematical problems and are most useful when it is difficult or impossible to use other approaches. Monte Carlo methods are used mainly in three classes of problems: optimization, numerical integration and generating sample from a probability distribution.</p> <p>The idea for the method came to Ulam while playing solitaire during his recovery from surgery, as he thought about playing hundreds of games to statistically estimate the probability of a successful outcome. As he himself mentions in Eckhardt &#40;1987&#41;:</p> <blockquote> <p>&quot;The first thoughts and attempts I made to practice &#91;the Monte Carlo method&#93; were suggested by a question which occurred to me in 1946 as I was convalescing from an illness and playing solitaires. The question was what are the chances that a Canfield solitaire laid out with 52 cards will come out successfully? After spending a lot of time trying to estimate them by pure combinatorial calculations, I wondered whether a more practical method than &quot;abstract thinking&quot; might not be to lay it out say one hundred times and simply observe and count the number of successful plays. This was already possible to envisage with the beginning of the new era of fast computers, and I immediately thought of problems of neutron diffusion and other questions of mathematical physics, and more generally how to change processes described by certain differential equations into an equivalent form interpretable as a succession of random operations. Later... &#91;in 1946, I &#93; described the idea to John von Neumann and we began to plan actual calculations.&quot;</p> </blockquote> <p>Because it was secret, von Neumann and Ulam&#39;s work required a codename. A colleague of von Neumann and Ulam, Nicholas Metropolis &#40;figure below&#41;, suggested using the name &quot;Monte Carlo&quot;, which refers to Casino Monte Carlo in Monaco, where Ulam&#39;s uncle &#40;Michał Ulam&#41; borrowed money from relatives to gamble.</p> <p><img src="/Bayesian-Julia/pages/images/nicholas_metropolis.png" alt="Nicholas Metropolis" /></p> <p><div class=text-center ><em>Nicholas Metropolis</em></div> <br/></p> <p>The <a href="https://en.wikipedia.org/wiki/Monte_Carlo_method#Applications">applications of the Monte Carlo method</a> are numerous: physical sciences, engineering, climate change, computational biology, computer graphics, applied statistics, artificial intelligence, search and rescue, finance and business and law. In the scope of these tutorials we will focus on applied statistics and specifically in the context of Bayesian inference: providing a random sample of the posterior distribution.</p> <h3 id=simulations ><a href="#simulations" class=header-anchor >Simulations</a></h3> <p>I will do some simulations to illustrate MCMC algorithms and techniques. So, here&#39;s the initial setup:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> CairoMakie
<span class=hljs-keyword >using</span> Distributions
<span class=hljs-keyword >using</span> Random

Random.seed!(<span class=hljs-number >123</span>);</code></pre> <p>Let&#39;s start with a toy problem of a multivariate normal distribution of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>, where</p> <a id=mvnormal  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mi>Y</mi></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo>∼</mo><mtext>Multivariate Normal</mtext><mrow><mo fence=true >(</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>μ</mi><mi>X</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>μ</mi><mi>Y</mi></msub></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo separator=true >,</mo><mi mathvariant=bold >Σ</mi><mo fence=true >)</mo></mrow><mspace linebreak=newline ></mspace><mi mathvariant=bold >Σ</mi><mo>∼</mo><mrow><mo fence=true >(</mo><mtable rowspacing=0.1600em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msubsup><mi>σ</mi><mi>X</mi><mn>2</mn></msubsup></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi>σ</mi><mi>X</mi></msub><msub><mi>σ</mi><mi>Y</mi></msub><mi>ρ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi>σ</mi><mi>X</mi></msub><msub><mi>σ</mi><mi>Y</mi></msub><mi>ρ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><msubsup><mi>σ</mi><mi>Y</mi><mn>2</mn></msubsup></mstyle></mtd></mtr></mtable><mo fence=true >)</mo></mrow></mrow><annotation encoding="application/x-tex"> \begin{bmatrix} X \\ Y \end{bmatrix} \sim \text{Multivariate Normal} \left( \begin{bmatrix} \mu_X \\ \mu_Y \end{bmatrix}, \mathbf{\Sigma} \right) \\ \mathbf{\Sigma} \sim \begin{pmatrix} \sigma^2_{X} &amp; \sigma_{X}\sigma_{Y} \rho \\ \sigma_{X}\sigma_{Y} \rho &amp; \sigma^2_{Y} \end{pmatrix} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord text"><span class=mord >Multivariate Normal</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathbf">Σ</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span><span class="mspace newline"></span><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">Σ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.424669em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.275331em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">ρ</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">ρ</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.424669em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.275331em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span> <p>If we assign <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>X</mi></msub><mo>=</mo><msub><mi>μ</mi><mi>Y</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\mu_X = \mu_Y = 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>X</mi></msub><mo>=</mo><msub><mi>σ</mi><mi>Y</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sigma_X = \sigma_Y = 1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span> &#40;mean 0 and standard deviation 1 for both <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>&#41;, we have the following formulation from <span class=eqref >(<a href="#mvnormal">6</a>)</span>:</p> <a id=stdmvnormal  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mi>Y</mi></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo>∼</mo><mtext>Multivariate Normal</mtext><mrow><mo fence=true >(</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo separator=true >,</mo><mi mathvariant=bold >Σ</mi><mo fence=true >)</mo></mrow><mo separator=true >,</mo><mspace linebreak=newline ></mspace><mi mathvariant=bold >Σ</mi><mo>∼</mo><mrow><mo fence=true >(</mo><mtable rowspacing=0.1600em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mi>ρ</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mi>ρ</mi></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence=true >)</mo></mrow></mrow><annotation encoding="application/x-tex"> \begin{bmatrix} X \\ Y \end{bmatrix} \sim \text{Multivariate Normal} \left( \begin{bmatrix} 0 \\ 0 \end{bmatrix}, \mathbf{\Sigma} \right), \\ \mathbf{\Sigma} \sim \begin{pmatrix} 1 &amp; \rho \\ \rho &amp; 1 \end{pmatrix} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord text"><span class=mord >Multivariate Normal</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathbf">Σ</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span><span class="mspace newline"></span><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">Σ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">ρ</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">ρ</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span> <p>All that remains is to assign a value for <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi></mrow><annotation encoding="application/x-tex">\rho</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ρ</span></span></span></span> in <span class=eqref >(<a href="#stdmvnormal">7</a>)</span> for the correlation between <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>. For our example we will use correlation of 0.8 &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><mn>0.8</mn></mrow><annotation encoding="application/x-tex">\rho = 0.8</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ρ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0.8</span></span></span></span>&#41;:</p> <a id=sigma  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi mathvariant=bold >Σ</mi><mo>∼</mo><mrow><mo fence=true >(</mo><mtable rowspacing=0.1600em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0.8</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0.8</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence=true >)</mo></mrow></mrow><annotation encoding="application/x-tex"> \mathbf{\Sigma} \sim \begin{pmatrix} 1 &amp; 0.8 \\ 0.8 &amp; 1 \end{pmatrix} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">Σ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0.8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0.8</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span> <pre><code class="julia hljs"><span class=hljs-keyword >const</span> N = <span class=hljs-number >100_000</span>
<span class=hljs-keyword >const</span> μ = [<span class=hljs-number >0</span>, <span class=hljs-number >0</span>]
<span class=hljs-keyword >const</span> Σ = [<span class=hljs-number >1</span> <span class=hljs-number >0.8</span>; <span class=hljs-number >0.8</span> <span class=hljs-number >1</span>]

<span class=hljs-keyword >const</span> mvnormal = MvNormal(μ, Σ)</code></pre><pre><code class="plaintext hljs">FullNormal(
dim: 2
μ: [0.0, 0.0]
Σ: [1.0 0.8; 0.8 1.0]
)
</code></pre> <p>In the figure below it is possible to see a contour plot of the PDF of a multivariate normal distribution composed of two normal variables <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>, both with mean 0 and standard deviation 1. The correlation between <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> is <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><mn>0.8</mn></mrow><annotation encoding="application/x-tex">\rho = 0.8</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ρ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0.8</span></span></span></span>:</p> <pre><code class="julia hljs">x = -<span class=hljs-number >3</span>:<span class=hljs-number >0.01</span>:<span class=hljs-number >3</span>
y = -<span class=hljs-number >3</span>:<span class=hljs-number >0.01</span>:<span class=hljs-number >3</span>
dens_mvnormal = [pdf(mvnormal, [i, j]) <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> x, j <span class=hljs-keyword >in</span> y]
f, ax, c = contourf(x, y, dens_mvnormal; axis=(; xlabel=<span class=hljs-string >L&quot;X&quot;</span>, ylabel=<span class=hljs-string >L&quot;Y&quot;</span>))
Colorbar(f[<span class=hljs-number >1</span>, <span class=hljs-number >2</span>], c)</code></pre> <p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/countour_mvnormal.svg" alt=""> <div class=text-center ><em>Countour Plot of the PDF of a Multivariate Normal Distribution</em></div> <br/></p> <p>Also a surface plot can be seen below for you to get a 3-D intuition of what is going on:</p> <pre><code class="julia hljs">f, ax, s = surface(
    x,
    y,
    dens_mvnormal;
    axis=(type=Axis3, xlabel=<span class=hljs-string >L&quot;X&quot;</span>, ylabel=<span class=hljs-string >L&quot;Y&quot;</span>, zlabel=<span class=hljs-string >&quot;PDF&quot;</span>, azimuth=<span class=hljs-literal >pi</span> / <span class=hljs-number >8</span>),
)</code></pre> <p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/surface_mvnormal.svg" alt=""> <div class=text-center ><em>Surface Plot of the PDF of a Multivariate Normal Distribution</em></div> <br/></p> <h3 id=metropolis_and_metropolis-hastings ><a href="#metropolis_and_metropolis-hastings" class=header-anchor >Metropolis and Metropolis-Hastings</a></h3> <p>The first MCMC algorithm widely used to generate samples from Markov chain originated in physics in the 1950s &#40;in a very close relationship with the atomic bomb at the Manhattan project&#41; and is called <strong>Metropolis</strong> &#40;Metropolis, Rosenbluth, Rosenbluth, Teller, &amp; Teller, 1953&#41; in honor of the first author <a href="https://en.wikipedia.org/wiki/Nicholas_Metropolis">Nicholas Metropolis</a> &#40;figure above&#41;. In summary, the Metropolis algorithm is an adaptation of a random walk with an acceptance/rejection rule to converge to the target distribution.</p> <p>The Metropolis algorithm uses a <strong>proposal distribution</strong> <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>J</mi><mi>t</mi></msub><mo stretchy=false >(</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">J_t(\theta^*)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.09618em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi></mrow><annotation encoding="application/x-tex">J</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span></span></span></span> stands for <em>jumping distribution</em> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> indicates which state of the Markov chain we are in&#41; to define next values of the distribution <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>P</mi><mo>∗</mo></msup><mo stretchy=false >(</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo>∣</mo><mtext>data</mtext><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P^*(\theta^* \mid \text{data})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >data</span></span><span class=mclose >)</span></span></span></span>. This distribution must be symmetrical:</p> <a id=symjump  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>J</mi><mi>t</mi></msub><mo stretchy=false >(</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo>∣</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo><mo>=</mo><msub><mi>J</mi><mi>t</mi></msub><mo stretchy=false >(</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>∣</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> J_t (\theta^* \mid \theta^{t-1}) = J_t(\theta^{t-1} \mid \theta^*) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.09618em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.738696em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.09618em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.738696em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span></span> <p>In the 1970s, a generalization of the Metropolis algorithm emerged that <strong>does not</strong> require that the proposal distributions be symmetric. The generalization was proposed by <a href="https://en.wikipedia.org/wiki/W._K._Hastings">Wilfred Keith Hastings</a> &#40;Hastings, 1970&#41; &#40;figure below&#41; and is called <strong>Metropolis-Hastings algorithm</strong>.</p> <p><img src="/Bayesian-Julia/pages/images/hastings.jpg" alt="Wilfred Hastings" /></p> <p><div class=text-center ><em>Wilfred Hastings</em></div> <br/></p> <h4 id=metropolis_algorithm ><a href="#metropolis_algorithm" class=header-anchor >Metropolis Algorithm</a></h4> <p>The essence of the algorithm is a random walk through the parameters&#39; sample space, where the probability of the Markov chain changing state is defined as:</p> <a id=proposal  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>P</mi><mtext>change</mtext></msub><mo>=</mo><mi>min</mi><mo>⁡</mo><mrow><mo fence=true >(</mo><mfrac><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>proposed</mtext></msub><mo stretchy=false >)</mo></mrow><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>current</mtext></msub><mo stretchy=false >)</mo></mrow></mfrac><mo separator=true >,</mo><mn>1</mn><mo fence=true >)</mo></mrow></mrow><annotation encoding="application/x-tex"> P_{\text{change}} = \min \left( {\frac{P (\theta_{\text{proposed}})}{P (\theta_{\text{current}})}}, 1 \right) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">change</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=mop >min</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >1</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span> <p>This means that the Markov chain will only change to a new state under two conditions:</p> <ol> <li><p>When the probability of the parameters proposed by the random walk <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>proposed</mtext></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta_{\text{proposed}})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> is <strong>greater</strong> than the probability of the parameters of the current state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>current</mtext></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta_{\text{current}})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>, we change with 100&#37; probability. Note that if <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>proposed</mtext></msub><mo stretchy=false >)</mo><mo>&gt;</mo><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>current</mtext></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta_{\text{proposed}}) &gt; P(\theta_{\text{current}})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&gt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> then the function <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\min</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.66786em;vertical-align:0em;"></span><span class=mop >min</span></span></span></span> chooses the value 1 which means 100&#37;.</p> <li><p>When the probability of the parameters proposed by the random walk <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>proposed</mtext></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta_{\text{proposed}})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> is <strong>less</strong> than the probability of the parameters of the current state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>current</mtext></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta_{\text{current}})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>, we changed with a probability equal to the proportion of that difference. Note that if <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>proposed</mtext></msub><mo stretchy=false >)</mo><mo>&lt;</mo><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>current</mtext></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta_{\text{proposed}}) &lt; P(\theta_{\text{current}})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> then the function <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\min</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.66786em;vertical-align:0em;"></span><span class=mop >min</span></span></span></span><strong>does not</strong> choose the value 1, but the value <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>proposed</mtext></msub><mo stretchy=false >)</mo></mrow><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>current</mtext></msub><mo stretchy=false >)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{P(\theta_{\text{proposed}})}{P(\theta_{\text{current}})}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.55808em;vertical-align:-0.52em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.03808em;"><span style="top:-2.655em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.51308em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.29011428571428566em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> which equates the proportion of the probability of the proposed parameters to the probability of the parameters at the current state.</p> </ol> <p>Anyway, at each iteration of the Metropolis algorithm, even if the Markov chain changes state or not, we sample the parameter <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> anyway. That is, if the chain does not change to a new state, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> will be sampled twice &#40;or more if the current is stationary in the same state&#41;.</p> <p>The Metropolis-Hastings algorithm can be described in the following way <sup id="fnref:metropolis"><a href="#fndef:metropolis" class=fnref >[3]</a></sup> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> is the parameter, or set of parameters, of interest and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> is the data&#41;:</p> <ol> <li><p>Define a starting point <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>θ</mi><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">\theta^0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span> of which <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><msup><mi>θ</mi><mn>0</mn></msup><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">p(\theta^0 \mid y) &gt; 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&gt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>, or sample it from an initial distribution <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p_0(\theta)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span>. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p_0(\theta)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span> can be a normal distribution or a prior distribution of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">p(\theta)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span>&#41;.</p> <li><p>For <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1</mn><mo separator=true >,</mo><mn>2</mn><mo separator=true >,</mo><mo>…</mo></mrow><annotation encoding="application/x-tex">t = 1, 2, \dots</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class=mord >1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >2</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner >…</span></span></span></span>:</p> <ul> <li><p>Sample a proposed <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>θ</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">\theta^*</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span> from a proposal distribution in time <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>J</mi><mi>t</mi></msub><mo stretchy=false >(</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo>∣</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">J_t (\theta^* \mid \theta^{t-1})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.09618em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>.</p> <li><p>Calculate the ratio of probabilities:</p> <ul> <li><p><strong>Metropolis</strong>: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mfrac><mrow><mi>p</mi><mo stretchy=false >(</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo></mrow><mrow><mi>p</mi><mo stretchy=false >(</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">r = \frac{p(\theta^* \mid y)}{p(\theta^{t-1} \mid y)}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.53934em;vertical-align:-0.52em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.01934em;"><span style="top:-2.655em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7463142857142857em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mrel mtight">∣</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7633428571428571em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class="mrel mtight">∣</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p> <li><p><strong>Metropolis-Hastings</strong>: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mfrac><mfrac><mrow><mi>p</mi><mo stretchy=false >(</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo></mrow><mrow><msub><mi>J</mi><mi>t</mi></msub><mo stretchy=false >(</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo>∣</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo></mrow></mfrac><mfrac><mrow><mi>p</mi><mo stretchy=false >(</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo></mrow><mrow><msub><mi>J</mi><mi>t</mi></msub><mo stretchy=false >(</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>∣</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo stretchy=false >)</mo></mrow></mfrac></mfrac></mrow><annotation encoding="application/x-tex">r = \frac{\frac{p(\theta^* \mid y)}{J_t(\theta^* \mid \theta^{t-1})}}{\frac{p(\theta^{t-1} \mid y)}{J_t(\theta^{t-1} \mid \theta^*)}}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.68838em;vertical-align:-1.11148em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5769em;"><span style="top:-2.3693299999999997em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.1723857142857144em;"><span style="top:-2.5061857142857145em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.09618em;">J</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-left:-0.09618em;margin-right:0.1em;"><span class=pstrut  style="height:2.61508em;"></span><span class="mord mathnormal mtight">t</span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.27027999999999996em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.9384399999999999em;"><span style="top:-2.93844em;margin-right:0.1em;"><span class=pstrut  style="height:2.64444em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mrel mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7592800000000001em;"><span style="top:-2.794em;margin-right:0.1em;"><span class=pstrut  style="height:2.5em;"></span><span class="mbin mtight">∗</span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.2255000000000003em;"><span class=pstrut  style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.5020714285714285em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.9384399999999999em;"><span style="top:-2.93844em;margin-right:0.1em;"><span class=pstrut  style="height:2.64444em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mrel mtight">∣</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.6868714285714285em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.79081em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.1229857142857145em;"><span style="top:-2.5061857142857145em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.09618em;">J</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-left:-0.09618em;margin-right:0.1em;"><span class=pstrut  style="height:2.61508em;"></span><span class="mord mathnormal mtight">t</span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.27027999999999996em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7592800000000001em;"><span style="top:-2.794em;margin-right:0.1em;"><span class=pstrut  style="height:2.5em;"></span><span class="mbin mtight">∗</span></span></span></span></span></span></span><span class="mrel mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.9384399999999999em;"><span style="top:-2.93844em;margin-right:0.1em;"><span class=pstrut  style="height:2.64444em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.2255000000000003em;"><span class=pstrut  style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.5020714285714285em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.86928em;"><span style="top:-2.904em;margin-right:0.1em;"><span class=pstrut  style="height:2.5em;"></span><span class="mbin mtight">∗</span></span></span></span></span></span></span><span class="mrel mtight">∣</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mclose mtight">)</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.6868714285714285em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.11148em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p> </ul> <li><p>Assign:</p> <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>θ</mi><mi>t</mi></msup><mo>=</mo><mrow><mo fence=true >{</mo><mtable rowspacing=0.3600em  columnalign="left left" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msup><mi>θ</mi><mo>∗</mo></msup></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mtext>with probability </mtext><mi>min</mi><mo>⁡</mo><mo stretchy=false >(</mo><mi>r</mi><mo separator=true >,</mo><mn>1</mn><mo stretchy=false >)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mtext>otherwise</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex"> \theta^t = \begin{cases} \theta^* &amp; \text{with probability } \min (r, 1) \\ \theta^{t-1} &amp; \text{otherwise} \end{cases} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7935559999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7935559999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class=mord ><span class=mtable ><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.69em;"><span style="top:-3.69em;"><span class=pstrut  style="height:3.008em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class=pstrut  style="height:3.008em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.19em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:1em;"></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.69em;"><span style="top:-3.69em;"><span class=pstrut  style="height:3.008em;"></span><span class=mord ><span class="mord text"><span class=mord >with probability </span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >min</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >1</span><span class=mclose >)</span></span></span><span style="top:-2.25em;"><span class=pstrut  style="height:3.008em;"></span><span class=mord ><span class="mord text"><span class=mord >otherwise</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> </ul> </ol> <h4 id=limitations_of_the_metropolis_algorithm ><a href="#limitations_of_the_metropolis_algorithm" class=header-anchor >Limitations of the Metropolis Algorithm</a></h4> <p>The limitations of the Metropolis-Hastings algorithm are mainly computational. With randomly generated proposals, it usually takes a large number of iterations to enter areas of higher &#40;more likely&#41; posterior densities. Even efficient Metropolis-Hastings algorithms sometimes accept less than 25&#37; of the proposals &#40;Roberts, Gelman &amp; Gilks, 1997&#41;. In lower-dimensional situations, the increased computational power can compensate for the lower efficiency to some extent. But in higher-dimensional and more complex modeling situations, bigger and faster computers alone are rarely enough to overcome the challenge.</p> <h4 id=metropolis_implementation ><a href="#metropolis_implementation" class=header-anchor >Metropolis – Implementation</a></h4> <p>In our toy example we will assume that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>J</mi><mi>t</mi></msub><mo stretchy=false >(</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo>∣</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">J_t (\theta^* \mid \theta^{t-1})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.09618em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> is symmetric, thus <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>J</mi><mi>t</mi></msub><mo stretchy=false >(</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo>∣</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo><mo>=</mo><msub><mi>J</mi><mi>t</mi></msub><mo stretchy=false >(</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>∣</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">J_t(\theta^* \mid \theta^{t-1}) = J_t (\theta^{t-1} \mid \theta^*)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.09618em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.09618em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>, so I&#39;ll just implement the Metropolis algorithm &#40;not the Metropolis-Hastings algorithm&#41;.</p> <p>Below I created a Metropolis sampler for our toy example. At the end it prints the acceptance rate of the proposals. Here I am using the same proposal distribution for both <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>: a uniform distribution parameterized with a <code>width</code> parameter:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>X</mi><mo>∼</mo><mtext>Uniform</mtext><mrow><mo fence=true >(</mo><mi>X</mi><mo>−</mo><mfrac><mtext>width</mtext><mn>2</mn></mfrac><mo separator=true >,</mo><mi>X</mi><mo>+</mo><mfrac><mtext>width</mtext><mn>2</mn></mfrac><mo fence=true >)</mo></mrow><mspace linebreak=newline ></mspace><mi>Y</mi><mo>∼</mo><mtext>Uniform</mtext><mrow><mo fence=true >(</mo><mi>Y</mi><mo>−</mo><mfrac><mtext>width</mtext><mn>2</mn></mfrac><mo separator=true >,</mo><mi>Y</mi><mo>+</mo><mfrac><mtext>width</mtext><mn>2</mn></mfrac><mo fence=true >)</mo></mrow></mrow><annotation encoding="application/x-tex"> X \sim \text{Uniform} \left( X - \frac{\text{width}}{2}, X + \frac{\text{width}}{2} \right) \\ Y \sim \text{Uniform} \left( Y - \frac{\text{width}}{2}, Y + \frac{\text{width}}{2} \right) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord text"><span class=mord >Uniform</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >width</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >width</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span><span class="mspace newline"></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord text"><span class=mord >Uniform</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >width</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >width</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span> <p>I will use the already known <code>Distributions.jl</code> <code>MvNormal</code> from the plots above along with the <code>logpdf&#40;&#41;</code> function to calculate the PDF of the proposed and current <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span>s. It is easier to work with probability logs than with the absolute values<sup id="fnref:numerical"><a href="#fndef:numerical" class=fnref >[4]</a></sup>. Mathematically we will compute:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mi>r</mi></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mi mathvariant=normal >PDF</mi><mo>⁡</mo><mrow><mo fence=true >(</mo><mtext>Multivariate Normal</mtext><mrow><mo fence=true >(</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>x</mi><mtext>proposed</mtext></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>y</mi><mtext>proposed</mtext></msub></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo fence=true >)</mo></mrow><mo fence=false  stretchy=true  minsize=3em  maxsize=3em >∣</mo><mtext>Multivariate Normal</mtext><mrow><mo fence=true >(</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>μ</mi><mi>X</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>μ</mi><mi>Y</mi></msub></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo separator=true >,</mo><mi mathvariant=bold >Σ</mi><mo fence=true >)</mo></mrow><mo fence=true >)</mo></mrow></mrow><mrow><mi mathvariant=normal >PDF</mi><mo>⁡</mo><mrow><mo fence=true >(</mo><mtext>Multivariate Normal</mtext><mrow><mo fence=true >(</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>x</mi><mtext>current</mtext></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>y</mi><mtext>current</mtext></msub></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo fence=true >)</mo></mrow><mo fence=false  stretchy=true  minsize=3em  maxsize=3em >∣</mo><mtext>Multivariate Normal</mtext><mrow><mo fence=true >(</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>μ</mi><mi>X</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi>μ</mi><mi>Y</mi></msub></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo separator=true >,</mo><mi mathvariant=bold >Σ</mi><mo fence=true >)</mo></mrow><mo fence=true >)</mo></mrow></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mfrac><msub><mrow><mi mathvariant=normal >PDF</mi><mo>⁡</mo></mrow><mtext>proposed</mtext></msub><msub><mrow><mi mathvariant=normal >PDF</mi><mo>⁡</mo></mrow><mtext>current</mtext></msub></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mi>exp</mi><mo>⁡</mo><mo fence=false  stretchy=true  minsize=1.8em  maxsize=1.8em >(</mo><mi>log</mi><mo>⁡</mo><mrow><mo fence=true >(</mo><msub><mrow><mi mathvariant=normal >PDF</mi><mo>⁡</mo></mrow><mtext>proposed</mtext></msub><mo fence=true >)</mo></mrow><mo>−</mo><mi>log</mi><mo>⁡</mo><mrow><mo fence=true >(</mo><msub><mrow><mi mathvariant=normal >PDF</mi><mo>⁡</mo></mrow><mtext>current</mtext></msub><mo fence=true >)</mo></mrow><mo fence=false  stretchy=true  minsize=1.8em  maxsize=1.8em >)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex"> \begin{aligned} r &amp;= \frac{ \operatorname{PDF}\left( \text{Multivariate Normal} \left( \begin{bmatrix} x_{\text{proposed}} \\ y_{\text{proposed}} \end{bmatrix} \right) \Bigg| \text{Multivariate Normal} \left( \begin{bmatrix} \mu_X \\ \mu_Y \end{bmatrix}, \mathbf{\Sigma} \right) \right)} { \operatorname{PDF}\left( \text{Multivariate Normal} \left( \begin{bmatrix} x_{\text{current}} \\ y_{\text{current}} \end{bmatrix} \right) \Bigg| \text{Multivariate Normal} \left( \begin{bmatrix} \mu_X \\ \mu_Y \end{bmatrix}, \mathbf{\Sigma} \right) \right)}\\ &amp;=\frac{\operatorname{PDF}_{\text{proposed}}}{\operatorname{PDF}_{\text{current}}}\\ &amp;= \exp\Big( \log\left(\operatorname{PDF}_{\text{proposed}}\right) - \log\left(\operatorname{PDF}_{\text{current}}\right) \Big) \end{aligned} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:11.200420000000001em;vertical-align:-5.3502100000000015em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:5.850210000000001em;"><span style="top:-7.850210000000001em;"><span class=pstrut  style="height:5.402035em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.287845em;"><span class=pstrut  style="height:5.402035em;"></span><span class=mord ></span></span><span style="top:-1.0018449999999983em;"><span class=pstrut  style="height:5.402035em;"></span><span class=mord ></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:5.3502100000000015em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:5.850210000000001em;"><span style="top:-7.850210000000001em;"><span class=pstrut  style="height:5.402035em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.4020349999999997em;"><span style="top:-2.1100000000000003em;"><span class=pstrut  style="height:3.762005em;"></span><span class=mord ><span class=mop ><span class="mord mathrm">PDF</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mord text"><span class=mord >Multivariate Normal</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.7620049999999998em;"><span style="top:-2.5660049999999996em;"><span class=pstrut  style="height:3.8160299999999996em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-3.1640049999999995em;"><span class=pstrut  style="height:3.8160299999999996em;"></span><span style="height:1.8160299999999998em;width:0.333em;"><svg width='0.333em' height='1.8160299999999998em' style='width:0.333em' viewBox='0 0 333 1816' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V1816 H145z M145 0 H188 V1816 H145z'/></svg></span></span><span style="top:-4.972035em;"><span class=pstrut  style="height:3.8160299999999996em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.250025em;"><span></span></span></span></span></span></span><span class="mord text"><span class=mord >Multivariate Normal</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathbf">Σ</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span><span style="top:-3.992005em;"><span class=pstrut  style="height:3.762005em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-5.402035em;"><span class=pstrut  style="height:3.762005em;"></span><span class=mord ><span class=mop ><span class="mord mathrm">PDF</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mord text"><span class=mord >Multivariate Normal</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.7620049999999998em;"><span style="top:-2.5660049999999996em;"><span class=pstrut  style="height:3.8160299999999996em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-3.1640049999999995em;"><span class=pstrut  style="height:3.8160299999999996em;"></span><span style="height:1.8160299999999998em;width:0.333em;"><svg width='0.333em' height='1.8160299999999998em' style='width:0.333em' viewBox='0 0 333 1816' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V1816 H145z M145 0 H188 V1816 H145z'/></svg></span></span><span style="top:-4.972035em;"><span class=pstrut  style="height:3.8160299999999996em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.250025em;"><span></span></span></span></span></span></span><span class="mord text"><span class=mord >Multivariate Normal</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathbf">Σ</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.9020349999999997em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.287845em;"><span class=pstrut  style="height:5.402035em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mop ><span class=mop ><span class="mord mathrm">PDF</span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mop ><span class=mop ><span class="mord mathrm">PDF</span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-1.0018449999999983em;"><span class=pstrut  style="height:5.402035em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mop >exp</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="delimsizing size2">(</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >lo<span style="margin-right:0.01389em;">g</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class=mop ><span class=mop ><span class="mord mathrm">PDF</span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mop >lo<span style="margin-right:0.01389em;">g</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class=mop ><span class=mop ><span class="mord mathrm">PDF</span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="delimsizing size2">)</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:5.3502100000000015em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>Here is a simple implementation in Julia:</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> metropolis(
    S::<span class=hljs-built_in >Int64</span>,
    width::<span class=hljs-built_in >Float64</span>,
    ρ::<span class=hljs-built_in >Float64</span>;
    μ_x::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >0.0</span>,
    μ_y::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >0.0</span>,
    σ_x::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >1.0</span>,
    σ_y::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >1.0</span>,
    start_x=-<span class=hljs-number >2.5</span>,
    start_y=<span class=hljs-number >2.5</span>,
    seed=<span class=hljs-number >123</span>,
)
    rgn = MersenneTwister(seed)
    binormal = MvNormal([μ_x; μ_y], [σ_x ρ; ρ σ_y])
    draws = <span class=hljs-built_in >Matrix</span>{<span class=hljs-built_in >Float64</span>}(<span class=hljs-literal >undef</span>, S, <span class=hljs-number >2</span>)
    accepted = <span class=hljs-number >0</span>::<span class=hljs-built_in >Int64</span>
    x = start_x
    y = start_y
    <span class=hljs-meta >@inbounds</span> draws[<span class=hljs-number >1</span>, :] = [x y]
    <span class=hljs-keyword >for</span> s <span class=hljs-keyword >in</span> <span class=hljs-number >2</span>:S
        x_ = rand(rgn, Uniform(x - width, x + width))
        y_ = rand(rgn, Uniform(y - width, y + width))
        r = exp(logpdf(binormal, [x_, y_]) - logpdf(binormal, [x, y]))

        <span class=hljs-keyword >if</span> r &gt; rand(rgn, Uniform())
            x = x_
            y = y_
            accepted += <span class=hljs-number >1</span>
        <span class=hljs-keyword >end</span>
        <span class=hljs-meta >@inbounds</span> draws[s, :] = [x y]
    <span class=hljs-keyword >end</span>
    println(<span class=hljs-string >&quot;Acceptance rate is: <span class=hljs-subst >$(accepted / S)</span>&quot;</span>)
    <span class=hljs-keyword >return</span> draws
<span class=hljs-keyword >end</span></code></pre><pre><code class="plaintext hljs">metropolis (generic function with 1 method)</code></pre>
<p>Now let&#39;s run our <code>metropolis&#40;&#41;</code> algorithm for the bivariate normal case with <code>S &#61; 10_000</code>, <code>width &#61; 2.75</code> and <code>ρ &#61; 0.8</code>:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >const</span> S = <span class=hljs-number >10_000</span>
<span class=hljs-keyword >const</span> width = <span class=hljs-number >2.75</span>
<span class=hljs-keyword >const</span> ρ = <span class=hljs-number >0.8</span>

X_met = metropolis(S, width, ρ);</code></pre><pre><code class="plaintext hljs">Acceptance rate is: 0.2134
</code></pre>
<p>Take a quick peek into <code>X_met</code>, we&#39;ll see it&#39;s a matrix of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> values as columns and the time <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> as rows:</p>
<pre><code class="julia hljs">X_met[<span class=hljs-number >1</span>:<span class=hljs-number >10</span>, :]</code></pre><pre><code class="plaintext hljs">10×2 Matrix{Float64}:
 -2.5  2.5
 -2.5  2.5
 -2.5  2.5
 -2.5  2.5
 -2.5  2.5
 -2.5  2.5
 -2.5  2.5
 -2.5  2.5
 -2.5  2.5
 -2.5  2.5</code></pre>
<p>Also note that the acceptance of the proposals was 21&#37;, the expected for Metropolis algorithms &#40;around 20-25&#37;&#41; &#40;Roberts et. al, 1997&#41;.</p>
<p>We can construct <code>Chains</code> object using <code>MCMCChains.jl</code><sup id="fnref:mcmcchains"><a href="#fndef:mcmcchains" class=fnref >[5]</a></sup> by passing a matrix along with the parameters names as symbols inside the <code>Chains&#40;&#41;</code> constructor:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> MCMCChains

chain_met = Chains(X_met, [:X, :Y]);</code></pre>
<p>Then we can get summary statistics regarding our Markov chain derived from the Metropolis algorithm:</p>
<pre><code class="julia hljs">summarystats(chain_met)</code></pre><pre><code class="plaintext hljs">Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   ess_per_sec
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64       Missing

           X   -0.0147    1.0361    0.0356   860.6676   982.0454    1.0000       missing
           Y    0.0391    1.0319    0.0356   864.4481   913.9500    1.0005       missing
</code></pre>
<p>Both of <code>X</code> and <code>Y</code> have mean close to 0 and standard deviation close to 1 &#40;which are the theoretical values&#41;. Take notice of the <code>ess</code> &#40;effective sample size - ESS&#41; is approximate 1,000. So let&#39;s calculate the efficiency of our Metropolis algorithm by dividing the ESS by the number of sampling iterations that we&#39;ve performed:</p>
<a id=ess  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mtext>efficiency</mtext><mo>=</mo><mfrac><mtext>ESS</mtext><mtext>iterations</mtext></mfrac></mrow><annotation encoding="application/x-tex"> \text{efficiency} = \frac{\text{ESS}}{\text{iterations}}  </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class=mord >efficiency</span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >iterations</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >ESS</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<pre><code class="julia hljs">mean(summarystats(chain_met)[:, :ess_tail]) / S</code></pre><pre><code class="plaintext hljs">0.09479976973933983</code></pre>
<p>Our Metropolis algorithm has around 10.2&#37; efficiency. Which, in my honest opinion, <em>sucks</em>...&#40;😂&#41;</p>
<h5 id=metropolis_visual_intuition ><a href="#metropolis_visual_intuition" class=header-anchor >Metropolis – Visual Intuition</a></h5>
<p>I believe that a good visual intuition, even if you have not understood any mathematical formula, is the key for you to start a fruitful learning journey. So I made some animations&#33;</p>
<p>The animation in figure below shows the first 100 simulations of the Metropolis algorithm used to generate <code>X_met</code>. Note that in several iterations the proposal is rejected and the algorithm samples the parameters <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\theta_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\theta_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> from the previous state &#40;which becomes the current one, since the proposal is refused&#41;. The blue ellipsis represents the 90&#37; HPD of our toy example&#39;s bivariate normal distribution.</p>
<p>Note: <code>HPD</code> stands for <em>Highest Probability Density</em> &#40;which in our case the posterior&#39;s 90&#37; probability range&#41;.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> LinearAlgebra: eigvals, eigvecs
<span class=hljs-comment >#source: https://discourse.julialang.org/t/plot-ellipse-in-makie/82814/4</span>
<span class=hljs-keyword >function</span> getellipsepoints(cx, cy, rx, ry, θ)
    t = range(<span class=hljs-number >0</span>, <span class=hljs-number >2</span> * <span class=hljs-literal >pi</span>; length=<span class=hljs-number >100</span>)
    ellipse_x_r = @. rx * cos(t)
    ellipse_y_r = @. ry * sin(t)
    R = [cos(θ) sin(θ); -sin(θ) cos(θ)]
    r_ellipse = [ellipse_x_r ellipse_y_r] * R
    x = @. cx + r_ellipse[:, <span class=hljs-number >1</span>]
    y = @. cy + r_ellipse[:, <span class=hljs-number >2</span>]
    <span class=hljs-keyword >return</span> (x, y)
<span class=hljs-keyword >end</span>
<span class=hljs-keyword >function</span> getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.95</span>)
    quant = sqrt(quantile(Chisq(<span class=hljs-number >2</span>), confidence))
    cx = μ[<span class=hljs-number >1</span>]
    cy = μ[<span class=hljs-number >2</span>]

    egvs = eigvals(Σ)
    <span class=hljs-keyword >if</span> egvs[<span class=hljs-number >1</span>] &gt; egvs[<span class=hljs-number >2</span>]
        idxmax = <span class=hljs-number >1</span>
        largestegv = egvs[<span class=hljs-number >1</span>]
        smallesttegv = egvs[<span class=hljs-number >2</span>]
    <span class=hljs-keyword >else</span>
        idxmax = <span class=hljs-number >2</span>
        largestegv = egvs[<span class=hljs-number >2</span>]
        smallesttegv = egvs[<span class=hljs-number >1</span>]
    <span class=hljs-keyword >end</span>

    rx = quant * sqrt(largestegv)
    ry = quant * sqrt(smallesttegv)

    eigvecmax = eigvecs(Σ)[:, idxmax]
    θ = atan(eigvecmax[<span class=hljs-number >2</span>] / eigvecmax[<span class=hljs-number >1</span>])
    <span class=hljs-keyword >if</span> θ &lt; <span class=hljs-number >0</span>
        θ += <span class=hljs-number >2</span> * <span class=hljs-literal >π</span>
    <span class=hljs-keyword >end</span>

    <span class=hljs-keyword >return</span> getellipsepoints(cx, cy, rx, ry, θ)
<span class=hljs-keyword >end</span>

f, ax, l = lines(
    getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.9</span>)...;
    label=<span class=hljs-string >&quot;90% HPD&quot;</span>,
    linewidth=<span class=hljs-number >2</span>,
    axis=(; limits=(-<span class=hljs-number >3</span>, <span class=hljs-number >3</span>, -<span class=hljs-number >3</span>, <span class=hljs-number >3</span>), xlabel=<span class=hljs-string >L&quot;\theta_1&quot;</span>, ylabel=<span class=hljs-string >L&quot;\theta_2&quot;</span>),
)
axislegend(ax)
record(f, joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;met_anim.gif&quot;</span>); framerate=<span class=hljs-number >5</span>) <span class=hljs-keyword >do</span> frame
    <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >100</span>
        scatter!(ax, (X_met[i, <span class=hljs-number >1</span>], X_met[i, <span class=hljs-number >2</span>]); color=(:red, <span class=hljs-number >0.5</span>))
        linesegments!(X_met[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >1</span>], X_met[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >2</span>]; color=(:green, <span class=hljs-number >0.5</span>))
        recordframe!(frame)
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>;</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/met_anim.gif" alt=""> <div class=text-center ><em>Animation of the First 100 Samples Generated from the Metropolis Algorithm</em></div> <br/></p>
<p>Now let&#39;s take a look how the first 1,000 simulations were, excluding 1,000 initial iterations as warm-up.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >const</span> warmup = <span class=hljs-number >1_000</span>

f, ax, l = lines(
    getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.9</span>)...;
    label=<span class=hljs-string >&quot;90% HPD&quot;</span>,
    linewidth=<span class=hljs-number >2</span>,
    axis=(; limits=(-<span class=hljs-number >3</span>, <span class=hljs-number >3</span>, -<span class=hljs-number >3</span>, <span class=hljs-number >3</span>), xlabel=<span class=hljs-string >L&quot;\theta_1&quot;</span>, ylabel=<span class=hljs-string >L&quot;\theta_2&quot;</span>),
)
axislegend(ax)
scatter!(
    ax,
    X_met[warmup:(warmup + <span class=hljs-number >1_000</span>), <span class=hljs-number >1</span>],
    X_met[warmup:(warmup + <span class=hljs-number >1_000</span>), <span class=hljs-number >2</span>];
    color=(:red, <span class=hljs-number >0.3</span>),
)</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/met_first1000.svg" alt=""> <div class=text-center ><em>First 1,000 Samples Generated from the Metropolis Algorithm after warm-up</em></div> <br/></p>
<p>And, finally, lets take a look in the all 9,000 samples generated after the warm-up of 1,000 iterations.</p>
<pre><code class="julia hljs">f, ax, l = lines(
    getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.9</span>)...;
    label=<span class=hljs-string >&quot;90% HPD&quot;</span>,
    linewidth=<span class=hljs-number >2</span>,
    axis=(; limits=(-<span class=hljs-number >3</span>, <span class=hljs-number >3</span>, -<span class=hljs-number >3</span>, <span class=hljs-number >3</span>), xlabel=<span class=hljs-string >L&quot;\theta_1&quot;</span>, ylabel=<span class=hljs-string >L&quot;\theta_2&quot;</span>),
)
axislegend(ax)
scatter!(ax, X_met[warmup:<span class=hljs-keyword >end</span>, <span class=hljs-number >1</span>], X_met[warmup:<span class=hljs-keyword >end</span>, <span class=hljs-number >2</span>]; color=(:red, <span class=hljs-number >0.3</span>))</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/met_all.svg" alt=""> <div class=text-center ><em>All 9,000 Samples Generated from the Metropolis Algorithm after warm-up</em></div> <br/></p>
<h3 id=gibbs ><a href="#gibbs" class=header-anchor >Gibbs</a></h3>
<p>To circumvent the problem of low acceptance rate of the Metropolis &#40;and Metropolis-Hastings&#41; algorithm, the Gibbs algorithm was developed, which does not have an acceptance/rejection rule for new proposals to change the state of the Markov chain. <strong>All proposals are accepted</strong>.</p>
<p>Gibbs&#39; algorithm had an original idea conceived by physicist Josiah Willard Gibbs &#40;figure below&#41;, in reference to an analogy between a sampling algorithm and statistical physics &#40;a branch of physics which is based on statistical mechanics&#41;. The algorithm was described by brothers Stuart and Donald Geman in 1984 &#40;Geman &amp; Geman, 1984&#41;, about eight decades after Gibbs&#39;s death.</p>
<p><img src="/Bayesian-Julia/pages/images/josiah_gibbs.jpg" alt="Josiah Gibbs" /></p>
<p><div class=text-center ><em>Josiah Gibbs</em></div> <br/></p>
<p>The Gibbs algorithm is very useful in multidimensional sample spaces &#40;in which there are more than 2 parameters to be sampled for the posterior probability&#41;. It is also known as <strong>alternating conditional sampling</strong>, since we always sample a parameter <strong>conditioned</strong> to the probability of the other parameters.</p>
<p>The Gibbs algorithm can be seen as a <strong>special case</strong> of the Metropolis-Hastings algorithm because all proposals are accepted &#40;Gelman, 1992&#41;.</p>
<h4 id=gibbs_algorithm ><a href="#gibbs_algorithm" class=header-anchor >Gibbs Algorithm</a></h4>
<p>The essence of Gibbs&#39; algorithm is an iterative sampling of parameters conditioned to other parameters <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo>∣</mo><msub><mi>θ</mi><mn>2</mn></msub><mo separator=true >,</mo><mo>…</mo><msub><mi>θ</mi><mi>n</mi></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta_1 \mid \theta_2, \dots \theta_n)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner >…</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>.</p>
<p>Gibbs&#39;s algorithm can be described in the following way<sup id="fnref:gibbs"><a href="#fndef:gibbs" class=fnref >[6]</a></sup> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> is the parameter, or set of parameters, of interest and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> is the data&#41;:</p>
<ol>
<li><p>Define <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy=false >)</mo><mo separator=true >,</mo><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mn>2</mn></msub><mo stretchy=false >)</mo><mo separator=true >,</mo><mo>…</mo><mo separator=true >,</mo><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mi>n</mi></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta_1), P(\theta_2), \dots, P(\theta_n)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner >…</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>: the prior probability of each of the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">\theta_n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> parameters.</p>

<li><p>Sample a starting point <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>θ</mi><mn>1</mn><mn>0</mn></msubsup><mo separator=true >,</mo><msubsup><mi>θ</mi><mn>2</mn><mn>0</mn></msubsup><mo separator=true >,</mo><mo>…</mo><mo separator=true >,</mo><msubsup><mi>θ</mi><mi>n</mi><mn>0</mn></msubsup></mrow><annotation encoding="application/x-tex">\theta^0_1, \theta^0_2, \dots, \theta^0_n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.0622159999999998em;vertical-align:-0.24810799999999997em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner >…</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>. We usually sample from a normal distribution or from a distribution specified as the prior distribution of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">\theta_n</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p>

<li><p>For <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1</mn><mo separator=true >,</mo><mn>2</mn><mo separator=true >,</mo><mo>…</mo></mrow><annotation encoding="application/x-tex">t = 1, 2, \dots</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class=mord >1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >2</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner >…</span></span></span></span>:</p>
<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable rowspacing=0.2500em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msubsup><mi>θ</mi><mn>1</mn><mi>t</mi></msubsup></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mi>p</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo>∣</mo><msubsup><mi>θ</mi><mn>2</mn><mn>0</mn></msubsup><mo separator=true >,</mo><mo>…</mo><mo separator=true >,</mo><msubsup><mi>θ</mi><mi>n</mi><mn>0</mn></msubsup><mo stretchy=false >)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msubsup><mi>θ</mi><mn>2</mn><mi>t</mi></msubsup></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mi>p</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mn>2</mn></msub><mo>∣</mo><msubsup><mi>θ</mi><mn>1</mn><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo separator=true >,</mo><mo>…</mo><mo separator=true >,</mo><msubsup><mi>θ</mi><mi>n</mi><mn>0</mn></msubsup><mo stretchy=false >)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mi><mi mathvariant=normal >⋮</mi><mpadded height="+0em" voffset=0em ><mspace mathbackground=black  width=0em  height=1.5em ></mspace></mpadded></mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msubsup><mi>θ</mi><mi>n</mi><mi>t</mi></msubsup></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mi>p</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mi>n</mi></msub><mo>∣</mo><msubsup><mi>θ</mi><mn>1</mn><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo separator=true >,</mo><mo>…</mo><mo separator=true >,</mo><msubsup><mi>θ</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mo stretchy=false >)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
    \theta^t_1 &amp;\sim p(\theta_1 \mid \theta^0_2, \dots, \theta^0_n) \\
    \theta^t_2 &amp;\sim p(\theta_2 \mid \theta^{t-1}_1, \dots, \theta^0_n) \\
    &amp;\vdots \\
    \theta^t_n &amp;\sim p(\theta_n \mid \theta^{t-1}_1, \dots, \theta^{t-1}_{n-1})
    \end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:6.732324em;vertical-align:-3.116162em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.616162em;"><span style="top:-6.252054em;"><span class=pstrut  style="height:3.5em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8435559999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span></span></span><span style="top:-4.727946em;"><span class=pstrut  style="height:3.5em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8435559999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.567946em;"><span class=pstrut  style="height:3.5em;"></span><span class=mord ></span></span><span style="top:-1.043838em;"><span class=pstrut  style="height:3.5em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8435559999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:3.116162em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.616162em;"><span style="top:-6.439554em;"><span class=pstrut  style="height:3.6875em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner >…</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-4.915446em;"><span class=pstrut  style="height:3.6875em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-2.4435610000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.256439em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner >…</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-2.755446em;"><span class=pstrut  style="height:3.6875em;"></span><span class=mord ><span class=mord ></span><span class=mord ><span class=mord >⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"></span></span></span></span><span style="top:-1.231338em;"><span class=pstrut  style="height:3.6875em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-2.4435610000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.256439em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner >…</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-2.443561em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.31477em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:3.116162em;"><span></span></span></span></span></span></span></span></span></span></span>

</ol>
<h4 id=limitations_of_the_gibbs_algorithm ><a href="#limitations_of_the_gibbs_algorithm" class=header-anchor >Limitations of the Gibbs Algorithm</a></h4>
<p>The main limitation of the Gibbs algorithm is with regard to alternative conditional sampling.</p>
<p>If we compare with the Metropolis algorithm &#40;and consequently Metropolis-Hastings&#41; we have random proposals from a proposal distribution in which we sample each parameter unconditionally to other parameters. In order for the proposals to take us to the posterior probability&#39;s correct locations to sample, we have an acceptance/rejection rule for these proposals, otherwise the samples of the Metropolis algorithm would not approach the target distribution of interest. The state changes of the Markov chain are then carried out multidimensionally <sup id="fnref:gibbs2"><a href="#fndef:gibbs2" class=fnref >[7]</a></sup>. As you saw in the Metropolis&#39; figures, in a 2-D space &#40;as is our example&#39;s bivariate normal distribution&#41;, when there is a change of state in the Markov chain, the new proposal location considers both <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\theta_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\theta_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, causing <strong>diagonal</strong> movement in space 2-D sample. In other words, the proposal is done regarding all dimensions of the parameter space.</p>
<p>In the case of the Gibbs algorithm, in our toy example, this movement occurs only in a single parameter, <em>i.e</em> single dimension, as we sample sequentially and conditionally to other parameters. This causes <strong>horizontal</strong> movements &#40;in the case of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\theta_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>&#41; and <strong>vertical movements</strong> &#40;in the case of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\theta_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>&#41;, but never diagonal movements like the ones we saw in the Metropolis algorithm.</p>
<h4 id=gibbs_implementation ><a href="#gibbs_implementation" class=header-anchor >Gibbs – Implementation</a></h4>
<p>Here are some new things compared to the Metropolis algorithm implementation. First to conditionally sample the parameters <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo>∣</mo><msub><mi>θ</mi><mn>2</mn></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta_1 \mid \theta_2)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mn>2</mn></msub><mo>∣</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta_2 \mid \theta_1)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>, we need to create two new variables <code>β</code> and <code>λ</code>. These variables represent the correlation between <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\theta_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\theta_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> respectively&#41; scaled by the ratio of the variance of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>. And then we use these variables in the sampling of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\theta_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\theta_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.84444em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>:</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mi>β</mi></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mi>ρ</mi><mo>⋅</mo><mfrac><msub><mi>σ</mi><mi>Y</mi></msub><msub><mi>σ</mi><mi>X</mi></msub></mfrac><mo>=</mo><mi>ρ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mi>λ</mi></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mi>ρ</mi><mo>⋅</mo><mfrac><msub><mi>σ</mi><mi>X</mi></msub><msub><mi>σ</mi><mi>Y</mi></msub></mfrac><mo>=</mo><mi>ρ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>σ</mi><mrow><mi>Y</mi><mi>X</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msup><mi>ρ</mi><mn>2</mn></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>σ</mi><mrow><mi>X</mi><mi>Y</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mn>1</mn><mo>−</mo><msup><mi>ρ</mi><mn>2</mn></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>θ</mi><mn>1</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mtext>Normal</mtext><mo fence=false  stretchy=true  minsize=2.4em  maxsize=2.4em >(</mo><msub><mi>μ</mi><mi>X</mi></msub><mo>+</mo><mi>λ</mi><mo>⋅</mo><mo stretchy=false >(</mo><msup><mi>y</mi><mo>∗</mo></msup><mo>−</mo><msub><mi>μ</mi><mi>Y</mi></msub><mo stretchy=false >)</mo><mo separator=true >,</mo><msub><mi>σ</mi><mrow><mi>X</mi><mi>Y</mi></mrow></msub><mo fence=false  stretchy=true  minsize=2.4em  maxsize=2.4em >)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>θ</mi><mn>2</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mtext>Normal</mtext><mo fence=false  stretchy=true  minsize=2.4em  maxsize=2.4em >(</mo><msub><mi>μ</mi><mi>y</mi></msub><mo>+</mo><mi>β</mi><mo>⋅</mo><mo stretchy=false >(</mo><msup><mi>x</mi><mo>∗</mo></msup><mo>−</mo><msub><mi>μ</mi><mi>X</mi></msub><mo stretchy=false >)</mo><mo separator=true >,</mo><msub><mi>σ</mi><mrow><mi>Y</mi><mi>X</mi></mrow></msub><mo fence=false  stretchy=true  minsize=2.4em  maxsize=2.4em >)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
\beta &amp;= \rho \cdot \frac{\sigma_Y}{\sigma_X} = \rho \\
\lambda &amp;= \rho \cdot \frac{\sigma_X}{\sigma_Y} = \rho \\
\sigma_{YX} &amp;= 1 - \rho^2\\
\sigma_{XY} &amp;= 1 - \rho^2\\
\theta_1 &amp;\sim \text{Normal} \bigg( \mu_X + \lambda \cdot (y^* - \mu_Y), \sigma_{XY} \bigg) \\
\theta_2 &amp;\sim \text{Normal} \bigg( \mu_y + \beta \cdot (x^* - \mu_X), \sigma_{YX} \bigg)
\end{aligned}
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:12.935396em;vertical-align:-6.217698em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:6.717698em;"><span style="top:-9.060138000000002em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span><span style="top:-6.816578em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class="mord mathnormal">λ</span></span></span><span style="top:-4.816470000000001em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.2923620000000002em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.1823620000000004em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:1.517668em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:6.217698em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:6.717698em;"><span style="top:-9.060138000000002em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">ρ</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.1075599999999999em;"><span style="top:-2.3139999999999996em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">ρ</span></span></span><span style="top:-6.816578em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">ρ</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.1075599999999999em;"><span style="top:-2.3139999999999996em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">ρ</span></span></span><span style="top:-4.816470000000001em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">ρ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.2923620000000002em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">ρ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-1.1823620000000004em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class=mord >Normal</span></span><span class=mord ><span class="delimsizing size3">(</span></span><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">λ</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.738696em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="delimsizing size3">)</span></span></span></span><span style="top:1.517668em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class=mord >Normal</span></span><span class=mord ><span class="delimsizing size3">(</span></span><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.738696em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="delimsizing size3">)</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:6.217698em;"><span></span></span></span></span></span></span></span></span></span></span></span>
<pre><code class="julia hljs"><span class=hljs-keyword >function</span> gibbs(
    S::<span class=hljs-built_in >Int64</span>,
    ρ::<span class=hljs-built_in >Float64</span>;
    μ_x::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >0.0</span>,
    μ_y::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >0.0</span>,
    σ_x::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >1.0</span>,
    σ_y::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >1.0</span>,
    start_x=-<span class=hljs-number >2.5</span>,
    start_y=<span class=hljs-number >2.5</span>,
    seed=<span class=hljs-number >123</span>,
)
    rgn = MersenneTwister(seed)
    binormal = MvNormal([μ_x; μ_y], [σ_x ρ; ρ σ_y])
    draws = <span class=hljs-built_in >Matrix</span>{<span class=hljs-built_in >Float64</span>}(<span class=hljs-literal >undef</span>, S, <span class=hljs-number >2</span>)
    x = start_x
    y = start_y
    β = ρ * σ_y / σ_x
    λ = ρ * σ_x / σ_y
    sqrt1mrho2 = sqrt(<span class=hljs-number >1</span> - ρ^<span class=hljs-number >2</span>)
    σ_YX = σ_y * sqrt1mrho2
    σ_XY = σ_x * sqrt1mrho2
    <span class=hljs-meta >@inbounds</span> draws[<span class=hljs-number >1</span>, :] = [x y]
    <span class=hljs-keyword >for</span> s <span class=hljs-keyword >in</span> <span class=hljs-number >2</span>:S
        <span class=hljs-keyword >if</span> s % <span class=hljs-number >2</span> == <span class=hljs-number >0</span>
            y = rand(rgn, Normal(μ_y + β * (x - μ_x), σ_YX))
        <span class=hljs-keyword >else</span>
            x = rand(rgn, Normal(μ_x + λ * (y - μ_y), σ_XY))
        <span class=hljs-keyword >end</span>
        <span class=hljs-meta >@inbounds</span> draws[s, :] = [x y]
    <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >return</span> draws
<span class=hljs-keyword >end</span></code></pre><pre><code class="plaintext hljs">gibbs (generic function with 1 method)</code></pre>
<p>Generally a Gibbs sampler is not implemented in this way. Here I coded the Gibbs algorithm so that it samples a parameter for each iteration. To be more computationally efficient we would sample all parameters are on each iteration. I did it on purpose because I want to show in the animations the real trajectory of the Gibbs sampler in the sample space &#40;vertical and horizontal, not diagonal&#41;. So to remedy this I will provide <code>gibbs&#40;&#41;</code> double the amount of <code>S</code> &#40;20,000 in total&#41;. Also take notice that we are now proposing new parameters&#39; values conditioned on other parameters, so there is not an acceptance/rejection rule here.</p>
<pre><code class="julia hljs">X_gibbs = gibbs(S * <span class=hljs-number >2</span>, ρ);</code></pre>
<p>As before lets&#39; take a quick peek into <code>X_gibbs</code>, we&#39;ll see it&#39;s a matrix of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> values as columns and the time <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> as rows:</p>
<pre><code class="julia hljs">X_gibbs[<span class=hljs-number >1</span>:<span class=hljs-number >10</span>, :]</code></pre><pre><code class="plaintext hljs">10×2 Matrix{Float64}:
 -2.5        2.5
 -2.5       -1.80589
 -2.5861    -1.80589
 -2.5861    -1.97663
 -1.89849   -1.97663
 -1.89849   -1.08324
 -1.89147   -1.08324
 -1.89147   -0.953183
 -0.341054  -0.953183
 -0.341054  -1.37422</code></pre>
<p>Again, we construct a <code>Chains</code> object by passing a matrix along with the parameters names as symbols inside the <code>Chains&#40;&#41;</code> constructor:</p>
<pre><code class="julia hljs">chain_gibbs = Chains(X_gibbs, [:X, :Y]);</code></pre>
<p>Then we can get summary statistics regarding our Markov chain derived from the Gibbs algorithm:</p>
<pre><code class="julia hljs">summarystats(chain_gibbs)</code></pre><pre><code class="plaintext hljs">Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ess_per_sec
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64       Missing

           X    0.0100    0.9991    0.0207   2329.0330   4315.7661    1.0000       missing
           Y    0.0135    0.9902    0.0207   2277.7994   4095.9759    1.0001       missing
</code></pre>
<p>Both of <code>X</code> and <code>Y</code> have mean close to 0 and standard deviation close to 1 &#40;which are the theoretical values&#41;. Take notice of the <code>ess</code> &#40;effective sample size - ESS&#41; that is around 2,100. Since we used <code>S * 2</code> as the number of samples, in order for we to compare with Metropolis, we would need to divide the ESS by 2. So our ESS is between 1,000, which is similar to Metropolis&#39; ESS. Now let&#39;s calculate the efficiency of our Gibbs algorithm by dividing the ESS by the number of sampling iterations that we&#39;ve performed also accounting for the <code>S * 2</code>:</p>
<pre><code class="julia hljs">(mean(summarystats(chain_gibbs)[:, :ess_tail]) / <span class=hljs-number >2</span>) / S</code></pre><pre><code class="plaintext hljs">0.21029354959952115</code></pre>
<p>Our Gibbs algorithm has around 10.6&#37; efficiency. Which, in my honest opinion, despite the small improvement still <em>sucks</em>...&#40;😂&#41;</p>
<h5 id=gibbs_visual_intuition ><a href="#gibbs_visual_intuition" class=header-anchor >Gibbs – Visual Intuition</a></h5>
<p>Oh yes, we have animations for Gibbs also&#33;</p>
<p>The animation in figure below shows the first 100 simulations of the Gibbs algorithm used to generate <code>X_gibbs</code>. Note that all proposals are accepted now, so the at each iteration we sample new parameters values. The blue ellipsis represents the 90&#37; HPD of our toy example&#39;s bivariate normal distribution.</p>
<pre><code class="julia hljs">f, ax, l = lines(
    getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.9</span>)...;
    label=<span class=hljs-string >&quot;90% HPD&quot;</span>,
    linewidth=<span class=hljs-number >2</span>,
    axis=(; limits=(-<span class=hljs-number >3</span>, <span class=hljs-number >3</span>, -<span class=hljs-number >3</span>, <span class=hljs-number >3</span>), xlabel=<span class=hljs-string >L&quot;\theta_1&quot;</span>, ylabel=<span class=hljs-string >L&quot;\theta_2&quot;</span>),
)
axislegend(ax)
record(f, joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;gibbs_anim.gif&quot;</span>); framerate=<span class=hljs-number >5</span>) <span class=hljs-keyword >do</span> frame
    <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >200</span>
        scatter!(ax, (X_gibbs[i, <span class=hljs-number >1</span>], X_gibbs[i, <span class=hljs-number >2</span>]); color=(:red, <span class=hljs-number >0.5</span>))
        linesegments!(X_gibbs[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >1</span>], X_gibbs[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >2</span>]; color=(:green, <span class=hljs-number >0.5</span>))
        recordframe!(frame)
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>;</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/gibbs_anim.gif" alt=""> <div class=text-center ><em>Animation of the First 100 Samples Generated from the Gibbs Algorithm</em></div> <br/></p>
<p>Now let&#39;s take a look how the first 1,000 simulations were, excluding 1,000 initial iterations as warm-up.</p>
<pre><code class="julia hljs">f, ax, l = lines(
    getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.9</span>)...;
    label=<span class=hljs-string >&quot;90% HPD&quot;</span>,
    linewidth=<span class=hljs-number >2</span>,
    axis=(; limits=(-<span class=hljs-number >3</span>, <span class=hljs-number >3</span>, -<span class=hljs-number >3</span>, <span class=hljs-number >3</span>), xlabel=<span class=hljs-string >L&quot;\theta_1&quot;</span>, ylabel=<span class=hljs-string >L&quot;\theta_2&quot;</span>),
)
axislegend(ax)
scatter!(
    ax,
    X_gibbs[(<span class=hljs-number >2</span> * warmup):(<span class=hljs-number >2</span> * warmup + <span class=hljs-number >1_000</span>), <span class=hljs-number >1</span>],
    X_gibbs[(<span class=hljs-number >2</span> * warmup):(<span class=hljs-number >2</span> * warmup + <span class=hljs-number >1_000</span>), <span class=hljs-number >2</span>];
    color=(:red, <span class=hljs-number >0.3</span>),
)</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/gibbs_first1000.svg" alt=""> <div class=text-center ><em>First 1,000 Samples Generated from the Gibbs Algorithm after warm-up</em></div> <br/></p>
<p>And, finally, lets take a look in the all 9,000 samples generated after the warm-up of 1,000 iterations.</p>
<pre><code class="julia hljs">f, ax, l = lines(
    getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.9</span>)...;
    label=<span class=hljs-string >&quot;90% HPD&quot;</span>,
    linewidth=<span class=hljs-number >2</span>,
    axis=(; limits=(-<span class=hljs-number >3</span>, <span class=hljs-number >3</span>, -<span class=hljs-number >3</span>, <span class=hljs-number >3</span>), xlabel=<span class=hljs-string >L&quot;\theta_1&quot;</span>, ylabel=<span class=hljs-string >L&quot;\theta_2&quot;</span>),
)
axislegend(ax)
scatter!(ax, X_gibbs[(<span class=hljs-number >2</span> * warmup):<span class=hljs-keyword >end</span>, <span class=hljs-number >1</span>], X_gibbs[(<span class=hljs-number >2</span> * warmup):<span class=hljs-keyword >end</span>, <span class=hljs-number >2</span>]; color=(:red, <span class=hljs-number >0.3</span>))</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/gibbs_all.svg" alt=""> <div class=text-center ><em>All 9,000 Samples Generated from the Gibbs Algorithm after warm-up</em></div> <br/></p>
<h3 id=what_happens_when_we_run_markov_chains_in_parallel ><a href="#what_happens_when_we_run_markov_chains_in_parallel" class=header-anchor >What happens when we run Markov chains in parallel?</a></h3>
<p>Since the Markov chains are <strong>independent</strong>, we can run them in <strong>parallel</strong>. The key to this is <strong>defining different starting points for each Markov chain</strong> &#40;if you use a sample of a previous distribution of parameters as a starting point this is not a problem&#41;. We will use the same toy example of a bivariate normal distribution <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> that we used in the previous examples, but now with <strong>4 Markov chains in parallel with different starting points</strong><sup id="fnref:markovparallel"><a href="#fndef:markovparallel" class=fnref >[8]</a></sup>.</p>
<p>First, let&#39;s defined 4 different pairs of starting points using a nice Cartesian product from Julia&#39;s <code>Base.Iterators</code>:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >const</span> starts = collect(Iterators.product((-<span class=hljs-number >2.5</span>, <span class=hljs-number >2.5</span>), (<span class=hljs-number >2.5</span>, -<span class=hljs-number >2.5</span>)))</code></pre><pre><code class="plaintext hljs">2×2 Matrix{Tuple{Float64, Float64}}:
 (-2.5, 2.5)  (-2.5, -2.5)
 (2.5, 2.5)   (2.5, -2.5)</code></pre>
<p>Also, I will restrict this simulation to 100 samples:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >const</span> S_parallel = <span class=hljs-number >100</span>;</code></pre>
<p>Additionally, note that we are using different <code>seed</code>s:</p>
<pre><code class="julia hljs">X_met_1 = metropolis(
    S_parallel, width, ρ; seed=<span class=hljs-number >124</span>, start_x=first(starts[<span class=hljs-number >1</span>]), start_y=last(starts[<span class=hljs-number >1</span>])
);
X_met_2 = metropolis(
    S_parallel, width, ρ; seed=<span class=hljs-number >125</span>, start_x=first(starts[<span class=hljs-number >2</span>]), start_y=last(starts[<span class=hljs-number >2</span>])
);
X_met_3 = metropolis(
    S_parallel, width, ρ; seed=<span class=hljs-number >126</span>, start_x=first(starts[<span class=hljs-number >3</span>]), start_y=last(starts[<span class=hljs-number >3</span>])
);
X_met_4 = metropolis(
    S_parallel, width, ρ; seed=<span class=hljs-number >127</span>, start_x=first(starts[<span class=hljs-number >4</span>]), start_y=last(starts[<span class=hljs-number >4</span>])
);</code></pre><pre><code class="plaintext hljs">Acceptance rate is: 0.18
Acceptance rate is: 0.19
Acceptance rate is: 0.25
Acceptance rate is: 0.21
</code></pre>
<p>There have been some significant changes in the approval rate for Metropolis proposals. All were around 13&#37;-24&#37;, this is due to the low number of samples &#40;only 100 for each Markov chain&#41;, if the samples were larger we would see these values converge to close to 20&#37; according to the previous example of 10,000 samples with a single stream &#40;Roberts et. al, 1997&#41;.</p>
<p>Now let&#39;s take a look on how those 4 Metropolis Markov chains sample the parameter space starting from different positions. Each chain will have its own marker and path color, so that we can see their different behavior:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> Colors
<span class=hljs-keyword >const</span> logocolors = Colors.JULIA_LOGO_COLORS;
f, ax, l = lines(
    getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.9</span>)...;
    label=<span class=hljs-string >&quot;90% HPD&quot;</span>,
    linewidth=<span class=hljs-number >2</span>,
    axis=(; limits=(-<span class=hljs-number >3</span>, <span class=hljs-number >3</span>, -<span class=hljs-number >3</span>, <span class=hljs-number >3</span>), xlabel=<span class=hljs-string >L&quot;\theta_1&quot;</span>, ylabel=<span class=hljs-string >L&quot;\theta_2&quot;</span>),
)
axislegend(ax)
record(f, joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;parallel_met.gif&quot;</span>); framerate=<span class=hljs-number >5</span>) <span class=hljs-keyword >do</span> frame
    <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >99</span>
        scatter!(ax, (X_met_1[i, <span class=hljs-number >1</span>], X_met_1[i, <span class=hljs-number >2</span>]); color=(logocolors.blue, <span class=hljs-number >0.5</span>))
        linesegments!(
            X_met_1[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >1</span>], X_met_1[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >2</span>]; color=(logocolors.blue, <span class=hljs-number >0.5</span>)
        )
        scatter!(ax, (X_met_2[i, <span class=hljs-number >1</span>], X_met_2[i, <span class=hljs-number >2</span>]); color=(logocolors.red, <span class=hljs-number >0.5</span>))
        linesegments!(
            X_met_2[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >1</span>], X_met_2[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >2</span>]; color=(logocolors.red, <span class=hljs-number >0.5</span>)
        )
        scatter!(ax, (X_met_3[i, <span class=hljs-number >1</span>], X_met_3[i, <span class=hljs-number >2</span>]); color=(logocolors.green, <span class=hljs-number >0.5</span>))
        linesegments!(
            X_met_3[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >1</span>], X_met_3[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >2</span>]; color=(logocolors.green, <span class=hljs-number >0.5</span>)
        )
        scatter!(ax, (X_met_4[i, <span class=hljs-number >1</span>], X_met_4[i, <span class=hljs-number >2</span>]); color=(logocolors.purple, <span class=hljs-number >0.5</span>))
        linesegments!(
            X_met_4[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >1</span>], X_met_4[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >2</span>]; color=(logocolors.purple, <span class=hljs-number >0.5</span>)
        )
        recordframe!(frame)
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>;</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/parallel_met.gif" alt=""> <div class=text-center ><em>Animation of 4 Parallel Metropolis Markov Chains</em></div> <br/></p>
<p>Now we&#39;ll do the the same for Gibbs, taking care to provide also different <code>seed</code>s and starting points:</p>
<pre><code class="julia hljs">X_gibbs_1 = gibbs(
    S_parallel * <span class=hljs-number >2</span>, ρ; seed=<span class=hljs-number >124</span>, start_x=first(starts[<span class=hljs-number >1</span>]), start_y=last(starts[<span class=hljs-number >1</span>])
);
X_gibbs_2 = gibbs(
    S_parallel * <span class=hljs-number >2</span>, ρ; seed=<span class=hljs-number >125</span>, start_x=first(starts[<span class=hljs-number >2</span>]), start_y=last(starts[<span class=hljs-number >2</span>])
);
X_gibbs_3 = gibbs(
    S_parallel * <span class=hljs-number >2</span>, ρ; seed=<span class=hljs-number >126</span>, start_x=first(starts[<span class=hljs-number >3</span>]), start_y=last(starts[<span class=hljs-number >3</span>])
);
X_gibbs_4 = gibbs(
    S_parallel * <span class=hljs-number >2</span>, ρ; seed=<span class=hljs-number >127</span>, start_x=first(starts[<span class=hljs-number >4</span>]), start_y=last(starts[<span class=hljs-number >4</span>])
);</code></pre>
<p>Now let&#39;s take a look on how those 4 Gibbs Markov chains sample the parameter space starting from different positions. Each chain will have its own marker and path color, so that we can see their different behavior:</p>
<pre><code class="julia hljs">f, ax, l = lines(
    getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.9</span>)...;
    label=<span class=hljs-string >&quot;90% HPD&quot;</span>,
    linewidth=<span class=hljs-number >2</span>,
    axis=(; limits=(-<span class=hljs-number >3</span>, <span class=hljs-number >3</span>, -<span class=hljs-number >3</span>, <span class=hljs-number >3</span>), xlabel=<span class=hljs-string >L&quot;\theta_1&quot;</span>, ylabel=<span class=hljs-string >L&quot;\theta_2&quot;</span>),
)
axislegend(ax)
record(f, joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;parallel_gibbs.gif&quot;</span>); framerate=<span class=hljs-number >5</span>) <span class=hljs-keyword >do</span> frame
    <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >199</span>
        scatter!(ax, (X_gibbs_1[i, <span class=hljs-number >1</span>], X_gibbs_1[i, <span class=hljs-number >2</span>]); color=(logocolors.blue, <span class=hljs-number >0.5</span>))
        linesegments!(
            X_gibbs_1[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >1</span>], X_gibbs_1[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >2</span>]; color=(logocolors.blue, <span class=hljs-number >0.5</span>)
        )
        scatter!(ax, (X_gibbs_2[i, <span class=hljs-number >1</span>], X_gibbs_2[i, <span class=hljs-number >2</span>]); color=(logocolors.red, <span class=hljs-number >0.5</span>))
        linesegments!(
            X_gibbs_2[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >1</span>], X_gibbs_2[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >2</span>]; color=(logocolors.red, <span class=hljs-number >0.5</span>)
        )
        scatter!(ax, (X_gibbs_3[i, <span class=hljs-number >1</span>], X_gibbs_3[i, <span class=hljs-number >2</span>]); color=(logocolors.green, <span class=hljs-number >0.5</span>))
        linesegments!(
            X_gibbs_3[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >1</span>], X_gibbs_3[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >2</span>]; color=(logocolors.green, <span class=hljs-number >0.5</span>)
        )
        scatter!(ax, (X_gibbs_4[i, <span class=hljs-number >1</span>], X_gibbs_4[i, <span class=hljs-number >2</span>]); color=(logocolors.purple, <span class=hljs-number >0.5</span>))
        linesegments!(
            X_gibbs_4[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >1</span>], X_gibbs_4[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >2</span>]; color=(logocolors.purple, <span class=hljs-number >0.5</span>)
        )
        recordframe!(frame)
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>;</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/parallel_gibbs.gif" alt=""> <div class=text-center ><em>Animation of 4 Parallel Gibbs Markov Chains</em></div> <br/></p>
<h2 id=hamiltonian_monte_carlo_hmc ><a href="#hamiltonian_monte_carlo_hmc" class=header-anchor >Hamiltonian Monte Carlo – HMC</a></h2>
<p>The problems of low acceptance rates of proposals for Metropolis techniques and the low performance of the Gibbs algorithm in multidimensional problems &#40;in which the posterior&#39;s topology is quite complex&#41; led to the emergence of a new MCMC technique using Hamiltonian dynamics &#40;in honor of the Irish physicist <a href="https://en.wikipedia.org/wiki/William_Rowan_Hamilton"> William Rowan Hamilton</a> &#40;1805-1865&#41; &#40;figure below&#41;. The name for this technique is <em>Hamiltonian Monte Carlo</em> – HMC.</p>
<p><img src="/Bayesian-Julia/pages/images/hamilton.png" alt="William Rowan Hamilton" /></p>
<p><div class=text-center ><em>William Rowan Hamilton</em></div> <br/></p>
<p>The HMC is an adaptation of the Metropolis technique and employs a guided scheme for generating new proposals: this improves the proposal&#39;s acceptance rate and, consequently, efficiency. More specifically, the HMC uses the posterior log gradient to direct the Markov chain to regions of higher posterior density, where most samples are collected. As a result, a Markov chain with the well-adjusted HMC algorithm will accept proposals at a much higher rate than the traditional Metropolis algorithm &#40;Roberts et. al, 1997&#41;.</p>
<p>HMC was first described in the physics literature &#40;Duane, Kennedy, Pendleton &amp; Roweth, 1987&#41; &#40;which they called the <em>&quot;Hybrid&quot; Monte Carlo</em> – HMC&#41;. Soon after, HMC was applied to statistical problems by Neal &#40;1994&#41; &#40;which he called <em>Hamiltonean Monte Carlo</em> – HMC&#41;. For an in-depth discussion regarding HMC &#40;which is not the focus of this tutorial&#41;, I recommend Neal &#40;2011&#41; and Betancourt &#40;2017&#41;.</p>
<p>HMC uses Hamiltonian dynamics applied to particles exploring the topology of a posterior density. In some simulations Metropolis has an acceptance rate of approximately 23&#37;, while HMC 65&#37; &#40;Gelman et al., 2013b&#41;. In addition to better exploring the posterior&#39;s topology and tolerating complex topologies, HMC is much more efficient than Metropolis and does not suffer from the Gibbs&#39; parameter correlation problem.</p>
<p>For each component <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\theta_j</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.980548em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>, the HMC adds a momentum variable <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">\phi_j</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.980548em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>. The subsequent density <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\theta \mid y)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span></span></span></span> is increased by an independent distribution <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>ϕ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\phi)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal">ϕ</span><span class=mclose >)</span></span></span></span> of the momentum, thus defining a joint distribution:</p>
<a id=hmcjoint  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo separator=true >,</mo><mi>ϕ</mi><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo><mo>=</mo><mi>P</mi><mo stretchy=false >(</mo><mi>ϕ</mi><mo stretchy=false >)</mo><mo>⋅</mo><mi>P</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> P(\theta, \phi \mid y) = P(\phi) \cdot P(\theta \mid y)  </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">ϕ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal">ϕ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span></span></span></span></span>
<p>HMC uses a proposal distribution that changes depending on the current state in the Markov chain. The HMC discovers the direction in which the posterior distribution increases, called <em>gradient</em>, and distorts the distribution of proposals towards the <em>gradient</em>. In the Metropolis algorithm, the distribution of the proposals would be a &#40;usually&#41; Normal distribution centered on the current position, so that jumps above or below the current position would have the same probability of being proposed. But the HMC generates proposals quite differently.</p>
<p>You can imagine that for high-dimensional posterior densities that have <em>narrow diagonal valleys</em> and even <em>curved valleys</em>, the HMC dynamics will find proposed positions that are much more <strong>promising</strong> than a naive symmetric proposal distribution, and more promising than the Gibbs sampling, which can get stuck in <em>diagonal walls</em>.</p>
<p>The probability of the Markov chain changing state in the HMC algorithm is defined as:</p>
<a id=hmcproposal  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>P</mi><mtext>change</mtext></msub><mo>=</mo><mi>min</mi><mo>⁡</mo><mrow><mo fence=true >(</mo><mfrac><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>proposed</mtext></msub><mo stretchy=false >)</mo><mo>⋅</mo><mi>P</mi><mo stretchy=false >(</mo><msub><mi>ϕ</mi><mtext>proposed</mtext></msub><mo stretchy=false >)</mo></mrow><mrow><mi>P</mi><mo stretchy=false >(</mo><msub><mi>θ</mi><mtext>current</mtext></msub><mo stretchy=false >)</mo><mo>⋅</mo><mi>P</mi><mo stretchy=false >(</mo><msub><mi>ϕ</mi><mtext>current</mtext></msub><mo stretchy=false >)</mo></mrow></mfrac><mo separator=true >,</mo><mn>1</mn><mo fence=true >)</mo></mrow></mrow><annotation encoding="application/x-tex">
P_{\text{change}} = \min\left({\frac{P(\theta_{\text{proposed}}) \cdot
P(\phi_{\text{proposed}})}{P(\theta_{\text{current}})\cdot P(\phi_{\text{current}})}}, 1\right) 
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">change</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=mop >min</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">current</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">proposed</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >1</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span>
<p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> is the momentum.</p>
<h3 id=momentum_distribution_pphi ><a href="#momentum_distribution_pphi" class=header-anchor >Momentum Distribution – <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy=false >(</mo><mi>ϕ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">P(\phi)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mopen >(</span><span class="mord mathnormal">ϕ</span><span class=mclose >)</span></span></span></span></a></h3>
<p>We normally give <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> a normal multivariate distribution with a mean of 0 and a covariance of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >M</mi></mrow><annotation encoding="application/x-tex">\mathbf{M}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">M</span></span></span></span>, a &quot;mass matrix&quot;. To keep things a little bit simpler, we use a diagonal mass matrix <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >M</mi></mrow><annotation encoding="application/x-tex">\mathbf{M}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">M</span></span></span></span>. This makes the components of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> independent with <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mi>j</mi></msub><mo>∼</mo><mtext>Normal</mtext><mo stretchy=false >(</mo><mn>0</mn><mo separator=true >,</mo><msub><mi>M</mi><mrow><mi>j</mi><mi>j</mi></mrow></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\phi_j \sim \text{Normal}(0, M_{jj})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.980548em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord text"><span class=mord >Normal</span></span><span class=mopen >(</span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">jj</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span></p>
<h3 id=hmc_algorithm ><a href="#hmc_algorithm" class=header-anchor >HMC Algorithm</a></h3>
<p>The HMC algorithm is very similar to the Metropolis algorithm but with the inclusion of the momentum <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> as a way of quantifying the gradient of the posterior distribution:</p>
<ol>
<li><p>Sample <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> from a <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Normal</mtext><mo stretchy=false >(</mo><mn>0</mn><mo separator=true >,</mo><mi mathvariant=bold >M</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\text{Normal}(0, \mathbf{M})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >Normal</span></span><span class=mopen >(</span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathbf">M</span><span class=mclose >)</span></span></span></span></p>

<li><p>Simultaneously sample <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> with <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span><em>leapfrog steps</em> each scaled by a <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">ϵ</span></span></span></span> factor. In a <em>leapfrog step</em>, both <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> are changed, in relation to each other. Repeat the following steps <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> times:</p>

</ol>
<p>2.1. Use the gradient of log posterior of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> to produce a <em>half-step</em> of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>:</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>ϕ</mi><mo>←</mo><mi>ϕ</mi><mo>+</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>ϵ</mi><mfrac><mrow><mi>d</mi><mi>log</mi><mo>⁡</mo><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo></mrow><mrow><mi>d</mi><mi>θ</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\phi \leftarrow \phi + \frac{1}{2} \epsilon \frac{d \log p(\theta \mid y)}{d \theta}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >←</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.113em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">ϵ</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">d</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >lo<span style="margin-right:0.01389em;">g</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<p>2.2 Use the momentum vector <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span> to update the parameter vector <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span>:</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>θ</mi><mo>←</mo><mi>θ</mi><mo>+</mo><mi>ϵ</mi><msup><mi mathvariant=bold >M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>ϕ</mi></mrow><annotation encoding="application/x-tex"> \theta \leftarrow \theta + \epsilon \mathbf{M}^{-1} \phi </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >←</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.058548em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϵ</span><span class=mord ><span class="mord mathbf">M</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">ϕ</span></span></span></span></span>
<p>2.3. Use again the gradient of log posterior of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> to another <em>half-step</em> of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>:</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>ϕ</mi><mo>←</mo><mi>ϕ</mi><mo>+</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>ϵ</mi><mfrac><mrow><mi>d</mi><mi>log</mi><mo>⁡</mo><mi>p</mi><mo stretchy=false >(</mo><mi>θ</mi><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo></mrow><mrow><mi>d</mi><mi>θ</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \phi \leftarrow \phi + \frac{1}{2} \epsilon \frac{d \log p(\theta \mid y)}{d \theta} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >←</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.113em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal">ϵ</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">d</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >lo<span style="margin-right:0.01389em;">g</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<ol start=3 >
<li><p>Assign <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\theta^{t-1}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>ϕ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\phi^{t-1}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.008548em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span> as the values of the parameter vector and the momentum vector, respectively, at the beginning of the <em>leapfrog</em> process &#40;step 2&#41; and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>θ</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">\theta^*</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>ϕ</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">\phi^*</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span> as the values after <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> steps. As an acceptance/rejection rule calculate:</p>

</ol>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>r</mi><mo>=</mo><mfrac><mrow><mi>p</mi><mo stretchy=false >(</mo><msup><mi>θ</mi><mo>∗</mo></msup><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo><mi>p</mi><mo stretchy=false >(</mo><msup><mi>ϕ</mi><mo>∗</mo></msup><mo stretchy=false >)</mo></mrow><mrow><mi>p</mi><mo stretchy=false >(</mo><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>∣</mo><mi>y</mi><mo stretchy=false >)</mo><mi>p</mi><mo stretchy=false >(</mo><msup><mi>ϕ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex"> r = \frac{p(\theta^* \mid y) p(\phi^*)}{p(\theta^{t-1} \mid y) p(\phi^{-1})} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.363em;vertical-align:-0.936em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.989em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.989em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class="mord mathnormal">p</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">ϕ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<ol start=4 >
<li><p>Assign:</p>

</ol>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msup><mi>θ</mi><mi>t</mi></msup><mo>=</mo><mrow><mo fence=true >{</mo><mtable rowspacing=0.3600em  columnalign="left left" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msup><mi>θ</mi><mo>∗</mo></msup></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mtext>with probability </mtext><mi>min</mi><mo>⁡</mo><mo stretchy=false >(</mo><mi>r</mi><mo separator=true >,</mo><mn>1</mn><mo stretchy=false >)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msup><mi>θ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msup></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mtext>otherwise</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\theta^t =
     \begin{cases}
     \theta^* &amp; \text{with probability } \min (r, 1) \\
     \theta^{t-1} &amp; \text{otherwise}
     \end{cases}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.843556em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.843556em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class=mord ><span class=mtable ><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.69em;"><span style="top:-3.69em;"><span class=pstrut  style="height:3.008em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class=pstrut  style="height:3.008em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.19em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:1em;"></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.69em;"><span style="top:-3.69em;"><span class=pstrut  style="height:3.008em;"></span><span class=mord ><span class="mord text"><span class=mord >with probability </span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >min</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >1</span><span class=mclose >)</span></span></span><span style="top:-2.25em;"><span class=pstrut  style="height:3.008em;"></span><span class=mord ><span class="mord text"><span class=mord >otherwise</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>
<h3 id=hmc_implementation ><a href="#hmc_implementation" class=header-anchor >HMC – Implementation</a></h3>
<p>Alright let&#39;s code the HMC algorithm for our toy example&#39;s bivariate normal distribution:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> ForwardDiff: gradient
<span class=hljs-keyword >function</span> hmc(
    S::<span class=hljs-built_in >Int64</span>,
    width::<span class=hljs-built_in >Float64</span>,
    ρ::<span class=hljs-built_in >Float64</span>;
    L=<span class=hljs-number >40</span>,
    ϵ=<span class=hljs-number >0.001</span>,
    μ_x::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >0.0</span>,
    μ_y::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >0.0</span>,
    σ_x::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >1.0</span>,
    σ_y::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >1.0</span>,
    start_x=-<span class=hljs-number >2.5</span>,
    start_y=<span class=hljs-number >2.5</span>,
    seed=<span class=hljs-number >123</span>,
)
    rgn = MersenneTwister(seed)
    binormal = MvNormal([μ_x; μ_y], [σ_x ρ; ρ σ_y])
    draws = <span class=hljs-built_in >Matrix</span>{<span class=hljs-built_in >Float64</span>}(<span class=hljs-literal >undef</span>, S, <span class=hljs-number >2</span>)
    accepted = <span class=hljs-number >0</span>::<span class=hljs-built_in >Int64</span>
    x = start_x
    y = start_y
    <span class=hljs-meta >@inbounds</span> draws[<span class=hljs-number >1</span>, :] = [x y]
    M = [<span class=hljs-number >1.0</span> <span class=hljs-number >0.0</span>; <span class=hljs-number >0.0</span> <span class=hljs-number >1.0</span>]
    ϕ_d = MvNormal([<span class=hljs-number >0.0</span>, <span class=hljs-number >0.0</span>], M)
    <span class=hljs-keyword >for</span> s <span class=hljs-keyword >in</span> <span class=hljs-number >2</span>:S
        x_ = rand(rgn, Uniform(x - width, x + width))
        y_ = rand(rgn, Uniform(y - width, y + width))
        ϕ = rand(rgn, ϕ_d)
        kinetic = sum(ϕ .^ <span class=hljs-number >2</span>) / <span class=hljs-number >2</span>
        log_p = logpdf(binormal, [x, y]) - kinetic
        ϕ += <span class=hljs-number >0.5</span> * ϵ * gradient(x -&gt; logpdf(binormal, x), [x_, y_])
        <span class=hljs-keyword >for</span> l <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:L
            x_, y_ = [x_, y_] + (ϵ * M * ϕ)
            ϕ += +<span class=hljs-number >0.5</span> * ϵ * gradient(x -&gt; logpdf(binormal, x), [x_, y_])
        <span class=hljs-keyword >end</span>
        ϕ = -ϕ <span class=hljs-comment ># make the proposal symmetric</span>
        kinetic = sum(ϕ .^ <span class=hljs-number >2</span>) / <span class=hljs-number >2</span>
        log_p_ = logpdf(binormal, [x_, y_]) - kinetic
        r = exp(log_p_ - log_p)

        <span class=hljs-keyword >if</span> r &gt; rand(rgn, Uniform())
            x = x_
            y = y_
            accepted += <span class=hljs-number >1</span>
        <span class=hljs-keyword >end</span>
        <span class=hljs-meta >@inbounds</span> draws[s, :] = [x y]
    <span class=hljs-keyword >end</span>
    println(<span class=hljs-string >&quot;Acceptance rate is: <span class=hljs-subst >$(accepted / S)</span>&quot;</span>)
    <span class=hljs-keyword >return</span> draws
<span class=hljs-keyword >end</span></code></pre><pre><code class="plaintext hljs">hmc (generic function with 1 method)</code></pre>
<p>In the <code>hmc&#40;&#41;</code> function above I am using the <code>gradient&#40;&#41;</code> function from <a href="https://github.com/JuliaDiff/ForwardDiff.jl"><code>ForwardDiff.jl</code></a> &#40;Revels, Lubin &amp; Papamarkou, 2016&#41; which is Julia&#39;s package for forward mode auto differentiation &#40;autodiff&#41;. The <code>gradient&#40;&#41;</code> function accepts a function as input and an array <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >X</mi></mrow><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">X</span></span></span></span>. It literally evaluates the function <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >X</mi></mrow><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">X</span></span></span></span> and returns the gradient <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∇</mi><mi>f</mi><mo stretchy=false >(</mo><mi mathvariant=bold >X</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\nabla f(\mathbf{X})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >∇</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class=mopen >(</span><span class="mord mathbf">X</span><span class=mclose >)</span></span></span></span>. This is one the advantages of Julia: I don&#39;t need to implement an autodiff for <code>logpdf&#40;&#41;</code>s of any distribution, it will be done automatically for any one from <code>Distributions.jl</code>. You can also try reverse mode autodiff with <a href="https://github.com/JuliaDiff/ReverseDiff.jl"><code>ReverseDiff.jl</code></a> if you want to; and it will also very easy to get a gradient. Now, we&#39;ve got carried away with Julia&#39;s amazing autodiff potential... Let me show you an example of a gradient of a log PDF evaluated at some value. I will use our <code>mvnormal</code> bivariate normal distribution as an example and evaluate its gradient at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x = 1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y = -1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >−</span><span class=mord >1</span></span></span></span>:</p>
<pre><code class="julia hljs">gradient(x -&gt; logpdf(mvnormal, x), [<span class=hljs-number >1</span>, -<span class=hljs-number >1</span>])</code></pre><pre><code class="plaintext hljs">2-element Vector{Float64}:
 -5.000000000000003
  5.000000000000003</code></pre>
<p>So the gradient tells me that the partial derivative of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x = 1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span> with respect to our <code>mvnormal</code> distribution is <code>-5</code> and the partial derivative of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y = -1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >−</span><span class=mord >1</span></span></span></span> with respect to our <code>mvnormal</code> distribution is <code>5</code>.</p>
<p>Now let&#39;s run our HMC Markov chain. We are going to use <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mn>40</mn></mrow><annotation encoding="application/x-tex">L = 40</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >40</span></span></span></span> and &#40;don&#39;t ask me how I found out&#41; <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi><mo>=</mo><mn>0.0856</mn></mrow><annotation encoding="application/x-tex">\epsilon = 0.0856</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">ϵ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0.0856</span></span></span></span>:</p>
<pre><code class="julia hljs">X_hmc = hmc(S, width, ρ; ϵ=<span class=hljs-number >0.0856</span>, L=<span class=hljs-number >40</span>);</code></pre><pre><code class="plaintext hljs">Acceptance rate is: 0.2008
</code></pre>
<p>Our acceptance rate is 20.79&#37;. As before lets&#39; take a quick peek into <code>X_hmc</code>, we&#39;ll see it&#39;s a matrix of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span> values as columns and the time <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> as rows:</p>
<pre><code class="julia hljs">X_hmc[<span class=hljs-number >1</span>:<span class=hljs-number >10</span>, :]</code></pre><pre><code class="plaintext hljs">10×2 Matrix{Float64}:
 -2.5      2.5
 -2.5      2.5
 -3.07839  0.595974
  0.40739  0.575633
  0.40739  0.575633
  0.40739  0.575633
  0.40739  0.575633
  0.40739  0.575633
  0.40739  0.575633
  0.40739  0.575633</code></pre>
<p>Again, we construct a <code>Chains</code> object by passing a matrix along with the parameters names as symbols inside the <code>Chains&#40;&#41;</code> constructor:</p>
<pre><code class="julia hljs">chain_hmc = Chains(X_hmc, [:X, :Y]);</code></pre>
<p>Then we can get summary statistics regarding our Markov chain derived from the HMC algorithm:</p>
<pre><code class="julia hljs">summarystats(chain_hmc)</code></pre><pre><code class="plaintext hljs">Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ess_per_sec
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64       Missing

           X    0.0174    0.9412    0.0235   1563.6767   1755.3638    1.0021       missing
           Y    0.0163    0.9375    0.0237   1561.5693   1707.2358    1.0005       missing
</code></pre>
<p>Both of <code>X</code> and <code>Y</code> have mean close to 0 and standard deviation close to 1 &#40;which are the theoretical values&#41;. Take notice of the <code>ess</code> &#40;effective sample size - ESS&#41; that is around 1,600. Now let&#39;s calculate the efficiency of our HMC algorithm by dividing the ESS by the number of sampling iterations:</p>
<pre><code class="julia hljs">mean(summarystats(chain_hmc)[:, :ess_tail]) / S</code></pre><pre><code class="plaintext hljs">0.1731299790910062</code></pre>
<p>We see that a simple naïve &#40;and not well-calibrated<sup id="fnref:calibrated"><a href="#fndef:calibrated" class=fnref >[9]</a></sup>&#41; HMC has 70&#37; more efficiency from both Gibbs and Metropolis. ≈ 10&#37; versus ≈ 17&#37;. Great&#33; 😀</p>
<h4 id=hmc_visual_intuition ><a href="#hmc_visual_intuition" class=header-anchor >HMC – Visual Intuition</a></h4>
<p>This wouldn&#39;t be complete without animations for HMC&#33;</p>
<p>The animation in figure below shows the first 100 simulations of the HMC algorithm used to generate <code>X_hmc</code>. Note that we have a gradient-guided proposal at each iteration, so the animation would resemble more like a very lucky random-walk Metropolis <sup id="fnref:luckymetropolis"><a href="#fndef:luckymetropolis" class=fnref >[10]</a></sup>. The blue ellipsis represents the 90&#37; HPD of our toy example&#39;s bivariate normal distribution.</p>
<pre><code class="julia hljs">f, ax, l = lines(
    getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.9</span>)...;
    label=<span class=hljs-string >&quot;90% HPD&quot;</span>,
    linewidth=<span class=hljs-number >2</span>,
    axis=(; limits=(-<span class=hljs-number >3</span>, <span class=hljs-number >3</span>, -<span class=hljs-number >3</span>, <span class=hljs-number >3</span>), xlabel=<span class=hljs-string >L&quot;\theta_1&quot;</span>, ylabel=<span class=hljs-string >L&quot;\theta_2&quot;</span>),
)
axislegend(ax)
record(f, joinpath(<span class=hljs-meta >@OUTPUT</span>, <span class=hljs-string >&quot;hmc_anim.gif&quot;</span>); framerate=<span class=hljs-number >5</span>) <span class=hljs-keyword >do</span> frame
    <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >100</span>
        scatter!(ax, (X_hmc[i, <span class=hljs-number >1</span>], X_hmc[i, <span class=hljs-number >2</span>]); color=(:red, <span class=hljs-number >0.5</span>))
        linesegments!(X_hmc[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >1</span>], X_hmc[i:(i + <span class=hljs-number >1</span>), <span class=hljs-number >2</span>]; color=(:green, <span class=hljs-number >0.5</span>))
        recordframe!(frame)
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>;</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/hmc_anim.gif" alt=""> <div class=text-center ><em>Animation of the First 100 Samples Generated from the HMC Algorithm</em></div> <br/></p>
<p>As usual, let&#39;s take a look how the first 1,000 simulations were, excluding 1,000 initial iterations as warm-up.</p>
<pre><code class="julia hljs">f, ax, l = lines(
    getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.9</span>)...;
    label=<span class=hljs-string >&quot;90% HPD&quot;</span>,
    linewidth=<span class=hljs-number >2</span>,
    axis=(; limits=(-<span class=hljs-number >3</span>, <span class=hljs-number >3</span>, -<span class=hljs-number >3</span>, <span class=hljs-number >3</span>), xlabel=<span class=hljs-string >L&quot;\theta_1&quot;</span>, ylabel=<span class=hljs-string >L&quot;\theta_2&quot;</span>),
)
axislegend(ax)
scatter!(
    ax,
    X_hmc[warmup:(warmup + <span class=hljs-number >1_000</span>), <span class=hljs-number >1</span>],
    X_hmc[warmup:(warmup + <span class=hljs-number >1_000</span>), <span class=hljs-number >2</span>];
    color=(:red, <span class=hljs-number >0.3</span>),
)</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/hmc_first1000.svg" alt=""> <div class=text-center ><em>First 1,000 Samples Generated from the HMC Algorithm after warm-up</em></div> <br/></p>
<p>And, finally, lets take a look in the all 9,000 samples generated after the warm-up of 1,000 iterations.</p>
<pre><code class="julia hljs">f, ax, l = lines(
    getellipsepoints(μ, Σ; confidence=<span class=hljs-number >0.9</span>)...;
    label=<span class=hljs-string >&quot;90% HPD&quot;</span>,
    linewidth=<span class=hljs-number >2</span>,
    axis=(; limits=(-<span class=hljs-number >3</span>, <span class=hljs-number >3</span>, -<span class=hljs-number >3</span>, <span class=hljs-number >3</span>), xlabel=<span class=hljs-string >L&quot;\theta_1&quot;</span>, ylabel=<span class=hljs-string >L&quot;\theta_2&quot;</span>),
)
axislegend(ax)
scatter!(ax, X_hmc[warmup:<span class=hljs-keyword >end</span>, <span class=hljs-number >1</span>], X_hmc[warmup:<span class=hljs-keyword >end</span>, <span class=hljs-number >2</span>]; color=(:red, <span class=hljs-number >0.3</span>))</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/hmc_all.svg" alt=""> <div class=text-center ><em>All 9,000 Samples Generated from the HMC Algorithm after warm-up</em></div> <br/></p>
<h3 id=hmc_complex_topologies ><a href="#hmc_complex_topologies" class=header-anchor >HMC – Complex Topologies</a></h3>
<p>There are cases where HMC will be much better than Metropolis or Gibbs. In particular, these cases focus on complicated and difficult-to-explore posterior topologies. In these contexts, an algorithm that can guide the proposals to regions of higher density &#40;such as the case of the HMC&#41; is able to explore much more efficient &#40;less iterations for convergence&#41; and effective &#40;higher rate of acceptance of the proposals&#41;.</p>
<p>See figure below for an example of a bimodal posterior density with also the marginal histogram of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>:</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>X</mi><mo>=</mo><mtext>Normal</mtext><mrow><mo fence=true >(</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>10</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>2</mn></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo separator=true >,</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo fence=true >)</mo></mrow><mo separator=true >,</mo><mspace width=1em /><mi>Y</mi><mo>=</mo><mtext>Normal</mtext><mrow><mo fence=true >(</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo separator=true >,</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>8.4</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>2.0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>2.0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1.7</mn></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo fence=true >)</mo></mrow></mrow><annotation encoding="application/x-tex">
X = \text{Normal} \left(
\begin{bmatrix}
10 \\
2
\end{bmatrix},
\begin{bmatrix}
1 &amp; 0 \\
0 &amp; 1
\end{bmatrix}
\right), \quad
Y = \text{Normal} \left(
\begin{bmatrix}
0 \\
0
\end{bmatrix},
\begin{bmatrix}
8.4 &amp; 2.0 \\
2.0 &amp; 1.7
\end{bmatrix}
\right)
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord text"><span class=mord >Normal</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >10</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:1em;"></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord text"><span class=mord >Normal</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >8.4</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2.0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2.0</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1.7</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span>
<pre><code class="julia hljs">d1 = MvNormal([<span class=hljs-number >10</span>, <span class=hljs-number >2</span>], [<span class=hljs-number >1</span> <span class=hljs-number >0</span>; <span class=hljs-number >0</span> <span class=hljs-number >1</span>])
d2 = MvNormal([<span class=hljs-number >0</span>, <span class=hljs-number >0</span>], [<span class=hljs-number >8.4</span> <span class=hljs-number >2.0</span>; <span class=hljs-number >2.0</span> <span class=hljs-number >1.7</span>])

d = MixtureModel([d1, d2])

x = -<span class=hljs-number >6</span>:<span class=hljs-number >0.01</span>:<span class=hljs-number >15</span>
y = -<span class=hljs-number >2.5</span>:<span class=hljs-number >0.01</span>:<span class=hljs-number >4.2</span>
dens_mixture = [pdf(d, [i, j]) <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> x, j <span class=hljs-keyword >in</span> y]

f, ax, s = surface(
    x,
    y,
    dens_mixture;
    axis=(type=Axis3, xlabel=<span class=hljs-string >L&quot;X&quot;</span>, ylabel=<span class=hljs-string >L&quot;Y&quot;</span>, zlabel=<span class=hljs-string >&quot;PDF&quot;</span>, azimuth=<span class=hljs-literal >pi</span> / <span class=hljs-number >4</span>),
)</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/bimodal.svg" alt=""> <div class=text-center ><em>Multivariate Bimodal Normal</em></div> <br/></p>
<p>And to finish an example of Neal&#39;s funnel &#40;Neal, 2003&#41; in the figure below. This is a very difficult posterior to be sampled even for HMC, as it varies in geometry in the dimensions <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>. This means that the HMC sampler has to change the <em>leapfrog steps</em> <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> and the scaling factor <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">ϵ</span></span></span></span> every time, since at the top of the image &#40;the top of the funnel&#41; a large value of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> is needed along with a small <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">ϵ</span></span></span></span>; and at the bottom &#40;at the bottom of the funnel&#41; the opposite: small <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> and large <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">ϵ</span></span></span></span>.</p>
<pre><code class="julia hljs">funnel_y = rand(Normal(<span class=hljs-number >0</span>, <span class=hljs-number >3</span>), <span class=hljs-number >10_000</span>)
funnel_x = rand(Normal(), <span class=hljs-number >10_000</span>) .* exp.(funnel_y / <span class=hljs-number >2</span>)

f, ax, s = scatter(
    funnel_x,
    funnel_y;
    color=(:steelblue, <span class=hljs-number >0.3</span>),
    axis=(; xlabel=<span class=hljs-string >L&quot;X&quot;</span>, ylabel=<span class=hljs-string >L&quot;Y&quot;</span>, limits=(-<span class=hljs-number >100</span>, <span class=hljs-number >100</span>, <span class=hljs-literal >nothing</span>, <span class=hljs-literal >nothing</span>)),
)</code></pre>
<p><img src="/Bayesian-Julia/assets/pages/05_MCMC/code/output/funnel.svg" alt=""> <div class=text-center ><em>Neal&#39;s Funnel</em></div> <br/></p>
<h2 id=i_understood_nothing ><a href="#i_understood_nothing" class=header-anchor >&quot;I understood nothing...&quot;</a></h2>
<p>If you haven&#39;t understood anything by now, don&#39;t despair. Skip all the formulas and get the visual intuition of the algorithms. See the limitations of Metropolis and Gibbs and compare the animations and figures with those of the HMC. The superiority of efficiency &#40;more samples with low autocorrelation - ESS&#41; and effectiveness &#40;more samples close to the most likely areas of the target distribution&#41; is self-explanatory by the images.</p>
<p>In addition, you will probably <strong>never</strong> have to code your HMC algorithm &#40;Gibbs, Metropolis or any other MCMC&#41; by hand. For that there are packages like Turing&#39;s <a href="https://github.com/TuringLang/AdvancedHMC.jl"><code>AdvancedHMC.jl</code></a> In addition, <code>AdvancedHMC</code> has a modified HMC with a technique called <strong>N</strong>o-<strong>U</strong>-<strong>T</strong>urn <strong>S</strong>ampling &#40;NUTS&#41;<sup id="fnref:nuts"><a href="#fndef:nuts" class=fnref >[11]</a></sup> &#40;Hoffman &amp; Gelman, 2011&#41; that selects automatically the values ​​of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">ϵ</span></span></span></span> &#40;scaling factor&#41; and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> &#40;<em>leapfrog steps</em>&#41;. The performance of the HMC is highly sensitive to these two &quot;hyperparameters&quot; &#40;parameters that must be specified by the user&#41;. In particular, if <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> is too small, the algorithm exhibits undesirable behavior of a random walk, while if <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> is too large, the algorithm wastes computational efficiency. NUTS uses a recursive algorithm to build a set of likely candidate points that span a wide range of proposal distribution, automatically stopping when it starts to go back and retrace its steps &#40;why it doesn&#39;t turn around - <em>No U-turn</em>&#41;, in addition NUTS also automatically calibrates simultaneously <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">ϵ</span></span></span></span>.</p>
<h2 id=mcmc_metrics ><a href="#mcmc_metrics" class=header-anchor >MCMC Metrics</a></h2>
<p>All Markov chains have some convergence and diagnostics metrics that you should be aware of. Note that this is still an ongoing area of intense research and new metrics are constantly being proposed &#40;<em>e.g.</em> Lambert &amp; Vehtari &#40;2020&#41; or Vehtari, Gelman., Simpson, Carpenter &amp; Bürkner &#40;2021&#41;&#41; To show MCMC metrics let me recover our six-sided dice example from <a href="/Bayesian-Julia/pages/4_Turing/">4. <strong>How to use Turing</strong></a>:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> Turing

<span class=hljs-meta >@model</span> <span class=hljs-keyword >function</span> dice_throw(y)
    <span class=hljs-comment >#Our prior belief about the probability of each result in a six-sided dice.</span>
    <span class=hljs-comment >#p is a vector of length 6 each with probability p that sums up to 1.</span>
    p ~ Dirichlet(<span class=hljs-number >6</span>, <span class=hljs-number >1</span>)

    <span class=hljs-comment >#Each outcome of the six-sided dice has a probability p.</span>
    <span class=hljs-keyword >return</span> y ~ filldist(Categorical(p), length(y))
<span class=hljs-keyword >end</span>;</code></pre>
<p>Let&#39;s once again generate 1,000 throws of a six-sided dice:</p>
<pre><code class="julia hljs">data_dice = rand(DiscreteUniform(<span class=hljs-number >1</span>, <span class=hljs-number >6</span>), <span class=hljs-number >1_000</span>);</code></pre>
<p>Like before we&#39;ll sample using <code>NUTS&#40;&#41;</code> and 1,000 iterations. Note that you can use Metropolis with <code>MH&#40;&#41;</code>, Gibbs with <code>Gibbs&#40;&#41;</code> and HMC with <code>HMC&#40;&#41;</code> if you want to. You can check all Turing&#39;s different MCMC samplers in <a href="https://turing.ml/dev/docs/using-turing/guide">Turing&#39;s documentation</a>.</p>
<pre><code class="julia hljs">model = dice_throw(data_dice)
chain = sample(model, NUTS(), <span class=hljs-number >1_000</span>);
summarystats(chain)</code></pre><pre><code class="plaintext hljs">UndefVarError: `Categorical` not defined in `Main.FD_SANDBOX_7674230745907385791`
Hint: It looks like two or more modules export different bindings with this name, resulting in ambiguity. Try explicitly importing it from a particular module, or qualifying the name with the module it should come from.
Hint: a global variable of this name may be made accessible by importing Distributions in the current active module Main
Hint: a global variable of this name may be made accessible by importing Makie in the current active module Main
Hint: a global variable of this name may be made accessible by importing CairoMakie in the current active module Main
Hint: a global variable of this name may be made accessible by importing Bijectors in the current active module Main
Hint: a global variable of this name may be made accessible by importing Turing in the current active module Main
</code></pre>
<p>We have the following columns that outputs some kind of MCMC summary statistics:</p>
<ul>
<li><p><code>mcse</code>: <strong>M</strong>onte <strong>C</strong>arlo <strong>S</strong>tandard <strong>E</strong>rror, the uncertainty about a statistic in the sample due to sampling error.</p>

<li><p><code>ess</code>: <strong>E</strong>ffective <strong>S</strong>ample <strong>S</strong>ize, a rough approximation of the number of effective samples sampled by the MCMC estimated by the value of <code>rhat</code>.</p>

<li><p><code>rhat</code>: a metric of convergence and stability of the Markov chain.</p>

</ul>
<p>The most important metric to take into account is the <code>rhat</code> which is a metric that measures whether the Markov chains are stable and converged to a value during the total progress of the sampling procedure. It is basically the proportion of variation when comparing two halves of the chains after discarding the warmups. A value of 1 implies convergence and stability. By default, <code>rhat</code> must be less than 1.01 for the Bayesian estimation to be valid &#40;Brooks &amp; Gelman, 1998; Gelman &amp; Rubin, 1992&#41;.</p>
<p>Note that all of our model&#39;s parameters have achieve a nice <code>ess</code> and, more important, <code>rhat</code> in the desired range, a solid indicator that the Markov chain is stable and has converged to the estimated parameter values.</p>
<h3 id=what_looks_like_when_your_model_doesnt_converge ><a href="#what_looks_like_when_your_model_doesnt_converge" class=header-anchor >What looks like when your model doesn&#39;t converge</a></h3>
<p>Depending on the model and data, it is possible that HMC &#40;even with NUTS&#41; will not achieve convergence. NUTS will not converge if it encounters divergences either due to a very pathological posterior density topology or if you supply improper parameters. To exemplify let me run a &quot;bad&quot; chain by passing the <code>NUTS&#40;&#41;</code> constructor a target acceptance rate of <code>0.3</code> with only 500 sampling iterations &#40;including warmup of 1,000 iters&#41;:</p>
<pre><code class="julia hljs">bad_chain = sample(model, NUTS(<span class=hljs-number >0.3</span>), <span class=hljs-number >500</span>)
summarystats(bad_chain)</code></pre><pre><code class="plaintext hljs">UndefVarError: `Categorical` not defined in `Main.FD_SANDBOX_7674230745907385791`
Hint: It looks like two or more modules export different bindings with this name, resulting in ambiguity. Try explicitly importing it from a particular module, or qualifying the name with the module it should come from.
Hint: a global variable of this name may be made accessible by importing Distributions in the current active module Main
Hint: a global variable of this name may be made accessible by importing Makie in the current active module Main
Hint: a global variable of this name may be made accessible by importing CairoMakie in the current active module Main
Hint: a global variable of this name may be made accessible by importing Bijectors in the current active module Main
Hint: a global variable of this name may be made accessible by importing Turing in the current active module Main
</code></pre>
<p>Here we can see that the <code>ess</code> and <code>rhat</code> of the <code>bad_chain</code> are <em>really</em> bad&#33; There will be several divergences that we can access in the column <code>numerical_error</code> of a <code>Chains</code> object. Here we have 64 divergences.</p>
<pre><code class="julia hljs">sum(bad_chain[:numerical_error])</code></pre><pre><code class="plaintext hljs">UndefVarError: `bad_chain` not defined in `Main.FD_SANDBOX_7674230745907385791`
Suggestion: check for spelling errors or missing imports.
</code></pre>
<p>Also we can see the Markov chain acceptance rate in the column <code>acceptance_rate</code>. This is the <code>bad_chain</code> acceptance rate:</p>
<pre><code class="julia hljs">mean(bad_chain[:acceptance_rate])</code></pre><pre><code class="plaintext hljs">UndefVarError: `bad_chain` not defined in `Main.FD_SANDBOX_7674230745907385791`
Suggestion: check for spelling errors or missing imports.
</code></pre>
<p>And now the &quot;good&quot; <code>chain</code>:</p>
<pre><code class="julia hljs">mean(chain[:acceptance_rate])</code></pre><pre><code class="plaintext hljs">UndefVarError: `chain` not defined in `Main.FD_SANDBOX_7674230745907385791`
Suggestion: check for spelling errors or missing imports.
Hint: a global variable of this name may be made accessible by importing IterTools in the current active module Main
</code></pre>
<p>What a difference huh? 80&#37; versus 1.5&#37;.</p>
<h3 id=mcmc_visualizations ><a href="#mcmc_visualizations" class=header-anchor >MCMC Visualizations</a></h3>
<p>Besides the <code>rhat</code> values, we can also visualize the Markov chain with a <em>traceplot</em>. The <em>traceplot</em> is the overlap of the MCMC chain sampling for each estimated parameter &#40;vertical axis&#41;. The idea is that the chains mix and that there is no slope or visual pattern along the iterations &#40;horizontal axis&#41;. This demonstrates that the chains have mixed converged to a certain value of the parameter and remained in that region during a good part &#40;or all&#41; of the Markov chain sampling. We can do that with the <code>MCMCChains.jl</code>&#39;s function <code>traceplot&#40;&#41;</code>. Let&#39;s look the &quot;good&quot; <code>chain</code> first:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> AlgebraOfGraphics
params = names(chain, :parameters)
chain_mapping =
    mapping(params .=&gt; <span class=hljs-string >&quot;sample value&quot;</span>) *
    mapping(; color=:chain =&gt; nonnumeric, row=dims(<span class=hljs-number >1</span>) =&gt; renamer(params))
plt = data(chain) * mapping(:iteration) * chain_mapping * visual(Lines)
f = Figure(; resolution=(<span class=hljs-number >1200</span>, <span class=hljs-number >900</span>))
draw!(f[<span class=hljs-number >1</span>, <span class=hljs-number >1</span>], plt)</code></pre><pre><code class="plaintext hljs">UndefVarError: `chain` not defined in `Main.FD_SANDBOX_7674230745907385791`
Suggestion: check for spelling errors or missing imports.
Hint: a global variable of this name may be made accessible by importing IterTools in the current active module Main
</code></pre>
<p><p><span style="color:red;">// Image matching '/assets/pages/05_MCMC/code/traceplot_chain' not found. //</span></p> <div class=text-center ><em>Traceplot for <code>chain</code></em></div> <br/></p>
<p>And now the <code>bad_chain</code>:</p>
<pre><code class="julia hljs">params = names(bad_chain, :parameters)
chain_mapping =
    mapping(params .=&gt; <span class=hljs-string >&quot;sample value&quot;</span>) *
    mapping(; color=:chain =&gt; nonnumeric, row=dims(<span class=hljs-number >1</span>) =&gt; renamer(params))
plt = data(bad_chain) * mapping(:iteration) * chain_mapping * visual(Lines)
f = Figure(; resolution=(<span class=hljs-number >1200</span>, <span class=hljs-number >900</span>))
draw!(f[<span class=hljs-number >1</span>, <span class=hljs-number >1</span>], plt)</code></pre><pre><code class="plaintext hljs">UndefVarError: `bad_chain` not defined in `Main.FD_SANDBOX_7674230745907385791`
Suggestion: check for spelling errors or missing imports.
</code></pre>
<p><p><span style="color:red;">// Image matching '/assets/pages/05_MCMC/code/traceplot_bad_chain' not found. //</span></p> <div class=text-center ><em>Traceplot for <code>bad_chain</code></em></div> <br/></p>
<p>We can see that the <code>bad_chain</code> is all over the place and has definitely not converged or became stable.</p>
<h2 id=how_to_make_your_markov_chains_converge ><a href="#how_to_make_your_markov_chains_converge" class=header-anchor >How to make your Markov chains converge</a></h2>
<p><strong>First</strong>: Before making fine adjustments to the number of chains or the number of iterations &#40;among others ...&#41; know that Turing&#39;s NUTS sampler is very efficient and effective in exploring the most diverse and complex &quot;crazy&quot; topologies of posteriors&#39; target distributions. The standard arguments <code>NUTS&#40;&#41;</code> work perfectly for 99&#37; of cases &#40;even in complex models&#41;. That said, <strong>most of the time when you have sampling and computational problems in your Bayesian model, the problem is in the model specification and not in the MCMC sampling algorithm</strong>. This is known as <em>Folk Theorem</em> &#40;Gelman, 2008&#41;. In the words of Andrew Gelman:</p>
<blockquote>
<p>&quot;When you have computational problems, often there&#39;s a problem with your model&quot;. <br/> <br/> Andrew Gelman &#40;Gelman, 2008&#41;</p>
</blockquote>
<p>If your Bayesian model has problems with convergence there are some steps that can be tried<sup id="fnref:QR"><a href="#fndef:QR" class=fnref >[12]</a></sup>. Listed here from the simplest to the most complex:</p>
<ol>
<li><p><strong>Increase the number of iterations and chains</strong>: First option is to increase the number of MCMC iterations and it is also possible to increase the number of parallel chains to be sampled.</p>

<li><p><strong>Model reparameterization</strong>: the second option is to reparameterize the model. There are two ways to parameterize the model: the first with centered parameterization &#40;CP&#41; and the second with non-centered parameterization &#40;NCP&#41;. NCP is most useful in Multilevel Models, therefore we will cover NCP in <a href="/Bayesian-Julia/pages/10_multilevel_models/">10. <strong>Multilevel Models</strong></a>.</p>

<li><p><strong>Collect more data</strong>: sometimes the model is too complex and we need a larger sample to get stable estimates.</p>

<li><p><strong>Rethink the model</strong>: convergence failure when we have adequate sampling is usually due to a specification of priors and likelihood function that are not compatible with the data. In this case, it is necessary to rethink the data&#39;s generative process in which the model&#39;s assumptions are anchored.</p>

</ol>
<h2 id=footnotes ><a href="#footnotes" class=header-anchor >Footnotes</a></h2>
<p><table class=fndef  id="fndef:propto">
    <tr>
        <td class=fndef-backref ><a href="#fnref:propto">[1]</a>
        <td class=fndef-content >the symbol <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∝</mo></mrow><annotation encoding="application/x-tex">\propto</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class=mrel >∝</span></span></span></span> &#40;<code>\propto</code>&#41; should be read as &quot;proportional to&quot;.
    
</table>
<table class=fndef  id="fndef:warmup">
    <tr>
        <td class=fndef-backref ><a href="#fnref:warmup">[2]</a>
        <td class=fndef-content >some references call this process <em>burnin</em>.
    
</table>
<table class=fndef  id="fndef:metropolis">
    <tr>
        <td class=fndef-backref ><a href="#fnref:metropolis">[3]</a>
        <td class=fndef-content >if you want a better explanation of the Metropolis and Metropolis-Hastings algorithms I suggest to see Chib &amp; Greenberg &#40;1995&#41;.
    
</table>
<table class=fndef  id="fndef:numerical">
    <tr>
        <td class=fndef-backref ><a href="#fnref:numerical">[4]</a>
        <td class=fndef-content >Due to easier computational complexity and to avoid <a href="https://en.wikipedia.org/wiki/Integer_overflow">numeric overflow</a> we generally use sum of logs instead of multiplications, specially when dealing with probabilities, <em>i.e.</em> <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=double-struck >R</mi><mo>∈</mo><mo stretchy=false >[</mo><mn>0</mn><mo separator=true >,</mo><mn>1</mn><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">\mathbb{R} \in [0, 1]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.72799em;vertical-align:-0.0391em;"></span><span class="mord mathbb">R</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∈</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >[</span><span class=mord >0</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >1</span><span class=mclose >]</span></span></span></span>.
    
</table>
<table class=fndef  id="fndef:mcmcchains">
    <tr>
        <td class=fndef-backref ><a href="#fnref:mcmcchains">[5]</a>
        <td class=fndef-content >this is one of the packages of Turing&#39;s ecosystem. I recommend you to take a look into <a href="/Bayesian-Julia/pages/4_Turing/">4. <strong>How to use Turing</strong></a>.
    
</table>
<table class=fndef  id="fndef:gibbs">
    <tr>
        <td class=fndef-backref ><a href="#fnref:gibbs">[6]</a>
        <td class=fndef-content >if you want a better explanation of the Gibbs algorithm I suggest to see Casella &amp; George &#40;1992&#41;.
    
</table>
<table class=fndef  id="fndef:gibbs2">
    <tr>
        <td class=fndef-backref ><a href="#fnref:gibbs2">[7]</a>
        <td class=fndef-content >this will be clear in the animations and images.
    
</table>
<table class=fndef  id="fndef:markovparallel">
    <tr>
        <td class=fndef-backref ><a href="#fnref:markovparallel">[8]</a>
        <td class=fndef-content >note that there is some shenanigans here to take care. You would also want to have different seeds for the random number generator in each Markov chain. This is why <code>metropolis&#40;&#41;</code> and <code>gibbs&#40;&#41;</code> have a <code>seed</code> parameter.
    
</table>
<table class=fndef  id="fndef:calibrated">
    <tr>
        <td class=fndef-backref ><a href="#fnref:calibrated">[9]</a>
        <td class=fndef-content >as detailed in the following sections, HMC is quite sensitive to the choice of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">ϵ</span></span></span></span> and I haven&#39;t tried to get the best possible combination of those.
    
</table>
<table class=fndef  id="fndef:luckymetropolis">
    <tr>
        <td class=fndef-backref ><a href="#fnref:luckymetropolis">[10]</a>
        <td class=fndef-content >or a not-drunk random-walk Metropolis 😂.
    
</table>
<table class=fndef  id="fndef:nuts">
    <tr>
        <td class=fndef-backref ><a href="#fnref:nuts">[11]</a>
        <td class=fndef-content >NUTS is an algorithm that uses the symplectic leapfrog integrator and builds a binary tree composed of leaf nodes that are simulations of Hamiltonian dynamics using <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>j</mi></msup></mrow><annotation encoding="application/x-tex">2^j</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.824664em;vertical-align:0em;"></span><span class=mord ><span class=mord >2</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span></span><em>leapfrog steps</em> in forward or backward directions in time where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> is the integer representing the iterations of the construction of the binary tree. Once the simulated particle starts to retrace its trajectory, the tree construction is interrupted and the ideal number of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span><em>leapfrog steps</em> is defined as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>j</mi></msup></mrow><annotation encoding="application/x-tex">2^j</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.824664em;vertical-align:0em;"></span><span class=mord ><span class=mord >2</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span></span> in time <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">j-1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span> from the beginning of the retrogression of the trajectory. So the simulated particle never &quot;turns around&quot; so &quot;No U-turn&quot;. For more details on the algorithm and how it relates to Hamiltonian dynamics see Hoffman &amp; Gelman &#40;2011&#41;.
    
</table>
<table class=fndef  id="fndef:QR">
    <tr>
        <td class=fndef-backref ><a href="#fnref:QR">[12]</a>
        <td class=fndef-content >furthermore, if you have high-correlated variables in your model, you can try a QR decomposition of the data matrix <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>. I will cover QR decomposition and other Turing&#39;s computational &quot;tricks of the trade&quot; in <a href="/Bayesian-Julia/pages/11_Turing_tricks/">11. <strong>Computational Tricks with Turing</strong></a>.
    
</table>
</p>
<h2 id=references ><a href="#references" class=header-anchor >References</a></h2>
<p>Betancourt, M. &#40;2017, January 9&#41;. A Conceptual Introduction to Hamiltonian Monte Carlo. Retrieved November 6, 2019, from http://arxiv.org/abs/1701.02434</p>
<p>Brooks, S., Gelman, A., Jones, G., &amp; Meng, X.-L. &#40;2011&#41;. Handbook of Markov Chain Monte Carlo. Retrieved from https://books.google.com?id&#61;qfRsAIKZ4rIC</p>
<p>Brooks, S. P., &amp; Gelman, A. &#40;1998&#41;. General Methods for Monitoring Convergence of Iterative Simulations. Journal of Computational and Graphical Statistics, 7&#40;4&#41;, 434–455. https://doi.org/10.1080/10618600.1998.10474787</p>
<p>Casella, G., &amp; George, E. I. &#40;1992&#41;. Explaining the gibbs sampler. The American Statistician, 46&#40;3&#41;, 167–174. https://doi.org/10.1080/00031305.1992.10475878</p>
<p>Chib, S., &amp; Greenberg, E. &#40;1995&#41;. Understanding the Metropolis-Hastings Algorithm. The American Statistician, 49&#40;4&#41;, 327–335. https://doi.org/10.1080/00031305.1995.10476177</p>
<p>Duane, S., Kennedy, A. D., Pendleton, B. J., &amp; Roweth, D. &#40;1987&#41;. Hybrid Monte Carlo. Physics Letters B, 195&#40;2&#41;, 216–222. https://doi.org/10.1016/0370-2693&#40;87&#41;91197-X</p>
<p>Eckhardt, R. &#40;1987&#41;. Stan Ulam, John von Neumann, and the Monte Carlo Method. Los Alamos Science, 15&#40;30&#41;, 131–136.</p>
<p>Gelman, A. &#40;1992&#41;. Iterative and Non-Iterative Simulation Algorithms. Computing Science and Statistics &#40;Interface Proceedings&#41;, 24, 457–511. PROCEEDINGS PUBLISHED BY VARIOUS PUBLISHERS.</p>
<p>Gelman, A. &#40;2008&#41;. The folk theorem of statistical computing. Retrieved from https://statmodeling.stat.columbia.edu/2008/05/13/the<em>folk</em>theore/</p>
<p>Gelman, A., Carlin, J. B., Stern, H. S., Dunson, D. B., Vehtari, A., &amp; Rubin, D. B. &#40;2013a&#41;. Basics of Markov Chain Simulation. In Bayesian Data Analysis. Chapman and Hall/CRC.</p>
<p>Gelman, A., Carlin, J. B., Stern, H. S., Dunson, D. B., Vehtari, A., &amp; Rubin, D. B. &#40;2013b&#41;. Bayesian Data Analysis. Chapman and Hall/CRC.</p>
<p>Gelman, A., &amp; Rubin, D. B. &#40;1992&#41;. Inference from Iterative Simulation Using Multiple Sequences. Statistical Science, 7&#40;4&#41;, 457–472. https://doi.org/10.1214/ss/1177011136</p>
<p>Geman, S., &amp; Geman, D. &#40;1984&#41;. Stochastic Relaxation, Gibbs Distributions, and the Bayesian Restoration of Images. IEEE Transactions on Pattern Analysis and Machine Intelligence, PAMI-6&#40;6&#41;, 721–741. https://doi.org/10.1109/TPAMI.1984.4767596</p>
<p>Hastings, W. K. &#40;1970&#41;. Monte Carlo sampling methods using Markov chains and their applications. Biometrika, 57&#40;1&#41;, 97–109. https://doi.org/10.1093/biomet/57.1.97</p>
<p>Hoffman, M. D., &amp; Gelman, A. &#40;2011&#41;. The No-U-Turn Sampler: Adaptively Setting Path Lengths in Hamiltonian Monte Carlo. Journal of Machine Learning Research, 15&#40;1&#41;, 1593–1623. Retrieved from http://arxiv.org/abs/1111.4246</p>
<p>Lambert, B., &amp; Vehtari, A. &#40;2020&#41;. <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>R</mi><mo>∗</mo></msup></mrow><annotation encoding="application/x-tex">R^*</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.688696em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.688696em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span>: A robust MCMC convergence diagnostic with uncertainty using decision tree classifiers. ArXiv:2003.07900 &#91;Stat&#93;. http://arxiv.org/abs/2003.07900</p>
<p>Metropolis, N., Rosenbluth, A. W., Rosenbluth, M. N., Teller, A. H., &amp; Teller, E. &#40;1953&#41;. Equation of State Calculations by Fast Computing Machines. The Journal of Chemical Physics, 21&#40;6&#41;, 1087–1092. https://doi.org/10.1063/1.1699114</p>
<p>Neal, Radford M. &#40;1994&#41;. An Improved Acceptance Procedure for the Hybrid Monte Carlo Algorithm. Journal of Computational Physics, 111&#40;1&#41;, 194–203. https://doi.org/10.1006/jcph.1994.1054</p>
<p>Neal, Radford M. &#40;2003&#41;. Slice Sampling. The Annals of Statistics, 31&#40;3&#41;, 705–741. Retrieved from https://www.jstor.org/stable/3448413</p>
<p>Neal, Radford M. &#40;2011&#41;. MCMC using Hamiltonian dynamics. In S. Brooks, A. Gelman, G. L. Jones, &amp; X.-L. Meng &#40;Eds.&#41;, Handbook of markov chain monte carlo.</p>
<p>Revels, J., Lubin, M., &amp; Papamarkou, T. &#40;2016&#41;. Forward-Mode Automatic Differentiation in Julia. ArXiv:1607.07892 &#91;Cs&#93;. http://arxiv.org/abs/1607.07892</p>
<p>Roberts, G. O., Gelman, A., &amp; Gilks, W. R. &#40;1997&#41;. Weak convergence and optimal scaling of random walk Metropolis algorithms. Annals of Applied Probability, 7&#40;1&#41;, 110–120. https://doi.org/10.1214/aoap/1034625254</p>
<p>Vehtari, A., Gelman, A., Simpson, D., Carpenter, B., &amp; Bürkner, P.-C. &#40;2021&#41;. Rank-Normalization, Folding, and Localization: An Improved Rˆ for Assessing Convergence of MCMC. Bayesian Analysis, 1&#40;1&#41;, 1–28. https://doi.org/10.1214/20-BA1221</p>

<div class=page-foot >
  <div class=copyright >
    Last modified: October 26, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div> 
    </div> 
    </div> <!-- end of class page-wrap-->