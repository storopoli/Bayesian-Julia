<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/Bayesian-Julia/libs/katex/katex.min.css"> <link rel=stylesheet  href="/Bayesian-Julia/libs/highlight/github.min.css"> <link rel=stylesheet  href="/Bayesian-Julia/css/jtd.css"> <link rel=icon  href="/Bayesian-Julia/assets/favicon.ico"> <title>Why Julia?</title> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/Bayesian-Julia/" class=title > Bayesian Stats </a> </div> <label for=show-menu  class=show-menu >MENU</label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "><a href="/Bayesian-Julia/" class="menu-list-link ">Home</a> <li class="menu-list-item active"><a href="/Bayesian-Julia/pages/01_why_Julia/" class="menu-list-link active">1. Why Julia?</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/02_bayes_stats/" class="menu-list-link ">2. What is Bayesian Statistics?</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/03_prob_dist/" class="menu-list-link ">3. Common Probability Distributions</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/04_Turing/" class="menu-list-link ">4. How to use Turing</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/05_MCMC/" class="menu-list-link ">5. Markov Chain Monte Carlo (MCMC)</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/06_linear_reg/" class="menu-list-link ">6. Bayesian Linear Regression</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/07_logistic_reg/" class="menu-list-link ">7. Bayesian Logistic Regression</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/08_ordinal_reg/" class="menu-list-link ">8. Bayesian Ordinal Regression</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/09_count_reg/" class="menu-list-link ">9. Bayesian Regression with Count Data</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/10_robust_reg/" class="menu-list-link ">10. Robust Bayesian Regression</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/11_multilevel_models/" class="menu-list-link ">11. Multilevel Models</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/12_Turing_tricks/" class="menu-list-link ">12. Computational Tricks with Turing</a> <li class="menu-list-item "><a href="/Bayesian-Julia/pages/13_epi_models/" class="menu-list-link ">13. Bayesian Epidemiological Models</a> </ul> </div> <div class=footer > <a href="https://www.julialang.org"><img style="height:50px;padding-left:10px;margin-bottom:15px;" src="https://julialang.org/assets/infra/logo.svg" alt="Julia Logo"></a> </div> </div> <div class=main-content-wrap > <div class=main-content > <div class=main-header > <a id=github  href="https://github.com/storopoli/Bayesian-Julia">Code on GitHub</a> </div> <div class=franklin-content ><div class=franklin-toc ><ol><li><a href="#speed">Speed</a><li><a href="#ease_of_use">Ease of Use</a><li><a href="#multiple_dispatch">Multiple Dispatch</a><ol><li><a href="#example_dogs_and_cats">Example: Dogs and Cats</a><li><a href="#example_one-hot_vector">Example: One-hot Vector</a></ol><li><a href="#julia_the_right_approach">Julia: the right approach</a><li><a href="#footnotes">Footnotes</a><li><a href="#references">References</a></ol></div> <h1 id=why_julia ><a href="#why_julia" class=header-anchor >Why Julia?</a></h1> <p><a href="https://www.julialang.org">Julia</a> &#40;Bezanson, Edelman, Karpinski &amp; Shah, 2017&#41; is a relatively new language, first released in 2012, aims to be both <strong>high-level</strong> and <strong>fast</strong>. Julia is a fast dynamic-typed language that just-in-time &#40;JIT&#41; compiles into native code using LLVM. It <a href="https://www.nature.com/articles/d41586-019-02310-3">&quot;runs like C but reads like Python&quot;</a>, meaning that is <em>blazing</em> fast, easy to prototype and read/write code. It is <strong>multi-paradigm</strong>, combining features of imperative, functional, and object-oriented programming.</p> <p><strong>Why was Julia created?</strong> Definitely read this now impressively <a href="https://julialang.org/blog/2012/02/why-we-created-julia/">old post by Julia founders</a>. Here is a clarifying quote:</p> <blockquote> <p>We want the speed of C with the dynamism of Ruby. We want a language that&#39;s homoiconic, with true macros like Lisp, but with obvious, familiar mathematical notation like Matlab. We want something as usable for general programming as Python, as easy for statistics as R, as natural for string processing as Perl, as powerful for linear algebra as Matlab, as good at gluing programs together as the shell. Something that is dirt simple to learn, yet keeps the most serious hackers happy. We want it interactive and we want it compiled.</p> </blockquote> <p><strong>Why this needs to be an extra language?</strong> Why cannot Python &#40;or R&#41; be made that fast for instance? See the official compact answer to this in the <a href="https://docs.julialang.org/en/v1/manual/faq/#Why-don&#39;t-you-compile-Matlab/Python/R/&#37;E2&#37;80&#37;A6-code-to-Julia?">Julia manual FAQ</a>:</p> <blockquote> <p>The basic issue is that there is nothing special about Julia&#39;s compiler: we use a commonplace compiler &#40;LLVM&#41; with no &quot;secret sauce&quot; that other language developers don&#39;t know about. Julia&#39;s performance advantage derives almost entirely from its front-end: its language semantics allow a well-written Julia program to give more opportunities to the compiler to generate efficient code and memory layouts. If you tried to compile Matlab or Python code to Julia, our compiler would be limited by the semantics of Matlab or Python to producing code no better than that of existing compilers for those languages &#40;and probably worse&#41;.</p> <p>Julia&#39;s advantage is that good performance is not limited to a small subset of &quot;built-in&quot; types and operations, and one can write high-level type-generic code that works on arbitrary user-defined types while remaining fast and memory-efficient. Types in languages like Python simply don&#39;t provide enough information to the compiler for similar capabilities, so as soon as you used those languages as a Julia front-end you would be stuck.</p> </blockquote> <p>These are the &quot;official&quot; answers from the Julia community. Now let me share with you my opinion. From my point-of-view Julia has <strong>three main features that makes it a unique language to work with</strong>, specially in scientific computing:</p> <ul> <li><p><strong>Speed</strong></p> <li><p><strong>Ease of Use</strong></p> <li><p><strong>Multiple Dispatch</strong></p> </ul> <p>Now let&#39;s dive into each one of those three features.</p> <h2 id=speed ><a href="#speed" class=header-anchor >Speed</a></h2> <p>Yes, Julia is <strong>fast</strong>. <strong>Very fast&#33;</strong> It was made for speed from the drawing board. It bypass any sort of intermediate representation and translate code into machine native code using LLVM compiler. Comparing this with R, that uses either FORTRAN or C, or Python, that uses CPython; and you&#39;ll clearly see that Julia has a major speed advantage over other languages that are common in data science and statistics. Julia exposes the machine code to LLVM&#39;s compiler which in turn can optimize code as it wishes, like a good compiler such as LLVM excels in.</p> <p>One notable example: NASA uses Julia to analyze the &quot;<a href="https://exoplanets.nasa.gov/news/1669/seven-rocky-trappist-1-planets-may-be-made-of-similar-stuff/">Largest Batch of Earth-Sized Planets Ever Found</a>&quot;. Also, you can find <a href="https://julialang.org/benchmarks/">benchmarks</a> for a range of common code patterns, such as function calls, string parsing, sorting, numerical loops, random number generation, recursion, and array operations using Julia and also several other languages such as C, Rust, Go, JavaScript, R, Python, Fortran and Java. The figure below was taken from <a href="https://julialang.org/benchmarks/">Julia&#39;s website</a>. As you can see Julia is <strong>indeed</strong> fast:</p> <p><img src="/Bayesian-Julia/pages/images/benchmarks.svg" alt="Common Benchmarks" /></p> <p><div class=text-center ><em>Common Benchmarks</em></div> <br/></p> <p>Let me demonstrate how fast Julia is. Here is a simple &quot;groupby&quot; operation using random stuff to emulate common data analysis &quot;split-apply-combine&quot; operations in three languages<sup id="fnref:updatedversion"><a href="#fndef:updatedversion" class=fnref >[1]</a></sup> :</p> <ul> <li><p>Julia: using <a href="https://dataframes.juliadata.org/stable/"><code>DataFrames.jl</code></a> - 0.4ms</p> <li><p>Python: using <code>Pandas</code> and <code>NumPy</code> - 1.76ms</p> <li><p>R: using <code>&#123;dplyr&#125;</code> - 3.22ms</p> </ul> <p>Here is Julia:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Random
<span class=hljs-keyword >using</span> StatsBase
<span class=hljs-keyword >using</span> DataFrames
<span class=hljs-keyword >using</span> BenchmarkTools
<span class=hljs-keyword >using</span> Chain
Random.seed!(<span class=hljs-number >123</span>)

n = <span class=hljs-number >10_000</span>

df = DataFrame(
    x=sample([<span class=hljs-string >&quot;A&quot;</span>, <span class=hljs-string >&quot;B&quot;</span>, <span class=hljs-string >&quot;C&quot;</span>, <span class=hljs-string >&quot;D&quot;</span>], n, replace=<span class=hljs-literal >true</span>),
    y=rand(n),
    z=randn(n),
)

<span class=hljs-meta >@btime</span> <span class=hljs-meta >@chain</span> $df <span class=hljs-keyword >begin</span>  <span class=hljs-comment ># passing `df` as reference so the compiler cannot optimize</span>
    groupby(:x)
    combine(:y =&gt; median, :z =&gt; mean)
<span class=hljs-keyword >end</span></code></pre> <p>Here is Python:</p> <pre><code class="python hljs"><span class=hljs-keyword >import</span> pandas <span class=hljs-keyword >as</span> pd
<span class=hljs-keyword >import</span> numpy <span class=hljs-keyword >as</span> np

n = <span class=hljs-number >10000</span>

df = pd.DataFrame({<span class=hljs-string >&#x27;x&#x27;</span>: np.random.choice([<span class=hljs-string >&#x27;A&#x27;</span>, <span class=hljs-string >&#x27;B&#x27;</span>, <span class=hljs-string >&#x27;C&#x27;</span>, <span class=hljs-string >&#x27;D&#x27;</span>], n, replace=<span class=hljs-literal >True</span>),
                   <span class=hljs-string >&#x27;y&#x27;</span>: np.random.randn(n),
                   <span class=hljs-string >&#x27;z&#x27;</span>: np.random.rand(n)})

%timeit df.groupby(<span class=hljs-string >&#x27;x&#x27;</span>).agg({<span class=hljs-string >&#x27;y&#x27;</span>: <span class=hljs-string >&#x27;median&#x27;</span>, <span class=hljs-string >&#x27;z&#x27;</span>: <span class=hljs-string >&#x27;mean&#x27;</span>})</code></pre> <p>Here is R:</p> <pre><code class="r hljs">library<span class=hljs-punctuation >(</span>dplyr<span class=hljs-punctuation >)</span>

n <span class=hljs-operator >&lt;-</span> 10e3
df <span class=hljs-operator >&lt;-</span> tibble<span class=hljs-punctuation >(</span>
    x <span class=hljs-operator >=</span> sample<span class=hljs-punctuation >(</span><span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span><span class=hljs-string >&quot;A&quot;</span><span class=hljs-punctuation >,</span> <span class=hljs-string >&quot;B&quot;</span><span class=hljs-punctuation >,</span> <span class=hljs-string >&quot;C&quot;</span><span class=hljs-punctuation >,</span> <span class=hljs-string >&quot;D&quot;</span><span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span> n<span class=hljs-punctuation >,</span> replace <span class=hljs-operator >=</span> <span class=hljs-literal >TRUE</span><span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span>
    y <span class=hljs-operator >=</span> runif<span class=hljs-punctuation >(</span>n<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span>
    z <span class=hljs-operator >=</span> rnorm<span class=hljs-punctuation >(</span>n<span class=hljs-punctuation >)</span>
<span class=hljs-punctuation >)</span>

bench<span class=hljs-operator >::</span>mark<span class=hljs-punctuation >(</span>
    df <span class=hljs-operator >%&gt;%</span>
        group_by<span class=hljs-punctuation >(</span>x<span class=hljs-punctuation >)</span> <span class=hljs-operator >%&gt;%</span>
        summarize<span class=hljs-punctuation >(</span>
            median<span class=hljs-punctuation >(</span>y<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span>
            mean<span class=hljs-punctuation >(</span>z<span class=hljs-punctuation >)</span>
        <span class=hljs-punctuation >)</span>
<span class=hljs-punctuation >)</span></code></pre> <p>So clearly <strong>Julia is the winner here</strong>, being <strong>4x faster than Python</strong> and almost <strong>10x faster than R</strong>. Also note that <code>Pandas</code> &#40;along with <code>NumPy</code>&#41; and <code>&#123;dplyr&#125;</code> are all written in C or C&#43;&#43;. Additionally, I didn&#39;t let Julia cheat by allowing the compiler optimize for <code>df</code> by passing a reference <code>&#36;df</code>. So, I guess this is a fair comparison.</p> <h2 id=ease_of_use ><a href="#ease_of_use" class=header-anchor >Ease of Use</a></h2> <p>What is most striking is that Julia can be as fast as C &#40;and faster than Java in some applications&#41; while <strong>having a very simple and intelligible syntax</strong>. This feature along with its speed is what Julia creators denote as <strong>&quot;the two language problem&quot;</strong> that Julia addresses. The <strong>&quot;two language problem&quot; is a very typical situation in scientific computing</strong> where a researcher or computer scientist devises an algorithm or a solution that he or she prototypes in an easy to code language &#40;like Python&#41; and, if it works, he or she would code in a fast language that is not easy to code &#40;C or FORTRAN&#41;. Thus, we have two languages involved in the process of developing a new solution. One which is easy to prototype but is not suited for implementation &#40;mostly due to being slow&#41;. And another one which is not so easy to code &#40;and, consequently, not easy to prototype&#41; but suited for implementation &#40;mostly because it is fast&#41;. Julia comes to <strong>eliminate such situations</strong> by being the <strong>same language</strong> that you <strong>prototype</strong> &#40;ease of use&#41; and <strong>implement the solution</strong> &#40;speed&#41;.</p> <p>Also, Julia lets you use <strong>unicode characters as variables or parameters</strong>. This means no more using <code>sigma</code> or <code>sigma_i</code>, and instead just use <code>σ</code> or <code>σᵢ</code> as you would in mathematical notation. When you see code for an algorithm or for a mathematical equation you see a <strong>one-to-one relation to code and math</strong>. This is a <strong>powerful</strong> feature.</p> <p>I think that the &quot;two language problem&quot; and the one-to-one code and math relation are best described by one of the creators of Julia, Alan Edelman, in a <strong>TED Talk</strong> &#40;see the video below&#41;:</p> <style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style><div class='embed-container'><iframe src='https://www.youtube.com/embed/qGW0GT1rCvs' frameborder='0' allowfullscreen></iframe></div> <p>I will try to exemplify what would be the &quot;two language problem&quot; by showing you how I would code a simple <a href="https://en.wikipedia.org/wiki/Metropolis&#37;E2&#37;80&#37;93Hastings_algorithm"><strong>Metropolis algorithm</strong></a> for a <strong>bivariate normal distribution</strong>. I would mostly prototype it in a dynamically-typed language such as R or Python. Then, deploy the algorithm using a fast but hard to code language such as C&#43;&#43;. This is exactly what I&#39;ll do now. The algorithm will be coded in <strong>Julia</strong>, <strong>R</strong>, <strong>C&#43;&#43;</strong> and <a href="https://mc-stan.org"><strong><code>Stan</code></strong></a>. There are two caveats. First, I am coding the <strong>original 1950s Metropolis version</strong>, not the <strong>1970s Metropolis-Hastings</strong>, which implies <strong>symmetrical proposal distributions</strong> just for the sake of the example. Second, the proposals are based on a <strong>uniform distribution</strong> on the current proposal values of the proposal values ± a certain <code>width</code>.</p> <p>Let&#39;s start with <strong>Julia</strong> which uses the <a href="https://juliastats.org/Distributions.jl/stable/"><code>Distributions.jl</code></a> package for its probabilistic distributions along with <code>logpdf&#40;&#41;</code> defined methods for all of the distributions.</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Distributions
<span class=hljs-keyword >function</span> metropolis(S::<span class=hljs-built_in >Int64</span>, width::<span class=hljs-built_in >Float64</span>, ρ::<span class=hljs-built_in >Float64</span>;
                    μ_x::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >0.0</span>, μ_y::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >0.0</span>,
                    σ_x::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >1.0</span>, σ_y::<span class=hljs-built_in >Float64</span>=<span class=hljs-number >1.0</span>)
    binormal = MvNormal([μ_x; μ_y], [σ_x ρ; ρ σ_y]);
    draws = <span class=hljs-built_in >Matrix</span>{<span class=hljs-built_in >Float64</span>}(<span class=hljs-literal >undef</span>, S, <span class=hljs-number >2</span>);
    x = randn(); y = randn();
    accepted = <span class=hljs-number >0</span>::<span class=hljs-built_in >Int64</span>;
    <span class=hljs-keyword >for</span> s <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:S
        x_ = rand(Uniform(x - width, x + width));
        y_ = rand(Uniform(y - width, y + width));
        r = exp(logpdf(binormal, [x_, y_]) - logpdf(binormal, [x, y]));

        <span class=hljs-keyword >if</span> r &gt; rand(Uniform())
            x = x_;
            y = y_;
            accepted += <span class=hljs-number >1</span>;
        <span class=hljs-keyword >end</span>
        <span class=hljs-meta >@inbounds</span> draws[s, :] = [x y];
    <span class=hljs-keyword >end</span>
    println(<span class=hljs-string >&quot;Acceptance rate is <span class=hljs-subst >$(accepted / S)</span>&quot;</span>)
    <span class=hljs-keyword >return</span> draws
<span class=hljs-keyword >end</span></code></pre> <p>Now let&#39;s go to the <strong>R version</strong> &#40;from now on no more fancy names like <code>μ</code> or <code>σ</code> 😭&#41;. Since this is a bivariate normal I am using the package <a href="https://cran.r-project.org/web/packages/mnormt/index.html"><code>&#123;mnormt&#125;</code></a> which allows for very fast &#40;FORTRAN code&#41; computation of multivariate normal distributions&#39; pdf and logpdf.</p> <pre><code class="r hljs">metropolis <span class=hljs-operator >&lt;-</span> <span class=hljs-keyword >function</span><span class=hljs-punctuation >(</span>S<span class=hljs-punctuation >,</span> width<span class=hljs-punctuation >,</span>
                       mu_X <span class=hljs-operator >=</span> <span class=hljs-number >0</span><span class=hljs-punctuation >,</span> mu_Y <span class=hljs-operator >=</span> <span class=hljs-number >0</span><span class=hljs-punctuation >,</span>
                       sigma_X <span class=hljs-operator >=</span> <span class=hljs-number >1</span><span class=hljs-punctuation >,</span> sigma_Y <span class=hljs-operator >=</span> <span class=hljs-number >1</span><span class=hljs-punctuation >,</span>
                       rho<span class=hljs-punctuation >)</span> <span class=hljs-punctuation >{</span>
   Sigma <span class=hljs-operator >&lt;-</span> diag<span class=hljs-punctuation >(</span><span class=hljs-number >2</span><span class=hljs-punctuation >)</span>
   Sigma<span class=hljs-punctuation >[</span><span class=hljs-number >1</span><span class=hljs-punctuation >,</span> <span class=hljs-number >2</span><span class=hljs-punctuation >]</span> <span class=hljs-operator >&lt;-</span> rho
   Sigma<span class=hljs-punctuation >[</span><span class=hljs-number >2</span><span class=hljs-punctuation >,</span> <span class=hljs-number >1</span><span class=hljs-punctuation >]</span> <span class=hljs-operator >&lt;-</span> rho
   draws <span class=hljs-operator >&lt;-</span> matrix<span class=hljs-punctuation >(</span>nrow <span class=hljs-operator >=</span> S<span class=hljs-punctuation >,</span> ncol <span class=hljs-operator >=</span> <span class=hljs-number >2</span><span class=hljs-punctuation >)</span>
   x <span class=hljs-operator >&lt;-</span> rnorm<span class=hljs-punctuation >(</span><span class=hljs-number >1</span><span class=hljs-punctuation >)</span>
   y <span class=hljs-operator >&lt;-</span> rnorm<span class=hljs-punctuation >(</span><span class=hljs-number >1</span><span class=hljs-punctuation >)</span>
   accepted <span class=hljs-operator >&lt;-</span> 0
   <span class=hljs-keyword >for</span> <span class=hljs-punctuation >(</span>s <span class=hljs-keyword >in</span> <span class=hljs-number >1</span><span class=hljs-operator >:</span>S<span class=hljs-punctuation >)</span> <span class=hljs-punctuation >{</span>
      x_ <span class=hljs-operator >&lt;-</span> runif<span class=hljs-punctuation >(</span><span class=hljs-number >1</span><span class=hljs-punctuation >,</span> x <span class=hljs-operator >-</span> width<span class=hljs-punctuation >,</span> x <span class=hljs-operator >+</span> width<span class=hljs-punctuation >)</span>
      y_ <span class=hljs-operator >&lt;-</span> runif<span class=hljs-punctuation >(</span><span class=hljs-number >1</span><span class=hljs-punctuation >,</span> y <span class=hljs-operator >-</span> width<span class=hljs-punctuation >,</span> y <span class=hljs-operator >+</span> width<span class=hljs-punctuation >)</span>
      r <span class=hljs-operator >&lt;-</span> <span class=hljs-built_in >exp</span><span class=hljs-punctuation >(</span>mnormt<span class=hljs-operator >::</span>dmnorm<span class=hljs-punctuation >(</span><span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span>x_<span class=hljs-punctuation >,</span> y_<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span> mean <span class=hljs-operator >=</span> <span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span>mu_X<span class=hljs-punctuation >,</span> mu_Y<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span> varcov <span class=hljs-operator >=</span> Sigma<span class=hljs-punctuation >,</span> <span class=hljs-built_in >log</span> <span class=hljs-operator >=</span> <span class=hljs-literal >TRUE</span><span class=hljs-punctuation >)</span> <span class=hljs-operator >-</span>
                        mnormt<span class=hljs-operator >::</span>dmnorm<span class=hljs-punctuation >(</span><span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span>x<span class=hljs-punctuation >,</span> y<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span> mean <span class=hljs-operator >=</span> <span class=hljs-built_in >c</span><span class=hljs-punctuation >(</span>mu_X<span class=hljs-punctuation >,</span> mu_Y<span class=hljs-punctuation >)</span><span class=hljs-punctuation >,</span> varcov <span class=hljs-operator >=</span> Sigma<span class=hljs-punctuation >,</span> <span class=hljs-built_in >log</span> <span class=hljs-operator >=</span> <span class=hljs-literal >TRUE</span><span class=hljs-punctuation >)</span><span class=hljs-punctuation >)</span>
      <span class=hljs-keyword >if</span> <span class=hljs-punctuation >(</span>r <span class=hljs-operator >&gt;</span> runif<span class=hljs-punctuation >(</span><span class=hljs-number >1</span><span class=hljs-punctuation >,</span> <span class=hljs-number >0</span><span class=hljs-punctuation >,</span> <span class=hljs-number >1</span><span class=hljs-punctuation >)</span><span class=hljs-punctuation >)</span> <span class=hljs-punctuation >{</span>
        x <span class=hljs-operator >&lt;-</span> x_
        y <span class=hljs-operator >&lt;-</span> y_
        accepted <span class=hljs-operator >&lt;-</span> accepted <span class=hljs-operator >+</span> <span class=hljs-number >1</span>
      <span class=hljs-punctuation >}</span>
      draws<span class=hljs-punctuation >[</span>s<span class=hljs-punctuation >,</span> <span class=hljs-number >1</span><span class=hljs-punctuation >]</span> <span class=hljs-operator >&lt;-</span> x
      draws<span class=hljs-punctuation >[</span>s<span class=hljs-punctuation >,</span> <span class=hljs-number >2</span><span class=hljs-punctuation >]</span> <span class=hljs-operator >&lt;-</span> y
   <span class=hljs-punctuation >}</span>
   print<span class=hljs-punctuation >(</span>paste0<span class=hljs-punctuation >(</span><span class=hljs-string >&quot;Acceptance rate is &quot;</span><span class=hljs-punctuation >,</span> accepted <span class=hljs-operator >/</span> S<span class=hljs-punctuation >)</span><span class=hljs-punctuation >)</span>
   <span class=hljs-built_in >return</span><span class=hljs-punctuation >(</span>draws<span class=hljs-punctuation >)</span>
<span class=hljs-punctuation >}</span></code></pre> <p>Now <strong>C&#43;&#43;</strong>. Here I am using the <a href="https://eigen.tuxfamily.org/"><code>Eigen</code></a> library. Note that, since C&#43;&#43; is a very powerful language to be used as &quot;close to the metal&quot; as possible, I don&#39;t have any convenient predefined multivariate normal to use. So I will have to create this from zero<sup id="fnref:mvnimplem"><a href="#fndef:mvnimplem" class=fnref >[2]</a></sup>.<br />Ok, be <strong>ready</strong>&#33; This is a mouthful:</p> <pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-keyword >include</span> <span class=hljs-string >&lt;Eigen/Eigen&gt;</span></span>
<span class=hljs-meta >#<span class=hljs-keyword >include</span> <span class=hljs-string >&lt;cmath&gt;</span></span>
<span class=hljs-meta >#<span class=hljs-keyword >include</span> <span class=hljs-string >&lt;iostream&gt;</span></span>
<span class=hljs-meta >#<span class=hljs-keyword >include</span> <span class=hljs-string >&lt;random&gt;</span></span>

<span class=hljs-keyword >using</span> std::cout;
std::random_device rd{};
std::mt19937 gen{<span class=hljs-built_in >rd</span>()};

<span class=hljs-comment >// Random Number Generator Stuff</span>
<span class=hljs-function ><span class=hljs-type >double</span> <span class=hljs-title >random_normal</span><span class=hljs-params >(<span class=hljs-type >double</span> mean = <span class=hljs-number >0</span>, <span class=hljs-type >double</span> std = <span class=hljs-number >1</span>)</span> </span>{
  std::normal_distribution&lt;<span class=hljs-type >double</span>&gt; d{mean, std};
  <span class=hljs-keyword >return</span> <span class=hljs-built_in >d</span>(gen);
};

<span class=hljs-function ><span class=hljs-type >double</span> <span class=hljs-title >random_unif</span><span class=hljs-params >(<span class=hljs-type >double</span> min = <span class=hljs-number >0</span>, <span class=hljs-type >double</span> max = <span class=hljs-number >1</span>)</span> </span>{
  std::uniform_real_distribution&lt;<span class=hljs-type >double</span>&gt; d{min, max};
  <span class=hljs-keyword >return</span> <span class=hljs-built_in >d</span>(gen);
};

<span class=hljs-comment >// Multivariate Normal</span>
<span class=hljs-keyword >struct</span> <span class="hljs-title class_">Mvn</span> {
  <span class=hljs-built_in >Mvn</span>(<span class=hljs-type >const</span> Eigen::VectorXd &amp;mu, <span class=hljs-type >const</span> Eigen::MatrixXd &amp;s)
      : <span class=hljs-built_in >mean</span>(mu), <span class=hljs-built_in >sigma</span>(s) {}
  <span class=hljs-function ><span class=hljs-type >double</span> <span class=hljs-title >pdf</span><span class=hljs-params >(<span class=hljs-type >const</span> Eigen::VectorXd &amp;x)</span> <span class=hljs-type >const</span></span>;
  <span class=hljs-function ><span class=hljs-type >double</span> <span class=hljs-title >lpdf</span><span class=hljs-params >(<span class=hljs-type >const</span> Eigen::VectorXd &amp;x)</span> <span class=hljs-type >const</span></span>;
  Eigen::VectorXd mean;
  Eigen::MatrixXd sigma;
};

<span class=hljs-function ><span class=hljs-type >double</span> <span class=hljs-title >Mvn::pdf</span><span class=hljs-params >(<span class=hljs-type >const</span> Eigen::VectorXd &amp;x)</span> <span class=hljs-type >const</span> </span>{
  <span class=hljs-type >double</span> n = x.<span class=hljs-built_in >rows</span>();
  <span class=hljs-type >double</span> sqrt2pi = std::<span class=hljs-built_in >sqrt</span>(<span class=hljs-number >2</span> * M_PI);
  <span class=hljs-type >double</span> quadform = (x - mean).<span class=hljs-built_in >transpose</span>() * sigma.<span class=hljs-built_in >inverse</span>() * (x - mean);
  <span class=hljs-type >double</span> norm = std::<span class=hljs-built_in >pow</span>(sqrt2pi, -n) * std::<span class=hljs-built_in >pow</span>(sigma.<span class=hljs-built_in >determinant</span>(), <span class=hljs-number >-0.5</span>);

  <span class=hljs-keyword >return</span> norm * <span class=hljs-built_in >exp</span>(<span class=hljs-number >-0.5</span> * quadform);
}

<span class=hljs-function ><span class=hljs-type >double</span> <span class=hljs-title >Mvn::lpdf</span><span class=hljs-params >(<span class=hljs-type >const</span> Eigen::VectorXd &amp;x)</span> <span class=hljs-type >const</span> </span>{
  <span class=hljs-type >double</span> n = x.<span class=hljs-built_in >rows</span>();
  <span class=hljs-type >double</span> sqrt2pi = std::<span class=hljs-built_in >sqrt</span>(<span class=hljs-number >2</span> * M_PI);
  <span class=hljs-type >double</span> quadform = (x - mean).<span class=hljs-built_in >transpose</span>() * sigma.<span class=hljs-built_in >inverse</span>() * (x - mean);
  <span class=hljs-type >double</span> norm = std::<span class=hljs-built_in >pow</span>(sqrt2pi, -n) * std::<span class=hljs-built_in >pow</span>(sigma.<span class=hljs-built_in >determinant</span>(), <span class=hljs-number >-0.5</span>);

  <span class=hljs-keyword >return</span> <span class=hljs-built_in >log</span>(norm) + (<span class=hljs-number >-0.5</span> * quadform);
}

<span class=hljs-function >Eigen::MatrixXd <span class=hljs-title >metropolis</span><span class=hljs-params >(<span class=hljs-type >int</span> S, <span class=hljs-type >double</span> width, <span class=hljs-type >double</span> mu_X = <span class=hljs-number >0</span>,
                                 <span class=hljs-type >double</span> mu_Y = <span class=hljs-number >0</span>, <span class=hljs-type >double</span> sigma_X = <span class=hljs-number >1</span>,
                                 <span class=hljs-type >double</span> sigma_Y = <span class=hljs-number >1</span>, <span class=hljs-type >double</span> rho = <span class=hljs-number >0.8</span>)</span> </span>{
  <span class=hljs-function >Eigen::MatrixXd <span class=hljs-title >sigma</span><span class=hljs-params >(<span class=hljs-number >2</span>, <span class=hljs-number >2</span>)</span></span>;
  sigma &lt;&lt; sigma_X, rho, rho, sigma_Y;
  <span class=hljs-function >Eigen::VectorXd <span class=hljs-title >mean</span><span class=hljs-params >(<span class=hljs-number >2</span>)</span></span>;
  mean &lt;&lt; mu_X, mu_Y;
  <span class=hljs-function >Mvn <span class=hljs-title >binormal</span><span class=hljs-params >(mean, sigma)</span></span>;

  <span class=hljs-function >Eigen::MatrixXd <span class=hljs-title >out</span><span class=hljs-params >(S, <span class=hljs-number >2</span>)</span></span>;
  <span class=hljs-type >double</span> x = <span class=hljs-built_in >random_normal</span>();
  <span class=hljs-type >double</span> y = <span class=hljs-built_in >random_normal</span>();
  <span class=hljs-type >double</span> accepted = <span class=hljs-number >0</span>;
  <span class=hljs-keyword >for</span> (<span class=hljs-type >size_t</span> i = <span class=hljs-number >0</span>; i &lt; S - <span class=hljs-number >1</span>; i++) {
    <span class=hljs-type >double</span> xmw = x - width;
    <span class=hljs-type >double</span> xpw = x + width;
    <span class=hljs-type >double</span> ymw = y - width;
    <span class=hljs-type >double</span> ypw = y + width;

    <span class=hljs-type >double</span> x_ = <span class=hljs-built_in >random_unif</span>(xmw, xpw);
    <span class=hljs-type >double</span> y_ = <span class=hljs-built_in >random_unif</span>(ymw, ypw);

    <span class=hljs-type >double</span> r = std::<span class=hljs-built_in >exp</span>(binormal.<span class=hljs-built_in >lpdf</span>(Eigen::<span class=hljs-built_in >Vector2d</span>(x_, y_)) -
                        binormal.<span class=hljs-built_in >lpdf</span>(Eigen::<span class=hljs-built_in >Vector2d</span>(x, y)));
    <span class=hljs-keyword >if</span> (r &gt; <span class=hljs-built_in >random_unif</span>()) {
      x = x_;
      y = y_;
      accepted++;
    }
    <span class=hljs-built_in >out</span>(i, <span class=hljs-number >0</span>) = x;
    <span class=hljs-built_in >out</span>(i, <span class=hljs-number >1</span>) = y;
  }
  cout &lt;&lt; <span class=hljs-string >&quot;Acceptance rate is &quot;</span> &lt;&lt; accepted / S &lt;&lt; <span class=hljs-string >&#x27;\n&#x27;</span>;

  <span class=hljs-keyword >return</span> out;
}</code></pre> <p>note that the <a href="https://en.wikipedia.org/wiki/Multivariate_normal_distribution">PDF for a multivariate normal</a> is:</p> <a id=mvnpdf  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mtext>PDF</mtext><mo stretchy=false >(</mo><mi mathvariant=bold-italic >μ</mi><mo separator=true >,</mo><mi mathvariant=bold >Σ</mi><mo stretchy=false >)</mo><mo>=</mo><mo stretchy=false >(</mo><mn>2</mn><mi>π</mi><msup><mo stretchy=false >)</mo><mrow><mo>−</mo><mfrac><mi>k</mi><mn>2</mn></mfrac></mrow></msup><mi>det</mi><mo>⁡</mo><mo stretchy=false >(</mo><mi mathvariant=bold >Σ</mi><msup><mo stretchy=false >)</mo><mrow><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow></msup><msup><mi>e</mi><mrow><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy=false >(</mo><mi mathvariant=bold >x</mi><mo>−</mo><mi mathvariant=bold-italic >μ</mi><msup><mo stretchy=false >)</mo><mi>T</mi></msup><msup><mi mathvariant=bold >Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >(</mo><mi mathvariant=bold >x</mi><mo>−</mo><mi mathvariant=bold-italic >μ</mi><mo stretchy=false >)</mo></mrow></msup><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \text{PDF}(\boldsymbol{\mu}, \boldsymbol{\Sigma}) = (2\pi)^{-{\frac{k}{2}}}\det({\boldsymbol{\Sigma}})^{-{\frac {1}{2}}}e^{-{\frac{1}{2}}(\mathbf{x}-{\boldsymbol{\mu}})^{T}{\boldsymbol{\Sigma }}^{-1}(\mathbf{x} -{\boldsymbol{\mu}})} , </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >PDF</span></span><span class=mopen >(</span><span class=mord ><span class=mord ><span class="mord boldsymbol">μ</span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">Σ</span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.306365em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord >2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:1.02902em;"><span style="top:-3.4130000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8800285714285714em;"><span style="top:-2.656em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class=pstrut  style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >det</span><span class=mopen >(</span><span class=mord ><span class=mord ><span class=mord ><span class="mord mathbf">Σ</span></span></span></span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:1.0040200000000001em;"><span style="top:-3.4130000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class=pstrut  style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:1.056365em;"><span style="top:-3.4130000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class=pstrut  style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span><span class="mopen mtight">(</span><span class="mord mathbf mtight">x</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight">μ</span></span></span></span><span class="mclose mtight"><span class="mclose mtight">)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.9190928571428572em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathbf mtight">Σ</span></span></span></span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8913142857142857em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathbf mtight">x</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord boldsymbol mtight">μ</span></span></span></span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold-italic >μ</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{\mu}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.63888em;vertical-align:-0.19444em;"></span><span class=mord ><span class=mord ><span class="mord boldsymbol">μ</span></span></span></span></span></span> is a vector of means, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> is the number of dimensions, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >Σ</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{\Sigma}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">Σ</span></span></span></span></span></span> is a covariance matrix, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>det</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\det</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mop >det</span></span></span></span> is the determinant and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >x</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.44444em;vertical-align:0em;"></span><span class="mord mathbf">x</span></span></span></span> is a vector of values that the PDF is evaluated for.</p> <p><strong>SPOILER ALERT</strong>: Julia will beat this C&#43;&#43; Eigen implementation by being almost 100x faster. So I will try to <em>help</em> C&#43;&#43; beat Julia &#40;😂&#41; by making a bivariate normal class <code>BiNormal</code> in order to avoid the expensive operation of inverting a covariance matrix and computing determinants in every logpdf proposal evaluation. Also since we are not doing linear algebra computations I&#39;ve removed Eigen and used C&#43;&#43; STL&#39;s <code>&lt;vector&gt;</code>:</p> <pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-keyword >define</span> M_PI 3.14159265358979323846 <span class=hljs-comment >/* pi */</span></span>

<span class=hljs-comment >// Bivariate Normal</span>
<span class=hljs-keyword >struct</span> <span class="hljs-title class_">BiNormal</span> {
  <span class=hljs-built_in >BiNormal</span>(<span class=hljs-type >const</span> std::vector&lt;<span class=hljs-type >double</span>&gt; &amp;mu, <span class=hljs-type >const</span> <span class=hljs-type >double</span> &amp;rho)
      : <span class=hljs-built_in >mean</span>(mu), <span class=hljs-built_in >rho</span>(rho) {}
  <span class=hljs-function ><span class=hljs-type >double</span> <span class=hljs-title >pdf</span><span class=hljs-params >(<span class=hljs-type >const</span> std::vector&lt;<span class=hljs-type >double</span>&gt; &amp;x)</span> <span class=hljs-type >const</span></span>;
  <span class=hljs-function ><span class=hljs-type >double</span> <span class=hljs-title >lpdf</span><span class=hljs-params >(<span class=hljs-type >const</span> std::vector&lt;<span class=hljs-type >double</span>&gt; &amp;x)</span> <span class=hljs-type >const</span></span>;
  std::vector&lt;<span class=hljs-type >double</span>&gt; mean;
  <span class=hljs-type >double</span> rho;
};

<span class=hljs-function ><span class=hljs-type >double</span> <span class=hljs-title >BiNormal::pdf</span><span class=hljs-params >(<span class=hljs-type >const</span> std::vector&lt;<span class=hljs-type >double</span>&gt; &amp;x)</span> <span class=hljs-type >const</span> </span>{
  <span class=hljs-type >double</span> x_ = x[<span class=hljs-number >0</span>];
  <span class=hljs-type >double</span> y_ = x[<span class=hljs-number >1</span>];
  <span class=hljs-keyword >return</span> std::<span class=hljs-built_in >exp</span>(-((std::<span class=hljs-built_in >pow</span>(x_, <span class=hljs-number >2</span>) - (<span class=hljs-number >2</span> * rho * x_ * y_) + std::<span class=hljs-built_in >pow</span>(y_, <span class=hljs-number >2</span>)) /
                    (<span class=hljs-number >2</span> * (<span class=hljs-number >1</span> - std::<span class=hljs-built_in >pow</span>(rho, <span class=hljs-number >2</span>))))) /
         (<span class=hljs-number >2</span> * M_PI * std::<span class=hljs-built_in >sqrt</span>(<span class=hljs-number >1</span> - std::<span class=hljs-built_in >pow</span>(rho, <span class=hljs-number >2</span>)));
}

<span class=hljs-function ><span class=hljs-type >double</span> <span class=hljs-title >BiNormal::lpdf</span><span class=hljs-params >(<span class=hljs-type >const</span> std::vector&lt;<span class=hljs-type >double</span>&gt; &amp;x)</span> <span class=hljs-type >const</span> </span>{
  <span class=hljs-type >double</span> x_ = x[<span class=hljs-number >0</span>];
  <span class=hljs-type >double</span> y_ = x[<span class=hljs-number >1</span>];
  <span class=hljs-keyword >return</span> (-((std::<span class=hljs-built_in >pow</span>(x_, <span class=hljs-number >2</span>) - (<span class=hljs-number >2</span> * rho * x_ * y_) + std::<span class=hljs-built_in >pow</span>(y_, <span class=hljs-number >2</span>))) /
          (<span class=hljs-number >2</span> * (<span class=hljs-number >1</span> - std::<span class=hljs-built_in >pow</span>(rho, <span class=hljs-number >2</span>)))) -
         std::<span class=hljs-built_in >log</span>(<span class=hljs-number >2</span>) - std::<span class=hljs-built_in >log</span>(M_PI) - <span class=hljs-built_in >log</span>(std::<span class=hljs-built_in >sqrt</span>(<span class=hljs-number >1</span> - std::<span class=hljs-built_in >pow</span>(rho, <span class=hljs-number >2</span>)));
}</code></pre> <p>This means that I&#39;ve simplified the PDF <sup id="fnref:mathbinormal"><a href="#fndef:mathbinormal" class=fnref >[3]</a></sup> from equation <span class=eqref >(<a href="#mvnpdf">1</a>)</span> into:</p> <a id=bvnpdf  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mtext>PDF</mtext><mo stretchy=false >(</mo><mi>x</mi><mo separator=true >,</mo><mi>y</mi><mo stretchy=false >)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>π</mi><msqrt><mrow><mn>1</mn><mo>−</mo><msup><mi>ρ</mi><mn>2</mn></msup></mrow></msqrt><msub><mi>σ</mi><mi>X</mi></msub><msub><mi>σ</mi><mi>Y</mi></msub></mrow></mfrac><msup><mi>e</mi><mrow><mo>−</mo><mfrac><mrow><mfrac><msup><mi>x</mi><mn>2</mn></msup><msubsup><mi>σ</mi><mi>X</mi><mn>2</mn></msubsup></mfrac><mo>−</mo><mn>2</mn><mi>ρ</mi><mo>−</mo><mfrac><mrow><mi>x</mi><mi>y</mi></mrow><mrow><msub><mi>σ</mi><mi>X</mi></msub><msub><mi>σ</mi><mi>Y</mi></msub></mrow></mfrac><mo>+</mo><mfrac><msup><mi>y</mi><mn>2</mn></msup><msubsup><mi>σ</mi><mi>Y</mi><mn>2</mn></msubsup></mfrac></mrow><mrow><mn>2</mn><mrow><mo fence=true >(</mo><mn>1</mn><mo>−</mo><msup><mi>ρ</mi><mn>2</mn></msup><mo fence=true >)</mo></mrow></mrow></mfrac></mrow></msup><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex"> \text{PDF}(x, y)= \frac{1}{2 \pi \sqrt{1 - \rho^2 } \sigma_X \sigma_Y} e^{-\frac{\frac{x^{2}}{\sigma_{X}^{2}}-2 \rho-\frac{x y}{\sigma_{X} \sigma_{Y}}+\frac{y^{2}}{\sigma_{Y}^{2}}}{2\left(1-\rho^{2}\right)}} .</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >PDF</span></span><span class=mopen >(</span><span class="mord mathnormal">x</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:3.4974749999999997em;vertical-align:-1.13em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.1521660000000002em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.9578340000000001em;"><span class=svg-align  style="top:-3.2em;"><span class=pstrut  style="height:3.2em;"></span><span class=mord  style="padding-left:1em;"><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">ρ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.917834em;"><span class=pstrut  style="height:3.2em;"></span><span class=hide-tail  style="min-width:1.02em;height:1.28em;"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119 c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120 c340,-704.7,510.7,-1060.3,512,-1067 l0 -0 c4.7,-7.3,11,-11,19,-11 H40000v40H1012.3 s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232 c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1 s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26 c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z M1001 80h400000v40h-400000z'/></svg></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2821659999999999em;"><span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:2.3674749999999998em;"><span style="top:-4.367475000000001em;margin-right:0.05em;"><span class=pstrut  style="height:3.683275em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.4046785714285717em;"><span style="top:-2.596363265306122em;"><span class=pstrut  style="height:3.118842857142857em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="minner mtight"><span class="mopen sizing reset-size1 size3 mtight delimcenter" style="top:0.07142857142857142em;"><span class=mtight >(</span></span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight">ρ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.9384399999999999em;"><span style="top:-2.93844em;margin-right:0.1em;"><span class=pstrut  style="height:2.64444em;"></span><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size1 size3 mtight delimcenter" style="top:0.07142857142857142em;"><span class=mtight >)</span></span></span></span></span></span><span style="top:-3.3443428571428573em;"><span class=pstrut  style="height:3.118842857142857em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-4.404678571428572em;"><span class=pstrut  style="height:3.118842857142857em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size1 size6"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.43544em;"><span style="top:-2.2357000000000005em;"><span class=pstrut  style="height:3.0484400000000003em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.98924em;"><span style="top:-2.1487999999999996em;margin-left:-0.03588em;margin-right:0.1em;"><span class=pstrut  style="height:2.6833299999999998em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.02813em;margin-right:0.1em;"><span class=pstrut  style="height:2.6833299999999998em;"></span><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.53453em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.2739400000000005em;"><span class=pstrut  style="height:3.0484400000000003em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.4354400000000003em;"><span class=pstrut  style="height:3.0484400000000003em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:1.04844em;"><span style="top:-3.04844em;margin-right:0.1em;"><span class=pstrut  style="height:2.64444em;"></span><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.34727em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size1 size6"></span></span><span class="mbin mtight">−</span><span class="mord mtight">2</span><span class="mord mathnormal mtight">ρ</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size1 size6"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.9485000000000001em;"><span style="top:-2.468em;"><span class=pstrut  style="height:3em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-left:-0.03588em;margin-right:0.1em;"><span class=pstrut  style="height:2.6833299999999998em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.33853em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3448em;"><span style="top:-2.3447999999999998em;margin-left:-0.03588em;margin-right:0.1em;"><span class=pstrut  style="height:2.6833299999999998em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.33853em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.2255000000000003em;"><span class=pstrut  style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.5179400000000003em;"><span class=pstrut  style="height:3em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.87053em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size1 size6"></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size1 size6"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.56638em;"><span style="top:-2.2357000000000005em;"><span class=pstrut  style="height:3.0484400000000003em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.98924em;"><span style="top:-2.1487999999999996em;margin-left:-0.03588em;margin-right:0.1em;"><span class=pstrut  style="height:2.6833299999999998em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-3.02813em;margin-right:0.1em;"><span class=pstrut  style="height:2.6833299999999998em;"></span><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.53453em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.2739400000000005em;"><span class=pstrut  style="height:3.0484400000000003em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.5663800000000005em;"><span class=pstrut  style="height:3.0484400000000003em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:1.04844em;"><span style="top:-3.04844em;margin-right:0.1em;"><span class=pstrut  style="height:2.64444em;"></span><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.34727em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size1 size6"></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8234999999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class=mord >.</span></span></span></span></span> <p>Since <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>X</mi></msub><mo>=</mo><msub><mi>σ</mi><mi>Y</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sigma_{X} = \sigma_{Y} = 1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span>, equation <span class=eqref >(<a href="#bvnpdf">2</a>)</span> boils down to:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mtext>PDF</mtext><mo stretchy=false >(</mo><mi>x</mi><mo separator=true >,</mo><mi>y</mi><mo stretchy=false >)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mi>π</mi><msqrt><mrow><mn>1</mn><mo>−</mo><msup><mi>ρ</mi><mn>2</mn></msup></mrow></msqrt></mrow></mfrac><msup><mi>e</mi><mrow><mo>−</mo><mfrac><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>2</mn><mi>ρ</mi><mo>−</mo><mi>x</mi><mi>y</mi><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup></mrow><mrow><mn>2</mn><mrow><mo fence=true >(</mo><mn>1</mn><mo>−</mo><msup><mi>ρ</mi><mn>2</mn></msup><mo fence=true >)</mo></mrow></mrow></mfrac></mrow></msup><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex"> \text{PDF}(x, y)=\frac{1}{2 \pi \sqrt{1 - \rho^2 }} e^{-\frac{x^{2} -2 \rho-x y+y^{2}}{2\left(1-\rho^{2}\right)}} .</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >PDF</span></span><span class=mopen >(</span><span class="mord mathnormal">x</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.66209em;vertical-align:-1.13em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.1521660000000002em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.9578340000000001em;"><span class=svg-align  style="top:-3.2em;"><span class=pstrut  style="height:3.2em;"></span><span class=mord  style="padding-left:1em;"><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">ρ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-2.917834em;"><span class=pstrut  style="height:3.2em;"></span><span class=hide-tail  style="min-width:1.02em;height:1.28em;"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119 c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120 c340,-704.7,510.7,-1060.3,512,-1067 l0 -0 c4.7,-7.3,11,-11,19,-11 H40000v40H1012.3 s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232 c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1 s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26 c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z M1001 80h400000v40h-400000z'/></svg></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2821659999999999em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord ><span class="mord mathnormal">e</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:1.53209em;"><span style="top:-3.6842em;margin-right:0.05em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.2112714285714286em;"><span style="top:-2.477520408163265em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="minner mtight"><span class="mopen sizing reset-size1 size3 mtight delimcenter" style="top:0.07142857142857142em;"><span class=mtight >(</span></span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight">ρ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.9384399999999999em;"><span style="top:-2.93844em;margin-right:0.1em;"><span class=pstrut  style="height:2.64444em;"></span><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose sizing reset-size1 size3 mtight delimcenter" style="top:0.07142857142857142em;"><span class=mtight >)</span></span></span></span></span></span><span style="top:-3.2255000000000003em;"><span class=pstrut  style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.4623857142857144em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:1.04844em;"><span style="top:-3.04844em;margin-right:0.1em;"><span class=pstrut  style="height:2.64444em;"></span><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">2</span><span class="mord mathnormal mtight">ρ</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:1.04844em;"><span style="top:-3.04844em;margin-right:0.1em;"><span class=pstrut  style="height:2.64444em;"></span><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8234999999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class=mord >.</span></span></span></span></span> <p>no more determinants or matrix inversions. Easy-peasy for C&#43;&#43;.</p> <p>Now let&#39;s go to the last, but not least: <a href="https://mc-stan.org"><code>Stan</code></a> is a probabilistic language for specifying probabilistic models &#40;does the same as <code>Turing.jl</code> does&#41; and comes also with a very fast C&#43;&#43;-based MCMC sampler. <code>Stan</code> is a personal favorite of mine and I have a <a href="https://storopoli.io/Bayesian-Statistics/">whole graduate course of Bayesian statistics using <code>Stan</code></a>. Here&#39;s the <code>Stan</code> implementation:</p> <pre><code class="stan hljs"><span class=hljs-title >functions</span> {
    <span class=hljs-type >real</span> <span class=hljs-built_in >binormal_lpdf</span>(<span class=hljs-type >real</span> [] xy, <span class=hljs-type >real</span> mu_X, <span class=hljs-type >real</span> mu_Y, <span class=hljs-type >real</span> sigma_X, <span class=hljs-type >real</span> sigma_Y, <span class=hljs-type >real</span> rho) {
    <span class=hljs-type >real</span> beta = rho * sigma_Y / sigma_X; <span class=hljs-type >real</span> sigma = sigma_Y * <span class=hljs-built_in >sqrt</span>(<span class=hljs-number >1</span> - <span class=hljs-built_in >square</span>(rho));
    <span class=hljs-keyword >return</span> <span class=hljs-built_in >normal_lpdf</span>(xy[<span class=hljs-number >1</span>] | mu_X, sigma_X) +
           <span class=hljs-built_in >normal_lpdf</span>(xy[<span class=hljs-number >2</span>] | mu_Y + beta * (xy[<span class=hljs-number >1</span>] - mu_X), sigma);
  }

  <span class=hljs-type >matrix</span> metropolis_rng(<span class=hljs-type >int</span> S, <span class=hljs-type >real</span> width,
                        <span class=hljs-type >real</span> mu_X, <span class=hljs-type >real</span> mu_Y,
                        <span class=hljs-type >real</span> sigma_X, <span class=hljs-type >real</span> sigma_Y,
                        <span class=hljs-type >real</span> rho) {
    <span class=hljs-type >matrix</span>[S, <span class=hljs-number >2</span>] out; <span class=hljs-type >real</span> x = normal_rng(<span class=hljs-number >0</span>, <span class=hljs-number >1</span>); <span class=hljs-type >real</span> y = normal_rng(<span class=hljs-number >0</span>, <span class=hljs-number >1</span>); <span class=hljs-type >real</span> accepted = <span class=hljs-number >0</span>;
    <span class=hljs-keyword >for</span> (s <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:S) {
      <span class=hljs-type >real</span> xmw = x - width; <span class=hljs-type >real</span> xpw = x + width; <span class=hljs-type >real</span> ymw = y - width; <span class=hljs-type >real</span> ypw = y + width;
      <span class=hljs-type >real</span> x_ = uniform_rng(xmw, xpw); <span class=hljs-type >real</span> y_ = uniform_rng(ymw, ypw);
      <span class=hljs-type >real</span> r = <span class=hljs-built_in >exp</span>(<span class=hljs-built_in >binormal_lpdf</span>({x_, y_} | mu_X, mu_Y, sigma_X, sigma_Y, rho) -
                            <span class=hljs-built_in >binormal_lpdf</span>({x , y } | mu_X, mu_Y, sigma_X, sigma_Y, rho));
      <span class=hljs-keyword >if</span> (r &gt; uniform_rng(<span class=hljs-number >0</span>, <span class=hljs-number >1</span>)) {
        x = x_; y = y_; accepted += <span class=hljs-number >1</span>;
      }
      out[s, <span class=hljs-number >1</span>] = x;  out[s, <span class=hljs-number >2</span>] = y;
    }
    <span class=hljs-built_in >print</span>(<span class=hljs-string >&quot;Acceptance rate is &quot;</span>, accepted / S);
    <span class=hljs-keyword >return</span> out;
  }
}</code></pre> <p>Wow, that was lot... Not let&#39;s go to the results. I&#39;ve benchmarked R and <code>Stan</code> code using <code>&#123;bench&#125;</code> and <code>&#123;rstan&#125;</code> packages, C&#43;&#43; using <code>catch2</code>, Julia using <code>BenchmarkTools.jl</code>. For all benchmarks the parameters were: <code>S &#61; 10_000</code> simulations, <code>width &#61; 2.75</code> and <code>ρ &#61; 0.8</code>. From fastest to slowest:</p> <ul> <li><p><code>Stan</code> - 3.6ms</p> <li><p>Julia - 6.3ms</p> <li><p>C&#43;&#43; <code>BiNormal</code> - 17ms</p> <li><p>C&#43;&#43; <code>MvNormal</code> - 592ms</p> <li><p>R - 1.35s which means 1350ms</p> </ul> <p><strong>Conclusion</strong>: a naïve Julia implementation beats C&#43;&#43; &#40;while also beating a C&#43;&#43; math-helped faster implementation using bivariate normal PDFs&#41; and gets very close to <code>Stan</code>, a highly specialized probabilistic language that compiles and runs on C&#43;&#43; with lots of contributors, funding and development time invested.</p> <p>Despite being <em>blazing</em> fast, Julia also <strong>codes very easily</strong>.<br />You can write and read code without much effort.</p> <h2 id=multiple_dispatch ><a href="#multiple_dispatch" class=header-anchor >Multiple Dispatch</a></h2> <p>I think that this is the <strong>real game changer of Julia language</strong>: The ability to define <strong>function behavior</strong> across many combinations of argument types via <a href="https://en.wikipedia.org/wiki/Multiple_dispatch"><strong>multiple dispatch</strong></a>. <strong>Multiple dispatch</strong> is a feature that allows a function or method to be <strong>dynamically dispatched</strong> based on the run-time &#40;dynamic&#41; type or, in the more general case, some other attribute of more than one of its arguments. This is a <strong>generalization of single-dispatch polymorphism</strong> where a function or method call is dynamically dispatched based on the derived type of the object on which the method has been called. Multiple dispatch routes the dynamic dispatch to the implementing function or method using the combined characteristics of one or more arguments.</p> <p>Most languages have single-dispatch polymorphism that rely on the first parameter of a method in order to determine which method should be called. But what Julia differs is that <strong>multiple parameters are taken into account</strong>. This enables multiple definitions of similar functions that have the same initial parameter. I think that this is best explained by one of the creators of Julia, Stefan Karpinski, at JuliaCon 2019 &#40;see the video below&#41;:</p> <style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style><div class='embed-container'><iframe src='https://www.youtube.com/embed/kc9HwsxE1OY' frameborder='0' allowfullscreen></iframe></div> <h3 id=example_dogs_and_cats ><a href="#example_dogs_and_cats" class=header-anchor >Example: Dogs and Cats</a></h3> <p>I will reproduce Karpinski&#39;s example. In the talk, Karpinski designs a structure of classes which are very common in object-oriented programming &#40;OOP&#41;. In Julia, we don&#39;t have classes but we have <strong>structures</strong> &#40;<code>struct</code>&#41; that are meant to be &quot;structured data&quot;: they define the kind of information that is embedded in the structure, that is a set of fields &#40;aka &quot;properties&quot; or &quot;attributes&quot; in other languages&#41;, and then individual instances &#40;or &quot;objects&quot;&#41; can be produced each with its own specific values for the fields defined by the structure.</p> <p>We create an abstract <code>type</code> called <code>Pet</code>. Then, we proceed by creating two derived <code>struct</code> from <code>Pet</code> that has one field <code>name</code> &#40;a <code>String</code>&#41;. These derived <code>struct</code> are <code>Dog</code> and <code>Cat</code>. We also define some methods for what happens in an &quot;encounter&quot; by defining a generic function <code>meets&#40;&#41;</code> and several specific methods of <code>meets&#40;&#41;</code> that will be multiple dispatched by Julia in runtime to define the action that one type <code>Pet</code> takes when it meets another <code>Pet</code>:</p> <pre><code class="julia hljs"><span class=hljs-keyword >abstract type</span> Pet <span class=hljs-keyword >end</span>
<span class=hljs-keyword >struct</span> Dog &lt;: Pet
    name::<span class=hljs-built_in >String</span>
<span class=hljs-keyword >end</span>
<span class=hljs-keyword >struct</span> Cat &lt;: Pet
    name::<span class=hljs-built_in >String</span>
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function</span> encounter(a::Pet, b::Pet)
    verb = meets(a, b)
    <span class=hljs-keyword >return</span> println(<span class=hljs-string >&quot;<span class=hljs-subst >$(a.name)</span> meets <span class=hljs-subst >$(b.name)</span> and <span class=hljs-variable >$verb</span>&quot;</span>)
<span class=hljs-keyword >end</span>

meets(a::Dog, b::Dog) = <span class=hljs-string >&quot;sniffs&quot;</span>;
meets(a::Dog, b::Cat) = <span class=hljs-string >&quot;chases&quot;</span>;
meets(a::Cat, b::Dog) = <span class=hljs-string >&quot;hisses&quot;</span>;
meets(a::Cat, b::Cat) = <span class=hljs-string >&quot;slinks&quot;</span>;</code></pre> <p>Let&#39;s see what happens when we instantiate objects from <code>Dog</code> and <code>Cat</code> and call <code>encounter</code> on them in Julia:</p> <pre><code class="julia hljs">fido = Dog(<span class=hljs-string >&quot;Fido&quot;</span>);
rex = Dog(<span class=hljs-string >&quot;Rex&quot;</span>);
whiskers = Cat(<span class=hljs-string >&quot;Whiskers&quot;</span>);
spots = Cat(<span class=hljs-string >&quot;Spots&quot;</span>);

encounter(fido, rex)
encounter(rex, whiskers)
encounter(spots, fido)
encounter(whiskers, spots)</code></pre><pre><code class="plaintext hljs">Fido meets Rex and sniffs
Rex meets Whiskers and chases
Spots meets Fido and hisses
Whiskers meets Spots and slinks
</code></pre> <p>It works as expected. Now let&#39;s translate this to modern C&#43;&#43; as literally as possible. Let&#39;s define a class <code>Pet</code> with a member variable <code>name</code> – in C &#43;&#43; we can do this. Then we define a base function <code>meets&#40;&#41;</code>, a function <code>encounter&#40;&#41;</code>for two objects of the type <code>Pet</code>, and finally, define derived classes <code>Dog</code>and <code>Cat</code> overload <code>meets&#40;&#41;</code> for them:</p> <pre><code class="cpp hljs"><span class=hljs-meta >#<span class=hljs-keyword >include</span> <span class=hljs-string >&lt;iostream&gt;</span></span>
<span class=hljs-meta >#<span class=hljs-keyword >include</span> <span class=hljs-string >&lt;string&gt;</span></span>

<span class=hljs-keyword >using</span> std::string;
<span class=hljs-keyword >using</span> std::cout;

<span class=hljs-keyword >class</span> <span class="hljs-title class_">Pet</span> {
    <span class=hljs-keyword >public</span>:
        string name;
};

<span class=hljs-function >string <span class=hljs-title >meets</span><span class=hljs-params >(Pet a, Pet b)</span> </span>{ <span class=hljs-keyword >return</span> <span class=hljs-string >&quot;FALLBACK&quot;</span>; } <span class=hljs-comment >// If we use `return meets(a, b)` doesn&#x27;t work</span>

<span class=hljs-function ><span class=hljs-type >void</span> <span class=hljs-title >encounter</span><span class=hljs-params >(Pet a, Pet b)</span> </span>{
    string verb = <span class=hljs-built_in >meets</span>(a, b);
    cout &lt;&lt; a.name &lt;&lt; <span class=hljs-string >&quot; meets &quot;</span>
         &lt;&lt; b. name &lt;&lt; <span class=hljs-string >&quot; and &quot;</span> &lt;&lt; verb &lt;&lt; <span class=hljs-string >&#x27;\n&#x27;</span>;
}

<span class=hljs-keyword >class</span> <span class="hljs-title class_">Cat</span> : <span class=hljs-keyword >public</span> Pet {};
<span class=hljs-keyword >class</span> <span class="hljs-title class_">Dog</span> : <span class=hljs-keyword >public</span> Pet {};

<span class=hljs-function >string <span class=hljs-title >meets</span><span class=hljs-params >(Dog a, Dog b)</span> </span>{ <span class=hljs-keyword >return</span> <span class=hljs-string >&quot;sniffs&quot;</span>; }
<span class=hljs-function >string <span class=hljs-title >meets</span><span class=hljs-params >(Dog a, Cat b)</span> </span>{ <span class=hljs-keyword >return</span> <span class=hljs-string >&quot;chases&quot;</span>; }
<span class=hljs-function >string <span class=hljs-title >meets</span><span class=hljs-params >(Cat a, Dog b)</span> </span>{ <span class=hljs-keyword >return</span> <span class=hljs-string >&quot;hisses&quot;</span>; }
<span class=hljs-function >string <span class=hljs-title >meets</span><span class=hljs-params >(Cat a, Cat b)</span> </span>{ <span class=hljs-keyword >return</span> <span class=hljs-string >&quot;slinks&quot;</span>; }</code></pre> <p>Now we add a <code>main&#40;&#41;</code> function to the C&#43;&#43; script:</p> <pre><code class="cpp hljs"><span class=hljs-function ><span class=hljs-type >int</span> <span class=hljs-title >main</span><span class=hljs-params >()</span> </span>{
    Dog fido;      fido.name     = <span class=hljs-string >&quot;Fido&quot;</span>;
    Dog rex;       rex.name      = <span class=hljs-string >&quot;Rex&quot;</span>;
    Cat whiskers;  whiskers.name = <span class=hljs-string >&quot;Whiskers&quot;</span>;
    Cat spots;     spots.name    = <span class=hljs-string >&quot;Spots&quot;</span>;

    <span class=hljs-built_in >encounter</span>(fido, rex);
    <span class=hljs-built_in >encounter</span>(rex, whiskers);
    <span class=hljs-built_in >encounter</span>(spots, fido);
    <span class=hljs-built_in >encounter</span>(whiskers, spots);

    <span class=hljs-keyword >return</span> <span class=hljs-number >0</span>;
}</code></pre> <p>And this is what we get:</p> <pre><code class="bash hljs">g++ main.cpp &amp;&amp; ./a.out

Fido meets Rex and FALLBACK
Rex meets Whiskers and FALLBACK
Spots meets Fido and FALLBACK
Whiskers meets Spots and FALLBACK</code></pre> <p>Doesn&#39;t work... 🤷🏼</p> <h3 id=example_one-hot_vector ><a href="#example_one-hot_vector" class=header-anchor >Example: One-hot Vector</a></h3> <p>Now let&#39;s change to another nice example of creating a <a href="https://en.wikipedia.org/wiki/One-hot">one-hot vector</a>. One-hot vector is a vector of integers in which all indices are zero &#40;0&#41; except for one single index that is one &#40;1&#41;. In machine learning, one-hot encoding is a frequently used method to deal with categorical data. Because many machine learning models need their input variables to be numeric, categorical variables need to be transformed in the pre-processing part. The example below is heavily inspired by a <a href="https://habr.com/ru/post/468609/">post from Vasily Pisarev</a><sup id="fnref:onehotpost"><a href="#fndef:onehotpost" class=fnref >[4]</a></sup>.</p> <p>How we would represent one-hot vectors in Julia? Simple: we create a new type <code>OneHotVector</code> in Julia using the <code>struct</code> keyword and define two fields <code>len</code> and <code>ind</code>, which represents the <code>OneHotVector</code> length and which index is the entry 1 &#40;<em>i.e.</em> which index is &quot;hot&quot;&#41;. Then, we define new methods for the <code>Base</code> functions <code>size&#40;&#41;</code> and <code>getindex&#40;&#41;</code> for our newly defined <code>OneHotVector</code>.</p> <pre><code class="julia hljs"><span class=hljs-keyword >import</span> Base: size, getindex

<span class=hljs-keyword >struct</span> OneHotVector &lt;: <span class=hljs-built_in >AbstractVector</span>{<span class=hljs-built_in >Int</span>}
    len::<span class=hljs-built_in >Int</span>
    ind::<span class=hljs-built_in >Int</span>
<span class=hljs-keyword >end</span>

size(v::OneHotVector) = (v.len,)

getindex(v::OneHotVector, i::<span class=hljs-built_in >Integer</span>) = <span class=hljs-built_in >Int</span>(i == v.ind)</code></pre><pre><code class="plaintext hljs">getindex (generic function with 954 methods)</code></pre>
<p>Since <code>OneHotVector</code> is a <code>struct</code> derived from <code>AbstractVector</code> we can use all of the methods previously defined for <code>AbstractVector</code> and it simply works right off the bat. Here we are constructing an <code>Array</code> with a list comprehension:</p>
<pre><code class="julia hljs">onehot = [OneHotVector(<span class=hljs-number >3</span>, rand(<span class=hljs-number >1</span>:<span class=hljs-number >3</span>)) <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >4</span>]</code></pre><pre><code class="plaintext hljs">4-element Vector{OneHotVector}:
 [1, 0, 0]
 [0, 1, 0]
 [0, 1, 0]
 [1, 0, 0]</code></pre>
<p>Now I define a new function <code>inner_sum&#40;&#41;</code> that is basically a recursive dot product with a summation. Here A – this is something matrix-like &#40;although I did not indicate the types, and you can guess something only by the name&#41;, and <code>vs</code> is a vector of some vector-like elements. The function proceeds by taking the dot product of the &quot;matrix&quot; with all vector-like elements of <code>vs</code> and returning the accumulated values. This is all given generic definition without specifying any types. Generic programming here consists in this very function call <code>inner&#40;&#41;</code> in a loop.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> LinearAlgebra

<span class=hljs-keyword >function</span> inner_sum(A, vs)
    t = zero(eltype(A))
    <span class=hljs-keyword >for</span> v <span class=hljs-keyword >in</span> vs
        t += inner(v, A, v) <span class=hljs-comment ># multiple dispatch!</span>
    <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >return</span> t
<span class=hljs-keyword >end</span>

inner(v, A, w) = dot(v, A * w) <span class=hljs-comment ># very general definition</span></code></pre><pre><code class="plaintext hljs">inner (generic function with 1 method)</code></pre>
<p>So, &quot;look mom, it works&quot;:</p>
<pre><code class="julia hljs">A = rand(<span class=hljs-number >3</span>, <span class=hljs-number >3</span>)
vs = [rand(<span class=hljs-number >3</span>) <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >4</span>]
inner_sum(A, vs)</code></pre><pre><code class="plaintext hljs">6.535457806563644</code></pre>
<p>Since <code>OneHotVector</code> is a subtype of <code>AbstractVector</code>:</p>
<pre><code class="julia hljs">supertype(OneHotVector)</code></pre><pre><code class="plaintext hljs">AbstractVector{Int64} (alias for AbstractArray{Int64, 1})</code></pre>
<p>We can use <code>inner_sum</code> and it will do what it is supposed to do:</p>
<pre><code class="julia hljs">inner_sum(A, onehot)</code></pre><pre><code class="plaintext hljs">3.030818595291703</code></pre>
<p>But this default implementation is <strong>slow</strong>:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> BenchmarkTools

<span class=hljs-meta >@btime</span> inner_sum($A, $onehot);</code></pre><pre><code class="plaintext hljs">  157.048 ns (8 allocations: 320 bytes)
</code></pre>
<p>We can greatly optimize this procedure. Now let&#39;s redefine matrix multiplication by <code>OneHotVector</code> with a simple column selection. We do this by defining a new method of the <code>*</code> function &#40;multiplier function&#41; of <code>Base</code> Julia. Additionally we also create a new optimized method of <code>inner&#40;&#41;</code> for dealing with <code>OneHotVector</code>:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >import</span> Base: *

*(A::<span class=hljs-built_in >AbstractMatrix</span>, v::OneHotVector) = A[:, v.ind]
inner(v::OneHotVector, A, w::OneHotVector) = A[v.ind, w.ind]</code></pre><pre><code class="plaintext hljs">inner (generic function with 2 methods)</code></pre>
<p>That&#39;s it&#33; Simple, huh? Now let&#39;s benchmark:</p>
<pre><code class="julia hljs"><span class=hljs-meta >@btime</span> inner_sum($A, $onehot);</code></pre><pre><code class="plaintext hljs">  4.944 ns (0 allocations: 0 bytes)
</code></pre>
<p><strong>Huge gains</strong> of speed&#33; 🚀</p>
<h2 id=julia_the_right_approach ><a href="#julia_the_right_approach" class=header-anchor >Julia: the right approach</a></h2>
<p>Here are some more thoughts on why I believe Julia is the right approach to scientific computation.</p>
<p>Below is a very opinionated image that divides the scientific computing languages that we&#39;ve spoken so far in a 2x2 diagram with two axes: <em>Slow-Fast</em> and <em>Easy-Hard</em>. I&#39;ve put C&#43;&#43; and FORTRAN in the hard and fast quadrant. R and Python goes into the easy and slow quadrant. Julia is the only language in the easy and fast quadrant. I don&#39;t know any language that would want to be hard and slow, so this quadrant is empty.</p>
<p><img src="/Bayesian-Julia/pages/images/language_comparisons.svg" alt="Scientific Computing Language Comparisons" /></p>
<p><div class=text-center ><em>Scientific Computing Language Comparisons</em></div> <br/></p>
<p>What I want to say with this image is that if you want to <strong>code fast and easy</strong> use Julia.</p>
<p>One other thing to note that I find quite astonishing is that Julia packages are all written in Julia. This does not happen in other scientific computing languages. For example, the whole <code>&#123;tidyverse&#125;</code> ecosystem of R packages are based on C&#43;&#43;. <code>NumPy</code> and <code>SciPy</code> are a mix of FORTRAN and C. <code>Scikit-Learn</code> is also coded in C.</p>
<p>See the figure below where I compare the GitHub&#39;s &quot;Languages&quot; stack bar of <a href="https://github.com/pytorch/pytorch"><code>PyTorch</code></a>, <a href="https://github.com/tensorflow/tensorflow"><code>TensorFlow</code></a> and <a href="https://github.com/FluxML/Flux.jl"><code>Flux.jl</code></a>&#40;Julia&#39;s Deep Learning package&#41;. This figure I would call <em>&quot;Python my a**&#33;&quot;</em> 😂:</p>
<p><img src="/Bayesian-Julia/pages/images/ML_code_breakdown.svg" alt="Python my ass" /></p>
<p><div class=text-center ><em>Python my a**&#33;</em></div> <br/></p>
<div class=note ><div class=title >⚠ Note</div>
<div class=content >On the other hand, language <em>interoperability</em> is extremely useful: we want to exploit existing high-quality code in other languages from Julia &#40;and vice versa&#41;&#33; Julia community have worked hard on this, from the built-in intrinsic Julia <code>ccall</code> function &#40;to call C and Fortran libraries&#41; to <a href="https://github.com/JuliaInterop">JuliaInterop</a><sup id="fnref:interop"><a href="#fndef:interop" class=fnref >[5]</a></sup> packages that connect Julia to Python, R, Matlab, C&#43;&#43;, and more.</div></div>
<p>Another example comes from a Julia podcast that unfortunately I cannot recollect either what podcast was nor who was being interviewed. While being asked about how he joined the Julia bandwagon, he replied something in the likes:</p>
<blockquote>
<p><em>&quot;Well, I was doing some crazy calculation using a library that was a wrapper to an algorithm coded in FORTRAN and I was trying to get help with a bug. I opened an issue and after 2 weeks of no reply I&#39;ve dived into the FORTRAN code &#40;despite having no knowledge of FORTRAN&#41;. There I saw a comment from the original author describing exactly the same bug that I was experiencing and saying that he would fix this in the future. The comment was dated from 1992. At the same time a colleague of mine suggested that I could try to code the algorithm in some new language called Julia. I thought &#39;me?&#33; code an algorithm?&#33;&#39;. So, I coded the algorithm in Julia and it was faster than the FORTRAN implementation and also without the evil bug. One thing to note that it was really easy to code the algorithm in Julia.&quot;</em></p>
</blockquote>
<p>Having stuff in different language and wrappers can hinder further research as you can see from this example.</p>
<p>As you saw from the <a href="https://youtu.be/kc9HwsxE1OY">Karpinski&#39;s talk</a> above, <strong>multiple dispatch empower users to define their own types &#40;if necessary&#41;</strong> and also allows them to <strong>extend functions and types from other users</strong> to their own special use. This results in an ecosystem that stimulates code sharing and code reuse in scientific computing that is unmatched. For instance, if I plug a differential equation from <a href="https://diffeq.sciml.ai/"><code>DifferentialEquations.jl</code></a> into a <a href="https://turing.ml/"><code>Turing.jl</code></a> model I get a Bayesian stochastic differential equation model, <em>e.g.</em> <strong>Bayesian SIR model for infectious disease</strong>. If I plug a <a href="https://fluxml.ai/"><code>Flux.jl</code></a> neural network into a <a href="https://turing.ml/"><code>Turing.jl</code></a> model I get a <strong>Bayesian neural network</strong>&#33; When I saw this type of code sharing I was blown away &#40;and I still am&#41;.</p>
<div class=note ><div class=title >⚠ Note</div>
<div class=content >This is the <strong>true power</strong> of a scientific computing language like Julia. It brings so much <strong>power</strong> and <strong>flexibility</strong> to the user and allows different ways of <strong>sharing</strong>, <strong>contributing</strong>, <strong>extending</strong>, <strong>mixing</strong> and <strong>implementing</strong> code and science. I hope this short dive into Julia has somehow sent you <strong>towards</strong> Julia.</div></div>
<h2 id=footnotes ><a href="#footnotes" class=header-anchor >Footnotes</a></h2>
<p><table class=fndef  id="fndef:updatedversion">
    <tr>
        <td class=fndef-backref ><a href="#fnref:updatedversion">[1]</a>
        <td class=fndef-content >please note that I&#39;ve used updated versions for all languages and packages as of April, 2021. <code>DataFrames.jl</code> version 1.0.1, <code>Pandas</code> version 1.2.4, <code>NumPy</code> version 1.20.2, <code>&#123;dplyr&#125;</code> version 1.0.5. We did not cover R&#39;s <code>&#123;data.table&#125;</code> here. Further benchmarking information is available for example here: <a href="https://h2oai.github.io/db-benchmark/">Tabular data benchmarking</a>
    
</table>
<table class=fndef  id="fndef:mvnimplem">
    <tr>
        <td class=fndef-backref ><a href="#fnref:mvnimplem">[2]</a>
        <td class=fndef-content >which of course I did not. The <code>Mvn</code> class is inspired by <a href="http://blog.sarantop.com/notes/mvn">Iason Sarantopoulos&#39; implementation</a>.
    
</table>
<table class=fndef  id="fndef:mathbinormal">
    <tr>
        <td class=fndef-backref ><a href="#fnref:mathbinormal">[3]</a>
        <td class=fndef-content >you can find all the math <a href="http://www.athenasc.com/Bivariate-Normal.pdf">here</a>.
    
</table>
<table class=fndef  id="fndef:onehotpost">
    <tr>
        <td class=fndef-backref ><a href="#fnref:onehotpost">[4]</a>
        <td class=fndef-content >the post in Russian, I&#39;ve &quot;Google Translated&quot; it to English.
    
</table>
<table class=fndef  id="fndef:interop">
    <tr>
        <td class=fndef-backref ><a href="#fnref:interop">[5]</a>
        <td class=fndef-content >Julia has a lot of interoperability between languages. Check out: <a href="https://github.com/JuliaPy/PyCall.jl"><code>PyCall.jl</code></a> and <a href="https://github.com/JuliaPy"><code>JuliaPy</code></a> for Python; <a href="https://juliainterop.github.io/RCall.jl/stable/"><code>RCall.jl</code></a> for Java; <a href="https://juliainterop.github.io/Cxx.jl/stable/"><code>Cxx.jl</code></a> and <a href="https://github.com/JuliaInterop/CxxWrap.jl"><code>CxxWrap.jl</code></a> for C&#43;&#43;; <a href="https://github.com/JuliaInterop/Clang.jl"><code>Clang.jl</code></a> for libclang and C; <a href="https://github.com/JuliaInterop/ObjectiveC.jl"><code>ObjectiveC.jl</code></a> for Objective-C; <a href="https://juliainterop.github.io/JavaCall.jl/"><code>JavaCall.jl</code></a> for Java; <a href="https://github.com/JuliaInterop/MATLAB.jl"><code>MATLAB.jl</code></a> for MATLAB; <a href="https://github.com/JuliaInterop/MathLink.jl"><code>MathLink.jl</code></a> for Mathematica/Wolfram Engine; <a href="https://github.com/JuliaInterop/OctCall.jl"><code>OctCall.jl</code></a> for GNU Octave; and <a href="https://juliainterop.github.io/ZMQ.jl/stable/"><code>ZMQ.jl</code></a> for ZeroMQ.
    
</table>
</p>
<h2 id=references ><a href="#references" class=header-anchor >References</a></h2>
<p>Bezanson, J., Edelman, A., Karpinski, S., &amp; Shah, V. B. &#40;2017&#41;. Julia: A fresh approach to numerical computing. SIAM Review, 59&#40;1&#41;, 65–98.</p>

<div class=page-foot >
  <div class=copyright >
    Last modified: October 26, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div> 
    </div> 
    </div> <!-- end of class page-wrap-->